<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>综合管理系统</title>
    <style>
        /* 基础样式保持不变 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
            font-size: 16px;
            /* 修复后的警灯动画 - 蓝色和红色各每秒闪烁15次 */
            animation: policeLight 2s linear infinite;
        }

        /* 特殊管理员粉红渐变背景 */
        body.special-admin {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            animation: none;
        }

        /* 修复后的警灯动画 - 蓝色和红色各每秒闪烁15次 */
        @keyframes policeLight {
            0% { background: #1565c0; }
            1.666% { background: #1565c0; }
            3.333% { background: #c62828; }
            5% { background: #c62828; }
            6.666% { background: #1565c0; }
            8.333% { background: #1565c0; }
            10% { background: #c62828; }
            11.666% { background: #c62828; }
            13.333% { background: #1565c0; }
            15% { background: #1565c0; }
            16.666% { background: #c62828; }
            18.333% { background: #c62828; }
            20% { background: #1565c0; }
            21.666% { background: #1565c0; }
            23.333% { background: #c62828; }
            25% { background: #c62828; }
            26.666% { background: #1565c0; }
            28.333% { background: #1565c0; }
            30% { background: #c62828; }
            31.666% { background: #c62828; }
            33.333% { background: #1565c0; }
            35% { background: #1565c0; }
            36.666% { background: #c62828; }
            38.333% { background: #c62828; }
            40% { background: #1565c0; }
            41.666% { background: #1565c0; }
            43.333% { background: #c62828; }
            45% { background: #c62828; }
            46.666% { background: #1565c0; }
            48.333% { background: #1565c0; }
            50% { background: #c62828; }
            51.666% { background: #c62828; }
            53.333% { background: #1565c0; }
            55% { background: #1565c0; }
            56.666% { background: #c62828; }
            58.333% { background: #c62828; }
            60% { background: #1565c0; }
            61.666% { background: #1565c0; }
            63.333% { background: #c62828; }
            65% { background: #c62828; }
            66.666% { background: #1565c0; }
            68.333% { background: #1565c0; }
            70% { background: #c62828; }
            71.666% { background: #c62828; }
            73.333% { background: #1565c0; }
            75% { background: #1565c0; }
            76.666% { background: #c62828; }
            78.333% { background: #c62828; }
            80% { background: #1565c0; }
            81.666% { background: #1565c0; }
            83.333% { background: #c62828; }
            85% { background: #c62828; }
            86.666% { background: #1565c0; }
            88.333% { background: #1565c0; }
            90% { background: #c62828; }
            91.666% { background: #c62828; }
            93.333% { background: #1565c0; }
            95% { background: #1565c0; }
            96.666% { background: #c62828; }
            98.333% { background: #c62828; }
            100% { background: #1565c0; }
        }

        /* 其他样式保持不变 */
        .app-container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 95vh;
            max-height: 900px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 页面容器 */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .page.active {
            display: flex;
        }

        /* 登录注册页面 */
        .auth-container {
            padding: 40px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .auth-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
        }

        .auth-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            color: #333;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f7fafc;
            border-radius: 10px;
            padding: 5px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #718096;
        }

        .auth-tab.active {
            background: #667eea;
            color: white;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #718096;
        }

        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        /* 记住我选项 */
        .remember-me {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .remember-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
        }

        .remember-label {
            color: #4a5568;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        /* 主界面布局 */
        .main-layout {
            display: flex;
            height: 100%;
        }

        /* 桌面端侧边栏 */
        .sidebar {
            width: 250px;
            background: #2d3748;
            color: white;
            padding: 20px 0;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .sidebar::-webkit-scrollbar {
            display: none;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #4a5568;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 600;
        }

        .sidebar-nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #cbd5e0;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .nav-link:hover {
            background: #4a5568;
            color: white;
        }

        .nav-link.active {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            border-radius: 0 8px 8px 0;
            margin-right: 8px;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 0 3px 3px 0;
        }

        .nav-link.active::after {
            content: '●';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #34d399;
            font-size: 12px;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% {
                opacity: 1;
                transform: translateY(-50%) scale(1);
            }
            50% {
                opacity: 0.7;
                transform: translateY(-50%) scale(1.2);
            }
        }

        .nav-link.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        /* 背书功能高亮样式 */
        .highlight-module .nav-link {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
            border-radius: 0 10px 10px 0;
            margin: 4px 8px 4px 0;
            padding: 16px 24px;
            transform: translateY(-2px);
            border-left: 6px solid #d946ef;
        }

        .highlight-module .nav-link:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.7);
            transform: translateY(-4px);
            padding-left: 28px;
        }

        .highlight-module .nav-link.active {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.7);
            border-left-color: #fbbf24;
        }

        .highlight-module .nav-icon {
            font-size: 22px;
            animation: highlight-pulse 1.5s ease-in-out infinite;
            margin-right: 12px;
        }

        /* 为背书功能添加特殊标记 */
        .highlight-module .nav-link::after {
            content: '✨';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            animation: sparkle 2s infinite;
        }

        @keyframes highlight-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.2);
                filter: brightness(1.3);
            }
        }

        @keyframes sparkle {
            0%, 100% {
                opacity: 0.8;
                transform: translateY(-50%) rotate(0deg) scale(1);
            }
            25% {
                opacity: 1;
                transform: translateY(-50%) rotate(90deg) scale(1.2);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-50%) rotate(180deg) scale(1);
            }
            75% {
                opacity: 1;
                transform: translateY(-50%) rotate(270deg) scale(1.2);
            }
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f7fafc;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        .content-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .content-title {
            font-size: 28px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .content-subtitle {
            color: #718096;
            font-size: 16px;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .card-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .card-description {
            color: #718096;
            line-height: 1.6;
        }

        /* 背景音乐状态样式 */
        .bg-music-status {
            margin-left: 8px;
            font-size: 14px;
            color: #4a5568;
            font-weight: 500;
        }
        
        /* 后台管理页面 - 优化版 */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
        }

        /* 桌面端表格 */
        .user-table-desktop {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .table-header {
            background: #667eea;
            color: white;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-content {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            white-space: nowrap;
        }

        tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-badge.active {
            background: #c6f6d5;
            color: #2f855a;
        }

        .status-badge.inactive {
            background: #fed7d7;
            color: #e53e3e;
        }

        .status-badge.banned {
            background: #e53e3e;
            color: white;
        }

        .status-badge.disabled {
            background: #ed8936;
            color: white;
        }

        .user-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .action-btn.ban {
            background: #fed7d7;
            color: #e53e3e;
        }

        .action-btn.ban:hover {
            background: #fc8181;
        }

        .action-btn.unban {
            background: #c6f6d5;
            color: #2f855a;
        }

        .action-btn.unban:hover {
            background: #9ae6b4;
        }

        .action-btn.disable {
            background: #feebc8;
            color: #c05621;
        }

        .action-btn.disable:hover {
            background: #f6ad55;
        }

        .action-btn.enable {
            background: #bee3f8;
            color: #2c5282;
        }

        .action-btn.enable:hover {
            background: #90cdf4;
        }

        .action-btn.delete {
            background: #fed7d7;
            color: #e53e3e;
        }

        .action-btn.delete:hover {
            background: #fc8181;
        }

        /* 手机端卡片布局 */
        .user-cards-mobile {
            display: none;
            gap: 15px;
        }

        .user-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .user-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .user-card-info {
            flex: 1;
        }

        .user-card-id {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .user-card-name {
            font-size: 14px;
            color: #4a5568;
        }

        .user-card-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .user-card-status.active {
            background: #c6f6d5;
            color: #2f855a;
        }

        .user-card-status.inactive {
            background: #fed7d7;
            color: #e53e3e;
        }

        .user-card-status.banned {
            background: #e53e3e;
            color: white;
        }

        .user-card-status.disabled {
            background: #ed8936;
            color: white;
        }

        .user-card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .user-card-detail {
            font-size: 13px;
        }

        .user-card-label {
            color: #718096;
            margin-bottom: 2px;
        }

        .user-card-value {
            color: #2d3748;
            font-weight: 500;
        }

        .user-card-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .user-card-action-btn {
            flex: 1;
            min-width: 80px;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        /* 手机端汉堡菜单 - 完全重写版 */
        .mobile-header {
            display: none;
            background: #2d3748;
            color: white;
            padding: 15px 20px;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1001;
        }

        .mobile-menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 30px;
            height: 30px;
            position: relative;
        }

        .mobile-menu-btn span {
            display: block;
            width: 20px;
            height: 2px;
            background: white;
            margin: 2px 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .mobile-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* 手机端侧边栏 - 关键修复 */
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: #2d3748;
            color: white;
            z-index: 1002;
            transition: left 0.3s ease;
            overflow-y: auto;
            visibility: hidden;
            opacity: 0;
        }

        .mobile-sidebar.active {
            left: 0;
            visibility: visible;
            opacity: 1;
        }

        .mobile-sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .mobile-sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        /* 统一的分页控件样式 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
        }

        .pagination-info {
            color: #718096;
            font-size: 14px;
            margin: 0 5px;
            display: flex;
            align-items: center;
        }

        .pagination-btn {
            padding: 8px 14px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            min-width: 36px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f7fafc;
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.15);
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .page-numbers-container {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pagination-input {
            width: 60px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
            transition: border-color 0.2s ease;
        }

        .pagination-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .go-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .go-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }

        /* 响应式设计 */
        @media (max-width: 600px) {
            .pagination {
                flex-wrap: wrap;
                gap: 6px;
                padding: 10px;
            }
            
            .pagination-btn {
                padding: 6px 10px;
                min-width: 32px;
                font-size: 13px;
            }
            
            .pagination-info {
                font-size: 13px;
                margin: 0 3px;
            }
            
            .pagination-input {
                width: 50px;
                padding: 6px;
                font-size: 13px;
            }
            
            .go-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* 试卷选择页面 */
        .exam-selection {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .exam-selection h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
        }

        .exam-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            flex: 1;
        }

        .exam-card {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
        }

        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #5a67d8;
        }

        .exam-icon {
            font-size: 32px;
            margin-bottom: 12px;
            text-align: center;
        }

        .exam-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .exam-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .exam-description {
            color: #718096;
            font-size: 14px;
            margin-bottom: 12px;
            flex: 1;
        }

        .exam-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .exam-question-count {
            font-size: 13px;
            color: #4a5568;
        }

        .exam-status {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .exam-status.available {
            background: #c6f6d5;
            color: #2f855a;
        }

        /* 答题界面样式保持不变 */
        .exam-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .header {
            background: #5a67d8;
            color: white;
            padding: 12px 15px;
            position: relative;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .exam-title {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .progress-container {
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 13px;
            opacity: 0.9;
        }

        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            position: relative;
            height: calc(100% - 120px);
            padding-bottom: 80px;
        }

        .content {
            padding: 18px 15px;
            padding-bottom: 80px;
        }

        .question-type {
            display: inline-block;
            background: #5a67d8;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .question-number {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .question-text {
            font-size: 17px;
            font-weight: 500;
            margin-bottom: 18px;
            line-height: 1.5;
            color: #2d3748;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .option.selected {
            background: #e6fffa;
            border-color: #5a67d8;
        }

        .option.correct {
            background: #c6f6d5;
            border-color: #38a169;
        }

        .option.incorrect {
            background: #fed7d7;
            border-color: #e53e3e;
        }

        .option-label {
            width: 30px;
            height: 30px;
            background: #5a67d8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
            font-size: 15px;
            color: #2d3748;
        }

        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 12px 15px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 110px;
            justify-content: center;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .nav-btn-secondary:hover {
            background: #cbd5e0;
        }

        .nav-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .nav-btn-primary:hover {
            background: #4c51bf;
        }

        /* 语音方案相关样式 */
        .speech-scheme-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }

        .speech-scheme-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speech-scheme-btn {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f5f7fa;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .speech-scheme-btn:hover {
            background-color: #e4e7eb;
            border-color: #90caf9;
        }

        .speech-scheme-btn.active {
            background-color: #1976d2;
            color: white;
            border-color: #1976d2;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
        }

        .preview-btn {
            position: relative;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background-color: #4caf50;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .preview-btn:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        .preview-btn:active {
            transform: scale(0.95);
        }

        .preview-btn.playing {
            background-color: #f44336;
            animation: pulse 1s infinite;
        }

        .play-icon {
            font-size: 14px;
            line-height: 1;
        }

        .playing-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .preview-btn.playing .playing-indicator {
            opacity: 1;
            animation: ripple 1s infinite;
        }

        .preview-btn.playing .play-icon {
            opacity: 0;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }

        @keyframes ripple {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
            }
        }

        .speech-scheme-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 6px;
            font-size: 13px;
            color: #1565c0;
        }

        /* 语音播放状态弹窗样式 */
        .voice-status-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 15px;
        }

        .voice-status-modal.active {
            display: flex;
        }

        .voice-status-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .voice-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e4e7eb;
        }

        .voice-status-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .voice-status-body {
            text-align: center;
            margin-bottom: 25px;
        }

        .voice-status-icon {
            font-size: 56px;
            margin-bottom: 20px;
        }

        .voice-status-message {
            font-size: 16px;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .voice-status-footer {
            display: flex;
            justify-content: center;
        }

        .voice-status-btn {
            padding: 12px 30px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-status-btn:hover {
            background-color: #45a049;
        }

        .voice-status-btn:active {
            transform: scale(0.95);
        }

        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
        }

        .close-modal-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #718096;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal-btn:hover {
            color: #2d3748;
        }

        /* 警灯设置样式 */
        .police-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .police-setting-label {
            font-size: 16px;
            font-weight: 500;
            color: #2d3748;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: #ccc;
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .password-section {
            margin-top: 20px;
            display: none;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .password-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .password-btn:hover {
            background: #5a67d8;
        }

        /* 公告样式 */
        .notice-content {
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            line-height: 1.8;
        }

        .notice-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .notice-item {
            margin-bottom: 10px;
            color: #4a5568;
        }

        .notice-date {
            text-align: right;
            margin-top: 20px;
            color: #718096;
            font-size: 14px;
        }
        
        /* 公告子项样式 */
        .notice-subitem {
            margin-bottom: 8px;
            margin-left: 25px;
            color: #6b7280;
            font-size: 15px;
        }

        /* 管理员密码验证样式 */
        .admin-password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .admin-password-modal.active {
            display: flex;
        }

        .admin-password-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .admin-password-title {
            font-size: 22px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .admin-password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .admin-password-buttons {
            display: flex;
            gap: 10px;
        }

        .admin-password-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-password-btn.cancel {
            background: #e2e8f0;
            color: #4a5568;
        }

        .admin-password-btn.cancel:hover {
            background: #cbd5e0;
        }

        .admin-password-btn.confirm {
            background: #667eea;
            color: white;
        }

        .admin-password-btn.confirm:hover {
            background: #5a67d8;
        }

        /* 删除确认模态框 */
        .delete-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .delete-confirm-modal.active {
            display: flex;
        }

        .delete-confirm-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .delete-confirm-title {
            font-size: 22px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .delete-confirm-text {
            color: #718096;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .delete-confirm-buttons {
            display: flex;
            gap: 10px;
        }

        .delete-confirm-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-confirm-btn.cancel {
            background: #e2e8f0;
            color: #4a5568;
        }

        .delete-confirm-btn.cancel:hover {
            background: #cbd5e0;
        }

        .delete-confirm-btn.confirm {
            background: #e53e3e;
            color: white;
        }

        .delete-confirm-btn.confirm:hover {
            background: #c53030;
        }

        /* 封号提示模态框 */
        .banned-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 15px;
        }

        .banned-modal.active {
            display: flex;
        }

        .banned-content {
            background: white;
            border-radius: 18px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
        }

        .banned-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: shake 0.5s ease-in-out infinite alternate;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            100% { transform: translateX(10px); }
        }

        .banned-title {
            font-size: 24px;
            font-weight: 700;
            color: #e53e3e;
            margin-bottom: 15px;
        }

        .banned-message {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 16px;
        }

        .banned-details {
            background: #fed7d7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: left;
        }

        .banned-details h4 {
            color: #c53030;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .banned-details ul {
            list-style: none;
            padding: 0;
        }

        .banned-details li {
            color: #742a2a;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .banned-details li:before {
            content: '⚠️';
            position: absolute;
            left: 0;
        }

        .banned-contact {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
        }

        .banned-contact h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .banned-contact p {
            color: #4a5568;
            margin-bottom: 5px;
        }

        .banned-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .banned-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        /* 禁止答题提示模态框 */
        .disabled-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 15px;
        }

        .disabled-modal.active {
            display: flex;
        }

        .disabled-content {
            background: white;
            border-radius: 18px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
        }

        .disabled-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .disabled-title {
            font-size: 24px;
            font-weight: 700;
            color: #c05621;
            margin-bottom: 15px;
        }

        .disabled-message {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 16px;
        }

        .disabled-details {
            background: #feebc8;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: left;
        }

        .disabled-details h4 {
            color: #c05621;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .disabled-details ul {
            list-style: none;
            padding: 0;
        }

        .disabled-details li {
            color: #7c2d12;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .disabled-details li:before {
            content: '⚠️';
            position: absolute;
            left: 0;
        }

        .disabled-contact {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
        }

        .disabled-contact h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .disabled-contact p {
            color: #4a5568;
            margin-bottom: 5px;
        }

        .disabled-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .disabled-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        /* 操作成功提示模态框 */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .success-modal.active {
            display: flex;
        }

        .success-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .success-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #48bb78;
        }

        .success-title {
            font-size: 22px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .success-message {
            color: #4a5568;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .success-btn {
            width: 100%;
            padding: 12px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .success-btn:hover {
            background: #38a169;
        }

        /* 加载动画 */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-container.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #5a67d8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            color: #718096;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 密码输入弹窗 */
        .password-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .password-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 18px;
            text-align: center;
            color: #2d3748;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .password-error {
            color: #e53e3e;
            font-size: 14px;
            margin-bottom: 18px;
            text-align: center;
            display: none;
        }

        .password-actions {
            display: flex;
            gap: 12px;
        }

        .password-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .password-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .password-btn-primary:hover {
            background: #4c51bf;
        }

        .password-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .password-btn-secondary:hover {
            background: #cbd5e0;
        }

        /* 设置模态框 */
        .settings-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #2d3748;
        }

        /* 顾老太太打乱设置区域 */
        .grandma-shuffle-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #e6f7ff 100%);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 20px;
            border: 2px solid #5a67d8;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.15);
            position: relative;
            overflow: hidden;
        }

        .grandma-shuffle-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #5a67d8, #9f7aea);
        }

        .grandma-shuffle-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .grandma-icon {
            font-size: 24px;
            color: #5a67d8;
        }

        .grandma-title {
            font-size: 17px;
            font-weight: 600;
            color: #2d3748;
        }

        .grandma-description {
            font-size: 13px;
            color: #4a5568;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .grandma-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grandma-toggle-label {
            font-size: 15px;
            color: #2d3748;
            font-weight: 500;
        }

        .grandma-toggle {
            width: 55px;
            height: 28px;
            background: #cbd5e0;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .grandma-toggle.active {
            background: #5a67d8;
            box-shadow: 0 0 10px rgba(90, 103, 216, 0.3);
        }

        .grandma-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .grandma-toggle.active .grandma-toggle-slider {
            transform: translateX(27px);
        }

        .grandma-status {
            font-size: 12px;
            color: #718096;
            margin-top: 8px;
            font-style: italic;
        }

        /* 普通设置项 */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 15px;
            color: #4a5568;
            font-weight: 500;
        }

        .toggle-switch {
            width: 48px;
            height: 24px;
        }
        
        /* 语音方案切换按钮样式 */
        .scheme-buttons {
            display: flex;
            gap: 8px;
        }
        
        .scheme-btn {
            padding: 6px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background-color: white;
            color: #4a5568;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .scheme-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background-color: #f7fafc;
        }
        
        .scheme-btn.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }
            background: #cbd5e0;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #5a67d8;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .sound-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        /* 背书功能样式 - 优化版 */
        
        /* 统计计算区域样式 */
        .recite-stats {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .stat-item {
            text-align: center;
            min-width: 120px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }
        
        .stat-value.good {
            color: #38a169;
        }
        
        .stat-value.average {
            color: #ed8936;
        }
        
        .stat-value.need-improvement {
            color: #e53e3e;
        }
        
        .recite-main {
            padding: 20px 0;
        }

        /* 方案1：卡片式按钮设计 */
        .recite-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: #f7fafc;
            padding: 5px;
            border-radius: 12px;
        }

        .recite-tab {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #4a5568;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .recite-tab:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .recite-tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .recite-tab:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .recite-content {
            display: none;
        }

        .recite-content.active {
            display: block;
        }

        /* 名词解释样式 - 优化版 */
        .noun-main-tags-with-search {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .noun-main-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* 搜索样式 */
        .search-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            font-size: 14px;
            width: 200px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: #667eea;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .search-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        /* 主标签按钮 - 优化版 */
        .noun-tag {
            padding: 12px 24px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .noun-tag:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .noun-tag.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        /* 子标签区域 - 优化版 */
        .noun-subtags-section {
            margin-bottom: 25px;
        }

        .noun-subtags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* 子标签按钮 - 优化版 */
        .noun-subtag {
            padding: 10px 20px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            text-align: center;
        }

        .noun-subtag:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.15);
        }

        .noun-subtag.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.2);
        }

        /* 项目内容区域 - 优化版 */
        .noun-items-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* 方案1：卡片式按钮网格布局 - 优化版 */
        .noun-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        /* 空状态样式 */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            color: #a0aec0;
            border-radius: 16px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            position: relative;
            overflow: hidden;
        }

        .empty-state::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(160, 174, 192, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.8;
            display: block;
            position: relative;
            z-index: 1;
            animation: bounce 3s ease-in-out infinite;
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .empty-state-subtext {
            font-size: 14px;
            opacity: 0.7;
            position: relative;
            z-index: 1;
        }

        /* 分类个性化空状态 */
        .empty-state.marketing {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
        }

        .empty-state.marketing .empty-state-icon {
            color: #f97316;
        }

        .empty-state.service {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .empty-state.service .empty-state-icon {
            color: #3b82f6;
        }

        .empty-state.shop {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .empty-state.shop .empty-state-icon {
            color: #22c55e;
        }

        .empty-state.ps {
            background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);
        }

        .empty-state.ps .empty-state-icon {
            color: #a855f7;
        }

        /* 动画效果 */
        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(20px, -20px) rotate(5deg);
            }
            50% {
                transform: translate(0, 20px) rotate(0deg);
            }
            75% {
                transform: translate(-20px, -20px) rotate(-5deg);
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-10px) scale(1.05);
            }
        }

        /* 方案1：卡片式名词项 - 优化版 */
        .noun-item {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-height: 150px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .noun-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #9f7aea);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .noun-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            border-color: #667eea;
        }

        .noun-item:hover::before {
            transform: scaleX(1);
        }

        .noun-item-icon {
            font-size: 36px;
            z-index: 1;
        }

        .noun-item-name {
            font-size: 15px;
            font-weight: 600;
            color: #2d3748;
            z-index: 1;
            line-height: 1.4;
        }

        /* 方案2：悬浮式操作按钮 */
        .floating-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #667eea;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .floating-btn.secondary {
            background: #48bb78;
        }

        .floating-btn.secondary:hover {
            background: #38a169;
        }

        /* 响应式设计优化 */
        @media (max-width: 768px) {
            .noun-items-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .noun-tag {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .noun-subtag {
                padding: 8px 16px;
                font-size: 13px;
                min-width: 70px;
            }
            
            .floating-actions {
                bottom: 20px;
                right: 20px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        .recite-notice {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .recite-notice h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .recite-notice p {
            color: #718096;
        }

        /* 名词解释详情模态框 */
        .noun-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        .noun-detail-modal.active {
            display: flex;
        }

        .noun-detail-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        /* 名词详情内容过渡动画 */
        .noun-detail-title,
        .noun-detail-text {
            transition: all 0.3s ease;
        }
        
        /* 导航控制区域 */
        .noun-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #f7fafc;
        }
        
        /* 左右箭头导航按钮样式 - 优化设计 */
        .noun-nav-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            min-width: 120px;
        }
        
        .noun-nav-btn:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .noun-nav-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .noun-nav-btn:disabled {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
        }
        
        /* 导航图标样式 */
        .nav-btn-icon {
            font-size: 18px;
        }
        
        /* 进度指示器 */
        .noun-progress {
            color: #718096;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .noun-detail-content {
                padding: 20px;
            }
            
            .noun-nav-btn {
                padding: 10px 16px;
                min-width: 100px;
                font-size: 14px;
            }
            
            .noun-navigation {
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .noun-nav-btn {
                padding: 8px 12px;
                min-width: 80px;
                font-size: 13px;
                flex-direction: column;
                gap: 4px;
            }
            
            .noun-navigation {
                gap: 8px;
            }
        }

        .noun-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }

        .noun-detail-title {
            font-size: 24px;
            font-weight: 600;
            color: #2d3748;
        }

        .noun-detail-text {
            font-size: 16px;
            line-height: 1.8;
            color: #4a5568;
            margin-bottom: 25px;
            white-space: pre-line;
        }

        .noun-detail-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .play-btn {
            width: 100%;
            padding: 15px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .play-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .skip-btn {
            width: 100%;
            padding: 12px;
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .skip-btn.active {
            opacity: 1;
            pointer-events: auto;
        }

        .skip-btn:hover {
            background: #cbd5e0;
        }

        /* 背书测试样式 */
        .recite-test-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .recite-test-modal.active {
            display: flex;
        }

        .recite-test-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .test-title {
            font-size: 22px;
            font-weight: 600;
            color: #2d3748;
        }

        .test-question {
            font-size: 18px;
            font-weight: 500;
            color: #2d3748;
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }

        .test-result {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            min-height: 100px;
            font-size: 16px;
            line-height: 1.6;
            color: #4a5568;
            background: #f0fff4;
            border: 2px solid #c6f6d5;
        }

        .test-audio-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .audio-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .start-btn {
            background: #48bb78;
            color: white;
        }

        .start-btn:hover {
            background: #38a169;
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stop-btn {
            background: #e53e3e;
            color: white;
        }

        .stop-btn:hover {
            background: #c53030;
        }

        .test-footer {
            display: flex;
            gap: 10px;
        }

        .test-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-test-btn {
            background: #e2e8f0;
            color: #4a5568;
        }

        .close-test-btn:hover {
            background: #cbd5e0;
        }

        .retry-btn {
            background: #667eea;
            color: white;
        }

        .retry-btn:hover {
            background: #5a67d8;
        }

        .submit-btn {
            background: #48bb78;
            color: white;
        }

        .submit-btn:hover {
            background: #38a169;
        }

        .submit-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* 输入标签样式调整 */
        .input-label {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            margin-bottom: 10px;
            font-weight: 500;
        }



        .test-score {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }

        .score-main {
            margin-bottom: 15px;
        }

        .score-details {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .score-detail-item {
            text-align: center;
        }

        .score-detail-label {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .score-detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .score-detail-value.correct {
            color: #38a169;
        }

        .score-detail-value.incorrect {
            color: #e53e3e;
        }

        .test-input-section {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            color: #718096;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .test-input {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            background: #fafbfc;
            transition: all 0.3s ease;
        }

        .test-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .score-text {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 36px;
            font-weight: 700;
            color: #667eea;
        }

        .match-status {
            margin-bottom: 15px;
        }

        .match-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .match-char {
            font-size: 18px;
            font-weight: 500;
        }

        .match-char.correct {
            color: #38a169;
        }

        .match-char.incorrect {
            color: #e53e3e;
        }

        .match-char.missing {
            color: #a0aec0;
        }

        /* 匹配详情样式 */
        .match-detail {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        /* 匹配摘要样式 */
        .match-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .match-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-label {
            font-weight: 500;
            color: #4a5568;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .stat-value.correct {
            color: #38a169;
        }

        .stat-value.incorrect {
            color: #e53e3e;
        }

        /* 评分反馈样式 */
        .score-feedback {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
        }

        .feedback.excellent {
            background: #c6f6d5;
            color: #2f855a;
        }

        .feedback.good {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .feedback.average {
            background: #feebc8;
            color: #c05621;
        }

        .feedback.need-improvement {
            background: #fed7d7;
            color: #c53030;
        }

        /* 答案对比样式 */
        .answer-comparison {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #e2e8f0;
        }

        .answer-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .answer-content {
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
            border-radius: 6px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .correct-answer {
            background: #f0fff4;
            color: #2f855a;
        }

        .your-answer {
            background: #ebf8ff;
            color: #2b6cb0;
        }

        /* 倒计时样式 */
        .countdown-number {
            font-weight: 700;
            color: #e53e3e;
        }

        /* 语音播放小弹窗样式 */
        .voice-play-modal {
            position: relative;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10;
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin: 15px auto;
            width: fit-content;
        }

        .voice-play-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .voice-icon {
            font-size: 18px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .voice-text {
            white-space: nowrap;
        }

        /* 语音控制按钮样式 */
        .voice-controls {
            position: relative;
            display: flex;
            gap: 10px;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin: 15px 0;
        }

        .voice-controls.active {
            opacity: 1;
            visibility: visible;
        }

        .voice-control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            min-width: 120px;
        }

        .voice-control-btn.primary {
            background: #48bb78;
            color: white;
        }

        .voice-control-btn.secondary {
            background: #667eea;
            color: white;
        }

        .voice-control-btn.tertiary {
            background: #ed8936;
            color: white;
        }

        .voice-control-btn:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* 确认弹窗样式 */
        .modal-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-body p {
            font-size: 16px;
            line-height: 1.8;
            color: #4a5568;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.cancel {
            background: #e2e8f0;
            color: #4a5568;
        }

        .action-btn.cancel:hover {
            background: #cbd5e0;
        }

        .action-btn.confirm {
            background: #667eea;
            color: white;
        }

        .action-btn.confirm:hover {
            background: #5a67d8;
        }

        /* 声音按钮样式 */
        .sound-btn {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .sound-btn:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .sound-btn.active {
            border-color: #5a67d8;
            background: #e6fffa;
        }

        .sound-preview {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sound-preview:hover {
            background: #cbd5e0;
        }

        .sound-preview.playing {
            animation: spin 1s linear infinite;
        }

        .close-settings-btn {
            width: 100%;
            padding: 12px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 18px;
        }

        .close-settings-btn:hover {
            background: #4c51bf;
        }

        /* 10086版本特殊功能 - 人物脸部状态 */
        .character-face {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: #ffdbac;
            border-radius: 50%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10;
            overflow: hidden;
        }

        .character-face.normal {
            background: #ffdbac;
            border-radius: 50%;
            width: 80px;
            height: 80px;
        }

        /* 肿胀动画 */
        .character-face.swollen {
            background: #ff9e80;
            border-radius: 60%;
            width: 110px;
            height: 110px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            animation: swell 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                            radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                            radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
        }

        /* 恢复动画 */
        .character-face.recovering {
            animation: recover 2s ease-in-out forwards;
        }

        @keyframes swell {
            0% {
                border-radius: 50%;
                width: 80px;
                height: 80px;
                background: #ffdbac;
                transform: scale(1);
            }
            30% {
                border-radius: 70%;
                width: 100px;
                height: 100px;
                background: #ff9e80;
                transform: scale(1.1);
            }
            60% {
                border-radius: 65%;
                width: 115px;
                height: 115px;
                background: #ff8a65;
                transform: scale(1.2);
            }
            100% {
                border-radius: 60%;
                width: 110px;
                height: 110px;
                background: #ff9e80;
                transform: scale(1.15);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                                radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
            }
        }

        @keyframes recover {
            0% {
                border-radius: 60%;
                width: 110px;
                height: 110px;
                background: #ff9e80;
                transform: scale(1.15);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                                radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
            }
            25% {
                border-radius: 65%;
                width: 100px;
                height: 100px;
                background: #ffa270;
                transform: scale(1.1);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7) 0%, transparent 25%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.5) 0%, transparent 20%),
                                radial-gradient(circle at 50% 50%, rgba(255, 160, 120, 0.7) 0%, #ffa270 70%);
            }
            50% {
                border-radius: 70%;
                width: 90px;
                height: 90px;
                background: #ffb090;
                transform: scale(1.05);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, transparent 30%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.4) 0%, transparent 25%),
                                radial-gradient(circle at 50% 50%, rgba(255, 170, 140, 0.6) 0%, #ffb090 70%);
            }
            75% {
                border-radius: 80%;
                width: 85px;
                height: 85px;
                background: #ffc0a0;
                transform: scale(1.02);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 35%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.3) 0%, transparent 30%),
                                radial-gradient(circle at 50% 50%, rgba(255, 180, 160, 0.5) 0%, #ffc0a0 70%);
            }
            100% {
                border-radius: 50%;
                width: 80px;
                height: 80px;
                background: #ffdbac;
                transform: scale(1);
                background-image: none;
            }
        }

        .face-eyes {
            display: flex;
            justify-content: space-around;
            width: 60%;
            margin-bottom: 10px;
        }

        .face-eye {
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            transition: all 0.5s;
        }

        /* 肿胀时的眼睛效果 */
        .character-face.swollen .face-eye {
            width: 6px;
            height: 4px;
            border-radius: 50%;
            background: #333;
            transform: translateY(2px);
            box-shadow: 0 0 3px rgba(255, 0, 0, 0.6);
        }

        /* 恢复时的眼睛效果 */
        .character-face.recovering .face-eye {
            animation: eyeRecover 2s ease-in-out forwards;
        }

        @keyframes eyeRecover {
            0% {
                width: 6px;
                height: 4px;
                border-radius: 50%;
                background: #333;
                transform: translateY(2px);
                box-shadow: 0 0 3px rgba(255, 0, 0, 0.6);
            }
            50% {
                width: 9px;
                height: 8px;
                border-radius: 50%;
                background: #333;
                transform: translateY(1px);
                box-shadow: 0 0 2px rgba(255, 0, 0, 0.3);
            }
            100% {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #333;
                transform: translateY(0);
                box-shadow: none;
            }
        }

        .face-mouth {
            width: 30px;
            height: 15px;
            border-bottom: 3px solid #333;
            border-radius: 0 0 30px 30px;
            transition: all 0.5s;
        }

        /* 肿胀时的嘴巴效果 */
        .character-face.swollen .face-mouth {
            width: 20px;
            height: 10px;
            border-bottom: 3px solid #333;
            border-radius: 0 0 20px 20px;
            transform: rotate(-5deg);
            border-left: 2px solid #333;
            border-right: 2px solid #333;
        }

        /* 恢复时的嘴巴效果 */
        .character-face.recovering .face-mouth {
            animation: mouthRecover 2s ease-in-out forwards;
        }

        @keyframes mouthRecover {
            0% {
                width: 20px;
                height: 10px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 20px 20px;
                transform: rotate(-5deg);
                border-left: 2px solid #333;
                border-right: 2px solid #333;
            }
            50% {
                width: 25px;
                height: 12px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 25px 25px;
                transform: rotate(-2deg);
                border-left: 1px solid #333;
                border-right: 1px solid #333;
            }
            100% {
                width: 30px;
                height: 15px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 30px 30px;
                transform: rotate(0deg);
                border-left: none;
                border-right: none;
            }
        }

        /* 特殊弹窗 */
        .special-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: specialToastAppear 0.5s ease-out;
            max-width: 80%;
            transition: opacity 1.5s ease-out, transform 1.5s ease-out;
            cursor: pointer;
        }

        .special-toast.hiding {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
        }

        @keyframes specialToastAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* 音频激活按钮 */
        .audio-activation-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(90, 103, 216, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(90, 103, 216, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(90, 103, 216, 0);
            }
        }

        .audio-activation-btn:hover {
            background: #4c51bf;
            transform: scale(1.1);
        }

        .audio-activation-btn:active {
            transform: scale(0.95);
        }

        /* 语音状态指示器 */
        .voice-status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .voice-status-indicator.show {
            display: flex;
        }

        .voice-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* 响应式设计 - 优化版 */
        @media (max-width: 1024px) {
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            /* 隐藏桌面端侧边栏 */
            .sidebar {
                display: none;
            }
            
            /* 显示手机端头部 */
            .mobile-header {
                display: flex;
            }
            
            /* 主内容区调整 */
            .main-layout {
                flex-direction: column;
            }
            
            .main-content {
                padding: 20px 15px;
            }
            
            /* 统计卡片调整 */
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .stat-card {
                padding: 15px 10px;
            }
            
            .stat-number {
                font-size: 24px;
            }
            
            .stat-label {
                font-size: 12px;
            }
            
            /* 隐藏桌面端表格，显示手机端卡片 */
            .user-table-desktop {
                display: none;
            }
            
            .user-cards-mobile {
                display: flex;
                flex-direction: column;
            }
            
            /* 内容头部调整 */
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .content-title {
                font-size: 22px;
            }
            
            .content-subtitle {
                font-size: 14px;
            }
            
            .refresh-btn {
                font-size: 13px;
                padding: 6px 12px;
            }
            
            /* 分页控件调整 */
            .pagination {
                padding: 10px;
                gap: 5px;
            }
            
            .pagination-btn {
                padding: 6px 10px;
                font-size: 13px;
                min-width: 35px;
            }
            
            .pagination-info {
                font-size: 12px;
                margin: 0 5px;
            }
        }

        @media (max-width: 480px) {
            /* 统计卡片单列显示 */
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            /* 用户卡片调整 */
            .user-card {
                padding: 15px;
            }
            
            .user-card-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .user-card-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .user-card-action-btn {
                min-width: auto;
            }
            
            /* 内容标题调整 */
            .content-title {
                font-size: 20px;
            }
            
            .content-subtitle {
                font-size: 13px;
            }
            
            /* 分页控件进一步优化 */
            .pagination {
                flex-wrap: wrap;
                gap: 3px;
            }
            
            .pagination-btn {
                padding: 5px 8px;
                font-size: 12px;
                min-width: 30px;
            }
            
            .pagination-info {
                font-size: 11px;
                width: 100%;
                text-align: center;
                margin: 5px 0 0 0;
            }
        }

        /* 平板端适配 */
        @media (min-width: 769px) and (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                padding: 25px 20px;
            }
            
            .admin-stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* 搜索结果样式 */
        .search-result-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .search-result-list {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: #f7fafc;
        }
        
        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
            border-radius: 0 0 8px 8px;
        }
        
        .search-result-item:hover {
            background: #f7fafc;
            transform: translateX(5px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .search-result-name {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .search-result-preview {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .search-highlight {
            background-color: #fef5e7;
            color: #ed8936;
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .search-result-empty {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
            font-size: 16px;
        }
        
        /* 搜索建议样式 */
        .search-container {
            position: relative;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 250px;
            overflow-y: auto;
            z-index: 999;
            display: none;
        }
        
        .search-suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f7fafc;
        }
        
        .search-suggestion-item:last-child {
            border-bottom: none;
        }
        
        .search-suggestion-item:hover {
            background-color: #f7fafc;
        }
        
        .search-suggestion-name {
            font-size: 14px;
            color: #2d3748;
            font-weight: 500;
        }
        
        .search-suggestion-preview {
            font-size: 12px;
            color: #718096;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* 模态框底部按钮样式 */
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }
        
        .search-more-btn {
            padding: 8px 16px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .search-more-btn:hover {
            background-color: #5a67d8;
        }
        
        /* 搜索结果容器样式 */
        .search-results-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .search-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .search-results-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .close-search-results {
            background: none;
            border: none;
            font-size: 24px;
            color: #718096;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .close-search-results:hover {
            background: #f7fafc;
            color: #2d3748;
        }
        
        .search-results-content {
            max-height: 500px;
            overflow-y: auto;
        }
        
        /* 搜索结果列表样式 */
        .search-results-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .search-result-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .search-result-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }
        
        .search-result-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .search-result-name {
            font-size: 14px;
            font-weight: 500;
            color: #2d3748;
        }
        
        /* 空搜索结果样式 */
        .search-result-empty {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
            font-size: 16px;
        }
        
        /* 搜索结果高亮样式 */
        .search-highlight {
            background-color: #fef08a;
            color: #92400e;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 登录注册页面 -->
        <div id="authPage" class="page active">
            <div class="auth-container">
                <h1 class="auth-title">综合管理系统</h1>
                <div class="auth-form">
                    <div class="auth-tabs">
                        <div class="auth-tab active" onclick="switchAuthTab('login')">登录</div>
                        <div class="auth-tab" onclick="switchAuthTab('register')">注册</div>
                    </div>
                    
                    <form id="authForm" onsubmit="handleAuth(event)">
                        <div class="form-group">
                            <label class="form-label">账号</label>
                            <input type="text" class="form-input" id="authAccount" placeholder="请输入手机号或邮箱" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">密码</label>
                            <input type="password" class="form-input" id="authPassword" placeholder="请输入密码" required>
                        </div>
                        
                        <div id="rememberMeContainer" class="remember-me">
                            <input type="checkbox" id="rememberMe" class="remember-checkbox">
                            <label for="rememberMe" class="remember-label">记住我（保存登录信息）</label>
                        </div>
                        
                        <div id="registerFields" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">确认密码</label>
                                <input type="password" class="form-input" id="confirmPassword" placeholder="请再次输入密码">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">用户名</label>
                                <input type="text" class="form-input" id="username" placeholder="请输入用户名">
                            </div>
                        </div>
                        
                        <button type="submit" class="auth-btn" id="authSubmitBtn">登录</button>
                    </form>
                    
                    <div class="auth-switch">
                        <span id="authSwitchText">还没有账号？</span>
                        <a href="#" onclick="switchAuthMode()">立即注册</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主功能页面 -->
        <div id="mainPage" class="page">
            <!-- 手机端头部 -->
            <div class="mobile-header">
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="mobile-title">综合管理系统</div>
                <div style="width: 30px;"></div>
            </div>

            <!-- 手机端侧边栏遮罩 -->
            <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="toggleMobileSidebar()"></div>

            <!-- 手机端侧边栏 -->
            <div class="mobile-sidebar" id="mobileSidebar">
                <div class="mobile-sidebar-header">
                    <h2 class="sidebar-title">功能模块</h2>
                    <button class="mobile-close-btn" onclick="toggleMobileSidebar()">×</button>
                </div>
                <nav>
                    <ul class="sidebar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" onclick="showModule('logistics')">
                                <span class="nav-icon">📦</span>
                                <span>物流</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showModule('ps')">
                                <span class="nav-icon">🎨</span>
                                <span>PS</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showModule('network')">
                                <span class="nav-icon">📍</span>
                                <span>网点</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showModule('marketing')">
                                <span class="nav-icon">📈</span>
                                <span>营销</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showModule('service')">
                                <span class="nav-icon">🎧</span>
                                <span>客服</span>
                            </a>
                        </li>
                        <li class="nav-item highlight-module">
                            <a class="nav-link" onclick="showModule('recite')">
                                <span class="nav-icon">📚</span>
                                <span>背书功能</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showModule('exam')">
                                <span class="nav-icon">📝</span>
                                <span>试卷系统</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="adminNavMobile" onclick="showAdminPasswordModal()">
                                <span class="nav-icon">⚙️</span>
                                <span>后台管理</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="openSettings()">
                                <span class="nav-icon">⚙️</span>
                                <span>设置</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showUpdateNotice()">
                                <span class="nav-icon">📢</span>
                                <span>更新公告</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="logout()">
                                <span class="nav-icon">🚪</span>
                                <span>退出登录</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="main-layout">
                <!-- 桌面端侧边栏 -->
                <aside class="sidebar">
                    <div class="sidebar-header">
                        <h2 class="sidebar-title">功能模块</h2>
                    </div>
                    <nav>
                        <ul class="sidebar-nav">
                            <li class="nav-item">
                                <a class="nav-link active" onclick="showModule('logistics')">
                                    <span class="nav-icon">📦</span>
                                    <span>物流</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showModule('ps')">
                                    <span class="nav-icon">🎨</span>
                                    <span>PS</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showModule('network')">
                                    <span class="nav-icon">📍</span>
                                    <span>网点</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showModule('marketing')">
                                    <span class="nav-icon">📈</span>
                                    <span>营销</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showModule('service')">
                                    <span class="nav-icon">🎧</span>
                                    <span>客服</span>
                                </a>
                            </li>
                            <li class="nav-item highlight-module">
                                <a class="nav-link" onclick="showModule('recite')">
                                    <span class="nav-icon">📚</span>
                                    <span>背书功能</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showModule('exam')">
                                    <span class="nav-icon">📝</span>
                                    <span>试卷系统</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="adminNav" onclick="showAdminPasswordModal()">
                                    <span class="nav-icon">⚙️</span>
                                    <span>后台管理</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="openSettings()">
                                    <span class="nav-icon">⚙️</span>
                                    <span>设置</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="showUpdateNotice()">
                                    <span class="nav-icon">📢</span>
                                    <span>更新公告</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="logout()">
                                    <span class="nav-icon">🚪</span>
                                    <span>退出登录</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </aside>
                
                <main class="main-content">
                    <!-- 物流模块 -->
                    <div id="logisticsModule" class="module-content">
                        <div class="content-header">
                            <h1 class="content-title">物流管理</h1>
                            <p class="content-subtitle">管理您的物流配送和仓储服务</p>
                        </div>
                        <div class="card-grid">
                            <div class="card">
                                <div class="card-icon">📦</div>
                                <h3 class="card-title">项目 1</h3>
                                <p class="card-description">物流配送服务，快速高效地将货物送达目的地</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🏭</div>
                                <h3 class="card-title">项目 2</h3>
                                <p class="card-description">仓储管理服务，提供安全可靠的货物存储</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🚚</div>
                                <h3 class="card-title">项目 3</h3>
                                <p class="card-description">运输调度服务，优化配送路线提高效率</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📊</div>
                                <h3 class="card-title">项目 4</h3>
                                <p class="card-description">物流数据分析，实时监控配送状态</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PS模块 -->
                    <div id="psModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">PS设计</h1>
                            <p class="content-subtitle">专业的图像处理和设计服务</p>
                        </div>
                        <div class="card-grid">
                            <div class="card">
                                <div class="card-icon">🎨</div>
                                <h3 class="card-title">项目 1</h3>
                                <p class="card-description">平面设计服务，包括海报、宣传册等设计</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🖼️</div>
                                <h3 class="card-title">项目 2</h3>
                                <p class="card-description">图片处理服务，专业修图和美化</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🌐</div>
                                <h3 class="card-title">项目 3</h3>
                                <p class="card-description">网页设计服务，打造精美的网站界面</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📱</div>
                                <h3 class="card-title">项目 4</h3>
                                <p class="card-description">UI/UX设计，优化用户体验</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 网点模块 -->
                    <div id="networkModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">网点管理</h1>
                            <p class="content-subtitle">管理您的服务网点和门店</p>
                        </div>
                        <div class="card-grid">
                            <div class="card">
                                <div class="card-icon">📍</div>
                                <h3 class="card-title">项目 1</h3>
                                <p class="card-description">网点分布管理，优化服务覆盖范围</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🏪</div>
                                <h3 class="card-title">项目 2</h3>
                                <p class="card-description">门店运营管理，提升服务质量</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🗺️</div>
                                <h3 class="card-title">项目 3</h3>
                                <p class="card-description">区域规划服务，合理布局网点</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📈</div>
                                <h3 class="card-title">项目 4</h3>
                                <p class="card-description">业绩分析，提升网点效益</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 营销模块 -->
                    <div id="marketingModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">营销推广</h1>
                            <p class="content-subtitle">全方位的营销解决方案</p>
                        </div>
                        <div class="card-grid">
                            <div class="card">
                                <div class="card-icon">📈</div>
                                <h3 class="card-title">项目 1</h3>
                                <p class="card-description">数字营销服务，提升品牌影响力</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">🎯</div>
                                <h3 class="card-title">项目 2</h3>
                                <p class="card-description">精准营销，锁定目标客户群体</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📱</div>
                                <h3 class="card-title">项目 3</h3>
                                <p class="card-description">社交媒体营销，扩大品牌曝光</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">💡</div>
                                <h3 class="card-title">项目 4</h3>
                                <p class="card-description">创意策划，打造独特营销方案</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 客服模块 -->
                    <div id="serviceModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">客服中心</h1>
                            <p class="content-subtitle">专业的客户服务支持</p>
                        </div>
                        <div class="card-grid">
                            <div class="card">
                                <div class="card-icon">🎧</div>
                                <h3 class="card-title">项目 1</h3>
                                <p class="card-description">在线客服支持，实时解答客户问题</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">💬</div>
                                <h3 class="card-title">项目 2</h3>
                                <p class="card-description">智能客服系统，提高服务效率</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📞</div>
                                <h3 class="card-title">项目 3</h3>
                                <p class="card-description">电话客服服务，贴心关怀每一位客户</p>
                            </div>
                            <div class="card">
                                <div class="card-icon">📧</div>
                                <h3 class="card-title">项目 4</h3>
                                <p class="card-description">邮件支持服务，详细记录客户需求</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 试卷系统模块 -->
                    <div id="examModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">试卷系统</h1>
                            <p class="content-subtitle">在线考试和练习系统</p>
                        </div>
                        <div class="exam-grid">
                            <div class="exam-card" onclick="startRandomPractice()">
                                <div class="exam-icon">🎲</div>
                                <div class="exam-content">
                                    <div class="exam-title">随机练习</div>
                                    <div class="exam-description">从多个试卷中随机选择题目进行练习</div>
                                    <div class="exam-footer">
                                        <div class="exam-question-count">50题</div>
                                        <div class="exam-status available">可用</div>
                                    </div>
                                </div>
                            </div>
                            <div class="exam-card" onclick="showHistoryRecords()">
                                <div class="exam-icon">📊</div>
                                <div class="exam-content">
                                    <div class="exam-title">历史记录</div>
                                    <div class="exam-description">查看您的考试历史记录</div>
                                    <div class="exam-footer">
                                        <div class="exam-question-count" id="historyCount">0</div>
                                        <div class="exam-status available">可用</div>
                                    </div>
                                </div>
                            </div>
                            <div class="exam-card" onclick="showWrongAnswers()">
                                <div class="exam-icon">❌</div>
                                <div class="exam-content">
                                    <div class="exam-title">错题记录</div>
                                    <div class="exam-description">查看和重做错题</div>
                                    <div class="exam-footer">
                                        <div class="exam-question-count" id="wrongAnswerCount">0</div>
                                        <div class="exam-status available">可用</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 背书功能模块 -->
                    <div id="reciteModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <h1 class="content-title">背书功能</h1>
                            <p class="content-subtitle">名词解释和简答题背诵练习</p>
                        </div>
                        
                        <!-- 背书功能主界面 -->
                        <div id="reciteMain" class="recite-main">
                            <!-- 功能模块切换 -->
                            <div class="recite-tabs">
                                <button class="recite-tab active" onclick="showReciteTab('noun')">名词解释</button>
                                <button class="recite-tab" onclick="showReciteTab('shortAnswer')" disabled>简答题</button>
                            </div>
                            
                            <!-- 统计计算区域 -->
                            <div class="recite-stats">
                                <div class="stat-item">
                                    <div class="stat-label">总名词数</div>
                                    <div class="stat-value" id="totalNouns">1</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">已学习</div>
                                    <div class="stat-value" id="learnedNouns">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">正确率</div>
                                    <div class="stat-value" id="correctRate">0%</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">学习进度</div>
                                    <div class="stat-value" id="learningProgress">0%</div>
                                </div>
                            </div>
                            
                            <!-- 名词解释模块 -->
                            <div id="nounModule" class="recite-content active">
                                <!-- 主标签和搜索区域 -->
                                <div class="noun-main-tags-with-search">
                                    <div class="noun-main-tags">
                                        <button class="noun-tag active" onclick="showNounSubTags('logistics')">物流</button>
                                        <button class="noun-tag" onclick="showNounSubTags('marketing')">营销</button>
                                        <button class="noun-tag" onclick="showNounSubTags('service')">客服</button>
                                        <button class="noun-tag" onclick="showNounSubTags('shop')">网店</button>
                                        <button class="noun-tag" onclick="showNounSubTags('ps')">PS</button>
                                    </div>
                                    <div class="search-container">
                                        <input type="text" class="search-input" placeholder="搜索名词..." id="searchInput" oninput="showSearchSuggestions()" onfocus="showSearchSuggestions()" onblur="hideSearchSuggestions()">
                                        <button class="search-btn" onclick="searchNoun()">
                                            <span>🔍</span>
                                        </button>
                                        <div class="search-suggestions" id="searchSuggestions"></div>
                                    </div>
                                </div>
                                
                                <!-- 子标签区域 -->
                                <div class="noun-subtags-section">
                                    <!-- 物流子标签 -->
                                    <div id="logisticsSubTags" class="noun-subtags active">
                                        <button class="noun-subtag active" onclick="showNounItems('logistics', 'all')">全部</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 1)">项目1</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 2)">项目2</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 3)">项目3</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 4)">项目4</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 5)">项目5</button>
                                        <button class="noun-subtag" onclick="showNounItems('logistics', 6)">项目6</button>
                                    </div>
                                    
                                    <!-- 其他子标签区域（初始隐藏） -->
                                    <div id="marketingSubTags" class="noun-subtags" style="display: none;">
                                        <button class="noun-subtag active" onclick="showNounItems('marketing', 'all')">全部</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 1)">项目1</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 2)">项目2</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 3)">项目3</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 4)">项目4</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 5)">项目5</button>
                                        <button class="noun-subtag" onclick="showNounItems('marketing', 6)">项目6</button>
                                    </div>
                                    
                                    <div id="serviceSubTags" class="noun-subtags" style="display: none;">
                                        <button class="noun-subtag active" onclick="showNounItems('service', 'all')">全部</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 1)">项目1</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 2)">项目2</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 3)">项目3</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 4)">项目4</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 5)">项目5</button>
                                        <button class="noun-subtag" onclick="showNounItems('service', 6)">项目6</button>
                                    </div>
                                    
                                    <div id="shopSubTags" class="noun-subtags" style="display: none;">
                                        <button class="noun-subtag active" onclick="showNounItems('shop', 'all')">全部</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 1)">项目1</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 2)">项目2</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 3)">项目3</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 4)">项目4</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 5)">项目5</button>
                                        <button class="noun-subtag" onclick="showNounItems('shop', 6)">项目6</button>
                                    </div>
                                    
                                    <div id="psSubTags" class="noun-subtags" style="display: none;">
                                        <button class="noun-subtag active" onclick="showNounItems('ps', 'all')">全部</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 1)">项目1</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 2)">项目2</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 3)">项目3</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 4)">项目4</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 5)">项目5</button>
                                        <button class="noun-subtag" onclick="showNounItems('ps', 6)">项目6</button>
                                    </div>
                                </div>
                                
                                <!-- 项目内容区域 -->
                                <div class="noun-items-section">
                                    <!-- 搜索结果容器 -->
                                    <div id="searchResultsContainer" class="search-results-container" style="display: none;">
                                        <div class="search-results-header">
                                            <h3>搜索结果</h3>
                                            <button class="close-search-results" onclick="hideSearchResults()">×</button>
                                        </div>
                                        <div id="searchResultsContent" class="search-results-content">
                                            <!-- 搜索结果将动态填充到这里 -->
                                        </div>
                                    </div>
                                    <!-- 物流项目1 -->
                                    <div id="logistics1Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('商品分类')">
                                                <div class="noun-item-icon">📦</div>
                                                <div class="noun-item-name">商品分类</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('商品包装标志')">
                                                <div class="noun-item-icon">🏷️</div>
                                                <div class="noun-item-name">商品包装标志</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('商品小类')">
                                                <div class="noun-item-icon">📋</div>
                                                <div class="noun-item-name">商品小类</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('仓库货架货位编码')">
                                                <div class="noun-item-icon">📌</div>
                                                <div class="noun-item-name">仓库货架货位编码</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('品类群类编码')">
                                                <div class="noun-item-icon">🏷️</div>
                                                <div class="noun-item-name">品类群类编码</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 分页控件 -->

                                    </div>
                                    
                                    <!-- 其他项目内容区域（初始隐藏） - 添加空状态显示 -->
                                    <div id="logistics2Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('货物检验')">
                                                <div class="noun-item-icon">🔍</div>
                                                <div class="noun-item-name">货物检验</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('抽样检验')">
                                                <div class="noun-item-icon">📊</div>
                                                <div class="noun-item-name">抽样检验</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('物理鉴定法')">
                                                <div class="noun-item-icon">⚖️</div>
                                                <div class="noun-item-name">物理鉴定法</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('堆码')">
                                                <div class="noun-item-icon">📚</div>
                                                <div class="noun-item-name">堆码</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('货物上架作业')">
                                                <div class="noun-item-icon">📥</div>
                                                <div class="noun-item-name">货物上架作业</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="logistics3Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('化学药剂防霉腐')">
                                                <div class="noun-item-icon">🧪</div>
                                                <div class="noun-item-name">化学药剂防霉腐</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('盘点差异处理')">
                                                <div class="noun-item-icon">📊</div>
                                                <div class="noun-item-name">盘点差异处理</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('密封')">
                                                <div class="noun-item-icon">🔒</div>
                                                <div class="noun-item-name">密封</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('商品养护')">
                                                <div class="noun-item-icon">🛡️</div>
                                                <div class="noun-item-name">商品养护</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('干燥防霉腐')">
                                                <div class="noun-item-icon">🌡️</div>
                                                <div class="noun-item-name">干燥防霉腐</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="logistics4Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('人工摘取式拣货')">
                                                <div class="noun-item-icon">👋</div>
                                                <div class="noun-item-name">人工摘取式拣货</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('播种式DAS拣货')">
                                                <div class="noun-item-icon">🌱</div>
                                                <div class="noun-item-name">播种式DAS拣货</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('摘取式DPS拣货')">
                                                <div class="noun-item-icon">🔍</div>
                                                <div class="noun-item-name">摘取式DPS拣货</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('订单配货与校验出库')">
                                                <div class="noun-item-icon">✅</div>
                                                <div class="noun-item-name">订单配货与校验出库</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="logistics5Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('现代商品包装')">
                                                <div class="noun-item-icon">📦</div>
                                                <div class="noun-item-name">现代商品包装</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('内包装')">
                                                <div class="noun-item-icon">📦</div>
                                                <div class="noun-item-name">内包装</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('外包装')">
                                                <div class="noun-item-icon">📦</div>
                                                <div class="noun-item-name">外包装</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('充气包装')">
                                                <div class="noun-item-icon">💨</div>
                                                <div class="noun-item-name">充气包装</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('包装标准')">
                                                <div class="noun-item-icon">📋</div>
                                                <div class="noun-item-name">包装标准</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="logistics6Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="noun-item" onclick="showNounDetail('不良品')">
                                                <div class="noun-item-icon">⚠️</div>
                                                <div class="noun-item-name">不良品</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('待处理品')">
                                                <div class="noun-item-icon">⏳</div>
                                                <div class="noun-item-name">待处理品</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('废品')">
                                                <div class="noun-item-icon">🗑️</div>
                                                <div class="noun-item-name">废品</div>
                                            </div>
                                            <div class="noun-item" onclick="showNounDetail('《退换货通知单》')">
                                                <div class="noun-item-icon">📋</div>
                                                <div class="noun-item-name">《退换货通知单》</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing1Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing2Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing3Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing4Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing5Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="marketing6Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service1Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service2Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service3Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service4Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service5Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="service6Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop1Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop2Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop3Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop4Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop5Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="shop6Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps1Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps2Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps3Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps4Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps5Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="ps6Items" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📦</div>
                                                <div class="empty-state-text">正在上新中...</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 全部项目内容容器 -->
                                    <div id="logisticsAllItems" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <!-- 动态填充内容 -->
                                        </div>
                                        
                                        <!-- 分页控件 -->

                                    </div>
                                    <div id="marketingAllItems" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <!-- 动态填充内容 -->
                                        </div>
                                        

                                    </div>
                                    <div id="serviceAllItems" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <!-- 动态填充内容 -->
                                        </div>
                                        

                                    </div>
                                    <div id="shopAllItems" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <!-- 动态填充内容 -->
                                        </div>
                                        

                                    </div>
                                    <div id="psAllItems" class="noun-items" style="display: none;">
                                        <div class="noun-items-grid">
                                            <!-- 动态填充内容 -->
                                        </div>
                                        

                                    </div>
                                </div>
                            </div>
                            
                            <!-- 简答题模块 -->
                            <div id="shortAnswerModule" class="recite-content" style="display: none;">
                                <div class="recite-notice">
                                    <h3>功能开发中</h3>
                                    <p>简答题功能暂未开放，敬请期待！</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 后台管理模块 - 优化版 -->
                    <div id="adminModule" class="module-content" style="display: none;">
                        <div class="content-header">
                            <div>
                                <h1 class="content-title">后台管理</h1>
                                <p class="content-subtitle">系统管理和用户数据统计</p>
                            </div>
                            <button class="refresh-btn" onclick="refreshUserData()">
                                <span>🔄</span>
                                <span>刷新数据</span>
                            </button>
                        </div>
                        
                        <div class="admin-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">注册用户总数</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="todayUsers">0</div>
                                <div class="stat-label">今日注册</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="activeUsers">0</div>
                                <div class="stat-label">活跃用户</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="inactiveUsers">0</div>
                                <div class="stat-label">不活跃用户</div>
                            </div>
                        </div>
                        
                        <!-- 桌面端表格 -->
                        <div class="user-table-desktop">
                            <div class="table-header">
                                <span>用户信息列表</span>
                                <span>最后更新: <span id="lastUpdateTime">--:--:--</span></span>
                            </div>
                            <div class="table-content">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>用户ID</th>
                                            <th>用户名</th>
                                            <th>账号</th>
                                            <th>注册时间</th>
                                            <th>最后登录</th>
                                            <th>状态</th>
                                            <th>背景音乐</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userTableBody">
                                        <!-- 用户数据将动态插入 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 手机端卡片 -->
                        <div class="user-cards-mobile" id="userCardsMobile">
                            <!-- 用户卡片将动态插入 -->
                        </div>

                        <!-- 分页控件 -->
                        <div class="pagination">
                            <button class="pagination-btn" id="prevPageBtn" onclick="previousPage()" disabled>
                                ‹ 上一页
                            </button>
                            <div class="pagination-info">
                                第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">1</span> 页
                            </div>
                            <button class="pagination-btn" id="nextPageBtn" onclick="nextPage()">
                                下一页 ›
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- 答题页面 -->
        <div id="examPage" class="page">
            <div class="exam-container">
                <div class="header">
                    <div class="header-top">
                        <div class="header-btn" onclick="backToMain()">🏠</div>
                        <div class="header-btn" onclick="openSettings()">⚙️</div>
                        <div class="header-btn" onclick="openAnswerCard()">📋</div>
                        <div class="header-btn" id="shuffleBtn" onclick="toggleShuffle()">🔀</div>
                    </div>
                    <h1 id="examTitle">随机练习</h1>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">第 1 题 / 共 50 题</div>
                </div>

                <!-- 10086版本特殊功能 - 人物脸部状态 -->
                <div id="characterFace" class="character-face normal">
                    <div class="face-eyes">
                        <div class="face-eye"></div>
                        <div class="face-eye"></div>
                    </div>
                    <div class="face-mouth"></div>
                </div>

                <div class="content-wrapper">
                    <div class="content">
                        <div class="question-type" id="questionType">单选题</div>
                        <div class="question-number">
                            <span id="questionNumber">第 1 题</span>
                        </div>
                        <div class="question-text" id="questionText"></div>
                        <div class="options" id="optionsContainer"></div>
                        <div class="answer-feedback" id="answerFeedback"></div>
                    </div>
                </div>
            </div>
            
            <div class="bottom-navigation">
                <div class="nav-buttons">
                    <button class="nav-btn nav-btn-secondary" id="prevBtn" onclick="previousQuestion()">
                        <span>←</span>
                        <span>上一题</span>
                    </button>
                    <button class="nav-btn nav-btn-primary" id="nextBtn" onclick="nextQuestion()">
                        <span>下一题</span>
                        <span>→</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 设置模态框 -->
        <div id="settingsModal" class="modal">
            <div class="settings-content">
                <div class="settings-title">设置</div>
                 
                <!-- 顾老太太打乱设置区域 -->
                <div id="grandmaShuffleSection" class="grandma-shuffle-section" style="display: none;">
                    <div class="grandma-shuffle-header">
                        <div class="grandma-icon">👵</div>
                        <div class="grandma-title">顾老太太打乱</div>
                    </div>
                    <div class="grandma-description">
                        顾老太太正在为您打乱题目顺序，让您的学习体验更加有趣！
                    </div>
                    <div class="grandma-toggle-container">
                        <div class="grandma-toggle-label">开启顾老太太打乱</div>
                        <div class="grandma-toggle" id="grandmaShuffleToggle" onclick="toggleGrandmaShuffle()">
                            <div class="grandma-toggle-slider"></div>
                        </div>
                    </div>
                    <div class="grandma-status" id="grandmaShuffleStatus">
                        当前状态：已关闭
                    </div>
                </div>
                
                <!-- 10086版本特殊功能 - 答错语音播报设置 -->
                <div id="specialToastSection" class="setting-item" style="display: none;">
                    <div class="setting-label">答错语音播报</div>
                    <div class="toggle-switch" id="specialToastToggle" onclick="toggleSpecialToast()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <!-- 答题自动下一题设置 -->
                <div class="setting-item">
                    <div class="setting-label">答题自动下一题</div>
                    <div class="toggle-switch" id="autoNextToggle" onclick="toggleAutoNext()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                

                 
                <div class="setting-item" id="shuffleSettingItem">
                    <div class="setting-label" id="shuffleLabel">一键打乱</div>
                    <div class="toggle-switch" id="shuffleToggle" onclick="toggleShuffleFromSettings()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">答题音效</div>
                </div>
                 
                <div class="sound-options" id="soundOptions">
                    <!-- 音效选项将通过JavaScript动态生成 -->
                </div>
                 
                <button class="close-settings-btn" onclick="closeSettings()">确定</button>
            </div>
        </div>

        <!-- 答题卡模态框 -->
        <div id="answerCardModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">答题卡</h2>
                    <button class="close-modal-btn" onclick="closeAnswerCard()">×</button>
                </div>
                <div class="question-grid" id="questionGrid"></div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="submitAnswers()">提交答案</button>
                </div>
            </div>
        </div>

        <!-- 结果模态框 -->
        <div id="resultModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">考试结果</h2>
                </div>
                <div class="result-content">
                    <div class="result-score" id="resultScore"></div>
                    <div class="result-details" id="resultDetails"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="closeResult()">确定</button>
                </div>
            </div>
        </div>

        <!-- 设置模态框 -->
        <div id="settingModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">设置</h2>
                    <button class="close-modal-btn" onclick="closeSettingModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="setting-item">
                        <div class="setting-label">警灯效果</div>
                        <div class="toggle-switch active" id="policeLightToggle" onclick="togglePoliceLight()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">语音方案</div>
                        <div class="speech-scheme-container">
                            <div class="speech-scheme-option">
                                <button class="speech-scheme-btn" id="schemeABtn" onclick="switchSpeechScheme('A')">A方案（浏览器语音）</button>
                                <button class="preview-btn" id="previewABtn" onclick="previewSpeechScheme('A')" title="预览A方案">
                                    <span class="play-icon">▶</span>
                                    <span class="playing-indicator" id="playingAIndicator"></span>
                                </button>
                            </div>
                            <div class="speech-scheme-option">
                                <button class="speech-scheme-btn" id="schemeBBtn" onclick="switchSpeechScheme('B')">B方案（预上传音频）</button>
                                <button class="preview-btn" id="previewBBtn" onclick="previewSpeechScheme('B')" title="预览B方案">
                                    <span class="play-icon">▶</span>
                                    <span class="playing-indicator" id="playingBIndicator"></span>
                                </button>
                            </div>
                            <div class="speech-scheme-info">
                                当前选中方案：<span id="currentScheme">A方案</span>
                            </div>
                        </div>
                    </div>
                    <div class="password-section" id="passwordSection">
                        <input type="password" class="password-input" id="policePassword" placeholder="请输入密码">
                        <button class="password-btn" onclick="verifyPolicePassword()">验证</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 更新公告模态框 -->
        <div id="noticeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">更新公告</h2>
                    <button class="close-modal-btn" onclick="closeNoticeModal()">×</button>
                </div>
                <div class="notice-content">
                    <div class="notice-title">系统更新公告</div>
                    <div class="notice-item">1. 新增警灯效果设置功能</div>
                    <div class="notice-item">2. 优化了用户界面体验</div>
                    <div class="notice-item">3. 修复了已知问题</div>
                    <div class="notice-item">4. 增强了系统安全性</div>
                    <div class="notice-item">5. 背书功能名词解释模块新增左右箭头导航</div>
                    <div class="notice-subitem">   - 功能说明：在查看名词解释详情时，可通过左右箭头按钮快速切换不同的名词解释</div>
                    <div class="notice-subitem">   - 使用方法：打开名词解释详情后，点击左侧箭头查看上一条，点击右侧箭头查看下一条</div>
                    <div class="notice-subitem">   - 用户价值：提升背书效率，方便用户连续学习多个名词解释，减少不必要的操作步骤</div>
                    <div class="notice-date">更新时间：2025-12-28</div>
                </div>
            </div>
        </div>

        <!-- 管理员密码验证模态框 -->
        <div id="adminPasswordModal" class="admin-password-modal">
            <div class="admin-password-content">
                <h2 class="admin-password-title">管理员验证</h2>
                <p style="margin-bottom: 20px; color: #718096;">请输入管理员密码以访问后台管理系统</p>
                <input type="password" class="admin-password-input" id="adminPasswordInput" placeholder="请输入管理员密码">
                <div class="admin-password-buttons">
                    <button class="admin-password-btn cancel" onclick="closeAdminPasswordModal()">取消</button>
                    <button class="admin-password-btn confirm" onclick="verifyAdminPassword()">确认</button>
                </div>
            </div>
        </div>

        <!-- 删除确认模态框 -->
        <div id="deleteConfirmModal" class="delete-confirm-modal">
            <div class="delete-confirm-content">
                <h2 class="delete-confirm-title">确认删除</h2>
                <p class="delete-confirm-text">您确定要删除用户 <strong id="deleteUserName"></strong> 吗？此操作不可恢复。</p>
                <div class="delete-confirm-buttons">
                    <button class="delete-confirm-btn cancel" onclick="closeDeleteConfirmModal()">取消</button>
                    <button class="delete-confirm-btn confirm" onclick="confirmDeleteUser()">确认删除</button>
                </div>
            </div>
        </div>

        <!-- 封号提示模态框 -->
        <div id="bannedModal" class="banned-modal">
            <div class="banned-content">
                <div class="banned-icon">🚫</div>
                <h2 class="banned-title">账号已被封禁</h2>
                <p class="banned-message">
                    很抱歉，您的账号因违反系统规定已被管理员封禁处理。
                </p>
                <div class="banned-details">
                    <h4>封禁详情：</h4>
                    <ul>
                        <li>您的账号已被限制登录系统</li>
                        <li>所有功能模块将无法访问</li>
                        <li>相关数据已被暂时冻结</li>
                        <li>封禁期间无法进行任何操作</li>
                    </ul>
                </div>
                <div class="banned-contact">
                    <h4>申诉联系：</h4>
                    <p>📧 邮箱：admin@example.com</p>
                    <p>📞 电话：400-123-4567</p>
                    <p>⏰ 工作时间：周一至周五 9:00-18:00</p>
                </div>
                <button class="banned-btn" onclick="closeBannedModal()">我知道了</button>
            </div>
        </div>

        <!-- 禁止答题提示模态框 -->
        <div id="disabledModal" class="disabled-modal">
            <div class="disabled-content">
                <div class="disabled-icon">⛔</div>
                <h2 class="disabled-title">答题权限已被限制</h2>
                <p class="disabled-message">
                    很抱歉，您的答题权限已被管理员限制。
                </p>
                <div class="disabled-details">
                    <h4>限制详情：</h4>
                    <ul>
                        <li>您当前无法进行试卷练习</li>
                        <li>历史记录和错题记录仍可查看</li>
                        <li>其他功能模块正常使用</li>
                        <li>请联系管理员解除限制</li>
                    </ul>
                </div>
                <div class="disabled-contact">
                    <h4>联系管理员：</h4>
                    <p>📧 邮箱：admin@example.com</p>
                    <p>📞 电话：400-123-4567</p>
                    <p>⏰ 工作时间：周一至周五 9:00-18:00</p>
                </div>
                <button class="disabled-btn" onclick="closeDisabledModal()">我知道了</button>
            </div>
        </div>

        <!-- 操作成功提示模态框 -->
        <div id="successModal" class="success-modal">
            <div class="success-content">
                <div class="success-icon">✅</div>
                <h2 class="success-title" id="successTitle">操作成功</h2>
                <p class="success-message" id="successMessage">操作已成功完成</p>
                <button class="success-btn" onclick="closeSuccessModal()">确定</button>
            </div>
        </div>

        <!-- 加载动画 -->
        <div id="loadingContainer" class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在获取题目...</div>
            <div class="loading-subtext">请稍候，系统正在为您准备试卷</div>
        </div>

        <!-- 密码输入弹窗 -->
        <div id="passwordModal" class="modal">
            <div class="password-content">
                <div class="password-title">请输入访问密码</div>
                <input type="password" class="password-input" id="passwordInput" placeholder="请输入密码" maxlength="11">
                <div class="password-error" id="passwordError">密码错误，请重新输入</div>
                <div class="password-actions">
                    <button class="password-btn password-btn-primary" onclick="verifyRandomPassword()">确认</button>
                    <button class="password-btn password-btn-secondary" onclick="cancelPassword()">取消</button>
                </div>
            </div>
        </div>
        
        <!-- 名词解释详情模态框 -->
        <div id="nounDetailModal" class="noun-detail-modal">
            <div class="noun-detail-content">
                <div class="noun-detail-header">
                    <h3 class="noun-detail-title" id="nounDetailTitle">商品分类</h3>
                    <button class="close-modal-btn" onclick="closeNounDetailModal()">×</button>
                </div>
                <div class="noun-detail-text" id="nounDetailText">商品分类：指为了一定目的，选择适当的分类标志， 

将商品集合总体科学地、系统地逐级划分为门类、大 

类、中类、小类、品类以至品种、花色、规格的过程。</div>
                
                <!-- 语音播放小弹窗 -->
                <div id="voicePlayModal" class="voice-play-modal">
                    <div class="voice-play-content">
                        <span class="voice-icon">🔊</span>
                        <span class="voice-text" id="voicePlayText">正在播放语音</span>
                    </div>
                </div>
                
                <!-- 导航控制区域 -->
                <div class="noun-navigation">
                    <button class="noun-nav-btn prev-btn" id="prevNounBtn" onclick="showPrevNoun()" disabled>
                        <span class="nav-btn-icon">←</span>
                        <span>上一个</span>
                    </button>
                    <span class="noun-progress" id="nounProgress">1 / 10</span>
                    <button class="noun-nav-btn next-btn" id="nextNounBtn" onclick="showNextNoun()">
                        <span>下一个</span>
                        <span class="nav-btn-icon">→</span>
                    </button>
                </div>
                
                <div class="noun-detail-actions">
                    <button class="skip-btn" id="skipBtn" onclick="startReciteTest()">跳过（<span id="countdownNumber">5</span>秒后可用）</button>
                </div>
            </div>
        </div>
        
        <!-- 语音播放状态弹窗 -->
        <div id="voiceStatusModal" class="voice-status-modal">
            <div class="voice-status-content">
                <div class="voice-status-header">
                    <h3 class="voice-status-title">语音播放状态</h3>
                    <button class="close-modal-btn" onclick="closeVoiceStatusModal()">×</button>
                </div>
                <div class="voice-status-body">
                    <div class="voice-status-icon" id="voiceStatusIcon">🔊</div>
                    <p class="voice-status-message" id="voiceStatusMessage">语音播放遇到未知问题</p>
                    <div class="voice-status-footer">
                        <button class="voice-status-btn" onclick="closeVoiceStatusModal()">确定</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 确认进入答题界面弹窗 -->
        <div id="confirmTestModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">确认进入答题</h3>
                    <button class="close-modal-btn" onclick="closeConfirmTestModal()">×</button>
                </div>
                <div class="modal-body">
                    <p>语音播放已完成，是否进入答题界面？</p>
                </div>
                <div class="modal-footer">
                    <button class="action-btn cancel" onclick="replayNounDetail()">否</button>
                    <button class="action-btn confirm" onclick="startReciteTestFromConfirm()">是</button>
                </div>
            </div>
        </div>
        
        <!-- 背书测试模态框 -->
        <div id="reciteTestModal" class="recite-test-modal">
            <div class="recite-test-content">
                <div class="test-header">
                    <h3 class="test-title">背书测试</h3>
                    <button class="close-modal-btn" onclick="closeReciteTestModal()">×</button>
                </div>
                <div class="test-question" id="testQuestion">商品分类</div>
                <div class="test-score">
                    <div class="score-main">
                        <div class="score-text">得分</div>
                        <div class="score-value" id="testScore">0</div>
                    </div>
                    <div class="score-details">
                        <div class="score-detail-item">
                            <div class="score-detail-label">匹配度</div>
                            <div class="score-detail-value" id="matchPercentage">0%</div>
                        </div>
                        <div class="score-detail-item">
                            <div class="score-detail-label">正确字符</div>
                            <div class="score-detail-value" id="correctChars">0/0</div>
                        </div>
                        <div class="score-detail-item">
                            <div class="score-detail-label">关键词匹配</div>
                            <div class="score-detail-value" id="keywordMatch">✗</div>
                        </div>
                    </div>
                </div>
                <div class="match-status" id="matchStatus"></div>
                <div class="test-input-section">
                    <div class="input-label">
                        <span>请输入或背诵答案：</span>
                    </div>
                    <textarea class="test-input" id="testInput" placeholder="请输入答案..."></textarea>
                </div>
                <div class="test-audio-controls">
                    <button class="audio-btn start-btn" id="startRecordBtn" onclick="startRecording()">
                        <span>🎤</span>
                        <span>开始录音</span>
                    </button>
                    <button class="audio-btn stop-btn" id="stopRecordBtn" onclick="stopRecording()">
                        <span>⏹️</span>
                        <span>停止录音</span>
                    </button>
                </div>
                <div class="test-footer">
                    <button class="test-btn close-test-btn" onclick="closeReciteTestModal()">关闭</button>
                    <button class="test-btn submit-btn" id="submitBtn" onclick="submitAnswer()">提交答案</button>
                    <button class="test-btn retry-btn" onclick="retryTest()">重试</button>
                </div>
            </div>
        </div>

        <!-- 特殊弹窗 -->
        <div id="specialToast" class="special-toast" style="display: none;">
            你还活着干嘛
        </div>

        <!-- 音频激活按钮 -->
        <button id="audioActivationBtn" class="audio-activation-btn" style="display: none;" onclick="activateAudio()">
            🔊
        </button>

        <!-- 语音状态指示器 -->
        <div id="voiceStatusIndicator" class="voice-status-indicator">
            <div class="voice-status-dot"></div>
            <span>正在播放语音</span>
        </div>

        <!-- 背景音乐 -->
        <audio id="bgMusic" loop>
            <source src="https://audio.i226.cn/audio/%E5%B8%B8%E7%94%A8/%E8%AD%A6%E6%8A%A5%20(12).WAV" type="audio/wav">
            您的浏览器不支持音频播放。
        </audio>
    </div>

    <script>
        // 全局状态管理
        const AppState = {
            currentPage: 'auth',
            authMode: 'login',
            currentUser: null,
            users: [],
            questions: [],
            currentQuestion: 0,
            userAnswers: [],
            isAnswered: [],
            soundEnabled: true,
            autoNextEnabled: false,
            historyRecords: [],
            wrongAnswers: [],
            audioContext: null,
            policeLightEnabled: true,
            policeLightPassword: '119120',
            adminPassword: '19560387349',
            specialAdminAccount: '19560394667',
            specialAdminPassword: '123456',
            isSpecialAdmin: false,
            userToDelete: null,
            bgMusic: null,
            currentPageIndex: 1,
            itemsPerPage: 5,
            totalUsers: [],
            // 背书功能分页状态
            reciteCurrentPage: 1,
            reciteItemsPerPage: 5,
            reciteTotalItems: 0,
            reciteTotalPages: 1,
            // 保存登录信息
            savedCredentials: {
                account: '',
                password: '',
                rememberMe: false
            },
            // 新增：随机练习密码验证状态
            randomPasswordAttempts: 0,
            // 新增：设置相关状态
            isSpecialVersion: false,
            soundType: 'correct',
            correctSound: null,
            incorrectSound: null,
            specialToastAudio: null,
            specialToastEnabled: false,
            audioActivated: false,
            speechSynthesisSupported: false,
            audioInitialized: false,
            globalClickListenerAdded: false,
            mobileAudioActivated: false,
            speechRetryCount: 0,
            maxSpeechRetry: 3,
            // 新增：顾老太太打乱状态
            grandmaShuffleEnabled: false,
            grandmaShuffleMode: 'full',
            // 新增：10086版本特殊功能
            correctCountInSpecialVersion: 0,
            consecutiveCorrectCount: 0,
            lastAnswerCorrect: false,
            isRecovering: false,
            specialToastTimeout: null,
            specialToastActive: false,
            // 新增：双方案语音播放状态
            speechScheme: 'A', // 默认使用A方案（浏览器合成语音）
            audioElements: {}, // 缓存音频元素
            nounAudioUrls: {
                '商品分类': 'https://cfbed.1314883.xyz/file/1767010734042_商品分类.wav',
                '商品包装标志': 'https://cfbed.1314883.xyz/file/1767013430122_商品包装标志.wav',
                '商品小类': 'https://cfbed.1314883.xyz/file/1767017414150_商品小类.wav',
                '仓库货架货位编码': 'https://cfbed.1314883.xyz/file/1767017956882_仓库货架货位编码.wav',
                '品类群类编码': 'https://cfbed.1314883.xyz/file/1767018090732_品类群类编码.wav',
                '抽样检验': 'https://cfbed.1314883.xyz/file/1767089996675_抽样检验.wav',
                '货物检验': 'https://cfbed.1314883.xyz/file/1767089995647_货物检验.wav',
                '物理鉴定法': 'https://cfbed.1314883.xyz/file/1767090183710_物理鉴定法.wav',
                '堆码': 'https://cfbed.1314883.xyz/file/1767090332348_堆码.wav',
                '货物上架作业': 'https://cfbed.1314883.xyz/file/1767090466518_货物上架作业.wav',
                '化学药剂防霉腐': 'https://cfbed.1314883.xyz/file/1767090576726_化学药剂防霉腐.wav',
                '盘点差异处理': 'https://cfbed.1314883.xyz/file/1767090719576_盘点差异处理.wav',
                '密封': 'https://cfbed.1314883.xyz/file/1767090832527_密封.wav',
                '商品养护': 'https://cfbed.1314883.xyz/file/1767090951681_商品养护.wav',
                '干燥防霉腐': 'https://cfbed.1314883.xyz/file/1767091039635_干燥防霉腐.wav',
                '人工摘取式拣货': 'https://cfbed.1314883.xyz/file/1767097625227_人工摘取式拣货.wav',
                '播种式DAS拣货': 'https://cfbed.1314883.xyz/file/1767097684375_播种式DAS拣货.wav',
                '摘取式DPS拣货': 'https://cfbed.1314883.xyz/file/1767097755833_摘取式DPS拣货.wav',
                '订单配货与校验出库': 'https://cfbed.1314883.xyz/file/1767097811574_订单配货与校验出库.wav',
                '现代商品包装': 'https://cfbed.1314883.xyz/file/1767100137050_现代商品包装.wav',
                '内包装': 'https://cfbed.1314883.xyz/file/1767100229919_内包装.wav',
                '外包装': 'https://cfbed.1314883.xyz/file/1767100330861_外包装.wav',
                '充气包装': 'https://cfbed.1314883.xyz/file/1767100402767_充气包装.wav',
                '包装标准': 'https://cfbed.1314883.xyz/file/1767100480040_包装标准.wav',
                '不良品': 'https://cfbed.1314883.xyz/file/1767101880958_不良品.wav',
                '待处理品': 'https://cfbed.1314883.xyz/file/1767102097542_待处理品.wav',
                '废品': 'https://cfbed.1314883.xyz/file/1767102212785_废品.wav',
                '《退换货通知单》': 'https://cfbed.1314883.xyz/file/1767102298596_《退换货通知单》.wav'
            }
        };

        // 试卷数据
        const examData = {
            random: {
                title: '随机练习',
                questions: [
                    // 单选题
                    {
                        type: 'single',
                        question: '信息经济学将商品进行了分类，消费者在购买时就能确定或评价其质量的商品称为',
                        options: ['经验性商品', '可量化性商品', '可鉴别商品', '感官性商品'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '可以制作网页动画的软件是',
                        options: ['Fireworks', 'Dreamweaver', 'Flash', 'Photoshop'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '（ ）可以把浏览者从一个网页带到另一个网页，或者从网页的某一个部分引导到另一个部分。',
                        options: ['超文本', '主页', '超级链接', '网页'],
                        answer: 'C'
                    },
                    // 多选题
                    {
                        type: 'multiple',
                        question: 'float 常用属性为',
                        options: ['Left', 'Right', 'None', 'Font'],
                        answer: ['A', 'B', 'C']
                    },
                    {
                        type: 'multiple',
                        question: '详情页文案设计的两个基本点为',
                        options: ['把所有的客户都当成专业人士', '把所有的客户都当成非专业人士', '寻找产品的促销点而非价值点', '寻找产品的价值点而非促销点'],
                        answer: ['B', 'D']
                    },
                    // 判断题
                    {
                        type: 'judge',
                        question: '模板文件中不能再嵌入模板。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: 'PC 端很多时候用深色系来体现店铺的风格，而移动端浏览由于尺寸小，因此颜色鲜亮，以便让消费者浏览得舒适。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    // 排序题
                    {
                        type: 'sort',
                        question: '注册微信公众号的步骤为',
                        options: ['选择注册的账号类型', '选择公众号类型', '登录注册界面', '选择注册订阅号的主体类型', '填写邮箱、密码等基本信息', '输入邮箱验证码', '填写公众号信息'],
                        answer: ['C', 'A', 'E', 'F', 'B', 'D', 'G']
                    }
                ]
            }
        };

        // 初始化
        function init() {
            loadUsers();
            loadHistoryRecords();
            loadWrongAnswers();
            initAudioContext();
            initPoliceLight();
            initBackgroundMusic();
            // 添加特殊管理员账号
            addSpecialAdmin();
            // 恢复保存的登录信息
            restoreSavedCredentials();
            // 检测语音合成支持
            checkSpeechSynthesisSupport();
            // 初始化语音方案设置
            initSpeechScheme();
            // 添加全局点击监听器
            addGlobalClickListener();
        }

        // 恢复保存的登录信息
        function restoreSavedCredentials() {
            const savedCredentials = localStorage.getItem('savedCredentials');
            if (savedCredentials) {
                AppState.savedCredentials = JSON.parse(savedCredentials);
                
                // 如果用户选择了记住我，则填充表单
                if (AppState.savedCredentials.rememberMe) {
                    document.getElementById('authAccount').value = AppState.savedCredentials.account || '';
                    document.getElementById('authPassword').value = AppState.savedCredentials.password || '';
                    document.getElementById('rememberMe').checked = true;
                }
            }
        }

        // 保存登录信息
        function saveCredentials(account, password, rememberMe) {
            AppState.savedCredentials = { account, password, rememberMe };
            
            if (rememberMe) {
                // 用户选择记住我，保存到localStorage
                localStorage.setItem('savedCredentials', JSON.stringify(AppState.savedCredentials));
            } else {
                // 用户不选择记住我，清除保存的信息
                localStorage.removeItem('savedCredentials');
            }
        }

        // 初始化警灯效果
        function initPoliceLight() {
            // 默认开启警灯效果
            AppState.policeLightEnabled = true;
            document.body.style.animationPlayState = 'running';
        }

        // 加载用户数据
        function loadUsers() {
            const savedUsers = localStorage.getItem('users');
            if (savedUsers) {
                AppState.users = JSON.parse(savedUsers);
                AppState.totalUsers = [...AppState.users];
            }
        }

        // 保存用户数据
        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(AppState.users));
        }

        // 切换认证标签
        function switchAuthTab(mode) {
            AppState.authMode = mode;
            const tabs = document.querySelectorAll('.auth-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const registerFields = document.getElementById('registerFields');
            const rememberMeContainer = document.getElementById('rememberMeContainer');
            const authSubmitBtn = document.getElementById('authSubmitBtn');
            const authSwitchText = document.getElementById('authSwitchText');
            
            if (mode === 'register') {
                registerFields.style.display = 'block';
                rememberMeContainer.style.display = 'none'; // 注册时不显示记住我选项
                authSubmitBtn.textContent = '注册';
                authSwitchText.textContent = '已有账号？';
            } else {
                registerFields.style.display = 'none';
                rememberMeContainer.style.display = 'flex'; // 登录时显示记住我选项
                authSubmitBtn.textContent = '登录';
                authSwitchText.textContent = '还没有账号？';
            }
        }

        // 切换认证模式
        function switchAuthMode() {
            const loginTab = document.querySelector('.auth-tab:first-child');
            const registerTab = document.querySelector('.auth-tab:last-child');
            
            if (AppState.authMode === 'login') {
                registerTab.click();
            } else {
                loginTab.click();
            }
        }

        // 处理认证
        function handleAuth(event) {
            event.preventDefault();
            
            const account = document.getElementById('authAccount').value;
            const password = document.getElementById('authPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (AppState.authMode === 'login') {
                // 登录逻辑
                const user = AppState.users.find(u => u.account === account && u.password === password);
                
                if (user) {
                    // 检查用户是否被封号
                    if (user.banned === true) {
                        showBannedModal();
                        return;
                    }
                    
                    AppState.currentUser = user;
                    user.lastLogin = new Date().toISOString();
                    saveUsers();
                    
                    // 保存登录信息
                    saveCredentials(account, password, rememberMe);
                    
                    // 检查是否是特殊管理员
                    if (account === AppState.specialAdminAccount && password === AppState.specialAdminPassword) {
                        AppState.isSpecialAdmin = true;
                        // 特殊管理员登录后关闭警灯效果，设置粉红渐变背景
                        AppState.policeLightEnabled = false;
                        document.body.style.animationPlayState = 'paused';
                        document.body.classList.add('special-admin');
                    } else {
                        AppState.isSpecialAdmin = false;
                        // 普通用户保持警灯效果
                        AppState.policeLightEnabled = true;
                        document.body.style.animationPlayState = 'running';
                        document.body.classList.remove('special-admin');
                    }
                    
                    showMainPage();
                    // 根据用户设置播放背景音乐
                    if (user.bgMusicEnabled) {
                        playBackgroundMusic();
                    } else if (AppState.bgMusic) {
                        AppState.bgMusic.pause();
                    }
                } else {
                    alert('账号或密码错误');
                }
            } else {
                // 注册逻辑
                const confirmPassword = document.getElementById('confirmPassword').value;
                const username = document.getElementById('username').value;
                
                if (password !== confirmPassword) {
                    alert('两次输入的密码不一致');
                    return;
                }
                
                if (AppState.users.find(u => u.account === account)) {
                    alert('该账号已被注册');
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username || account,
                    account: account,
                    password: password,
                    registerTime: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    status: 'active',
                    role: 0,  // 普通用户权限级别为0
                    bgMusicEnabled: true  // 背景音乐默认开启
                };
                
                AppState.users.push(newUser);
                AppState.totalUsers.push(newUser);
                saveUsers();
                AppState.currentUser = newUser;
                AppState.isSpecialAdmin = false;
                
                // 注册成功后，根据记住我选项保存登录信息
                saveCredentials(account, password, rememberMe);
                
                // 普通用户注册后保持警灯效果
                AppState.policeLightEnabled = true;
                document.body.style.animationPlayState = 'running';
                document.body.classList.remove('special-admin');
                
                showMainPage();
                // 播放背景音乐
                playBackgroundMusic();
            }
        }

        // 显示封号提示模态框
        function showBannedModal() {
            document.getElementById('bannedModal').classList.add('active');
        }

        // 关闭封号提示模态框
        function closeBannedModal() {
            document.getElementById('bannedModal').classList.remove('active');
        }

        // 显示主页面
        function showMainPage() {
            document.getElementById('authPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            AppState.currentPage = 'main';
            
            // 根据用户类型设置后台管理导航项
            const adminNav = document.getElementById('adminNav');
            const adminNavMobile = document.getElementById('adminNavMobile');
            if (AppState.isSpecialAdmin) {
                adminNav.classList.remove('disabled');
                adminNavMobile.classList.remove('disabled');
            } else {
                adminNav.classList.add('disabled');
                adminNavMobile.classList.add('disabled');
            }
            
            updateAdminStats();
        }

        // 显示模块
        function showModule(moduleName) {
            // 隐藏所有模块
            document.querySelectorAll('.module-content').forEach(module => {
                module.style.display = 'none';
            });
            
            // 显示选中的模块
            document.getElementById(moduleName + 'Module').style.display = 'block';
            
            // 更新导航栏激活状态
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.nav-link').classList.add('active');
            
            // 关闭手机端侧边栏
            if (window.innerWidth <= 768) {
                toggleMobileSidebar();
            }
            
            // 如果是背书功能模块，更新统计数据
            if (moduleName === 'recite') {
                // 延迟调用，确保DOM已经加载完成
                setTimeout(updateReciteStats, 100);
            }
        }

        // 切换手机端侧边栏
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('mobileSidebarOverlay');
            
            // 切换侧边栏和遮罩层的显示状态
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // 防止背景滚动
            if (sidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // 退出登录
        function logout() {
            AppState.currentUser = null;
            AppState.isSpecialAdmin = false;
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('authPage').classList.add('active');
            AppState.currentPage = 'auth';
            
            // 恢复默认背景
            document.body.classList.remove('special-admin');
            AppState.policeLightEnabled = true;
            document.body.style.animationPlayState = 'running';
            
            // 停止背景音乐
            stopBackgroundMusic();
            
            // 如果用户没有选择记住我，则清除表单
            if (!AppState.savedCredentials.rememberMe) {
                document.getElementById('authAccount').value = '';
                document.getElementById('authPassword').value = '';
                document.getElementById('rememberMe').checked = false;
            }
        }

        // 更新后台统计数据
        function updateAdminStats() {
            document.getElementById('totalUsers').textContent = AppState.users.length;
            
            const today = new Date().toDateString();
            const todayUsers = AppState.users.filter(u => 
                new Date(u.registerTime).toDateString() === today
            ).length;
            document.getElementById('todayUsers').textContent = todayUsers;
            
            const activeUsers = AppState.users.filter(u => 
                new Date(u.lastLogin).toDateString() === today
            ).length;
            document.getElementById('activeUsers').textContent = activeUsers;
            
            const inactiveUsers = AppState.users.filter(u => 
                new Date(u.lastLogin).toDateString() !== today
            ).length;
            document.getElementById('inactiveUsers').textContent = inactiveUsers;
            
            // 更新用户表格和卡片
            updateUserDisplay();
            
            // 更新最后刷新时间
            const now = new Date();
            document.getElementById('lastUpdateTime').textContent = 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        }

        // 更新用户显示（表格和卡片）
        function updateUserDisplay() {
            updateUserTable();
            updateUserCards();
            updatePagination();
        }

        // 更新用户表格（桌面端）
        function updateUserTable() {
            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = '';
            
            const startIndex = (AppState.currentPageIndex - 1) * AppState.itemsPerPage;
            const endIndex = startIndex + AppState.itemsPerPage;
            const pageUsers = AppState.users.slice(startIndex, endIndex);
            
            pageUsers.forEach(user => {
                const row = document.createElement('tr');
                
                // 检查用户状态
                let statusClass = 'active';
                let statusText = '活跃';
                let statusIcon = '✅';
                
                if (user.banned === true) {
                    statusClass = 'banned';
                    statusText = '已封号';
                    statusIcon = '🚫';
                } else if (user.disabled === true) {
                    statusClass = 'disabled';
                    statusText = '禁止答题';
                    statusIcon = '⛔';
                } else if (new Date(user.lastLogin).toDateString() !== new Date().toDateString()) {
                    statusClass = 'inactive';
                    statusText = '不活跃';
                    statusIcon = '❌';
                }
                
                // 根据用户状态显示不同的操作按钮
                let actionButtons = '';
                
                if (user.role === 2) {
                    // 特殊管理员不能被操作
                    actionButtons = '<span style="color: #718096;">特殊管理员</span>';
                } else {
                    if (user.banned === true) {
                        actionButtons = `<button class="action-btn unban" onclick="unbanUser(${user.id})">解封</button>`;
                    } else {
                        actionButtons = `<button class="action-btn ban" onclick="banUser(${user.id})">封号</button>`;
                    }
                    
                    if (user.disabled === true) {
                        actionButtons += ` <button class="action-btn enable" onclick="enableUser(${user.id})">允许答题</button>`;
                    } else {
                        actionButtons += ` <button class="action-btn disable" onclick="disableUser(${user.id})">禁止答题</button>`;
                    }
                    
                    // 添加删除按钮
                    actionButtons += ` <button class="action-btn delete" onclick="showDeleteConfirmModal(${user.id}, '${user.username}')">删除</button>`;
                }
                
                // 格式化日期
                const registerTime = formatDate(user.registerTime);
                const lastLogin = formatDate(user.lastLogin);
                
                // 设置背景音乐开关状态
                const bgMusicEnabled = user.bgMusicEnabled !== false; // 默认开启
                const bgMusicToggleClass = bgMusicEnabled ? 'active' : '';
                const bgMusicText = bgMusicEnabled ? '开启' : '关闭';
                
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.account}</td>
                    <td>${registerTime}</td>
                    <td>${lastLogin}</td>
                    <td><span class="status-badge ${statusClass}">${statusIcon} ${statusText}</span></td>
                    <td>
                        <div class="toggle-switch ${bgMusicToggleClass}" onclick="toggleUserBgMusic(${user.id})">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="bg-music-status">${bgMusicText}</span>
                    </td>
                    <td><div class="user-actions">${actionButtons}</div></td>
                `;
                userTableBody.appendChild(row);
            });
        }

        // 更新用户卡片（手机端）
        function updateUserCards() {
            const userCardsMobile = document.getElementById('userCardsMobile');
            userCardsMobile.innerHTML = '';
            
            const startIndex = (AppState.currentPageIndex - 1) * AppState.itemsPerPage;
            const endIndex = startIndex + AppState.itemsPerPage;
            const pageUsers = AppState.users.slice(startIndex, endIndex);
            
            pageUsers.forEach(user => {
                // 检查用户状态
                let statusClass = 'active';
                let statusText = '活跃';
                let statusIcon = '✅';
                
                if (user.banned === true) {
                    statusClass = 'banned';
                    statusText = '已封号';
                    statusIcon = '🚫';
                } else if (user.disabled === true) {
                    statusClass = 'disabled';
                    statusText = '禁止答题';
                    statusIcon = '⛔';
                } else if (new Date(user.lastLogin).toDateString() !== new Date().toDateString()) {
                    statusClass = 'inactive';
                    statusText = '不活跃';
                    statusIcon = '❌';
                }
                
                // 根据用户状态显示不同的操作按钮
                let actionButtons = '';
                
                if (user.role === 2) {
                    // 特殊管理员不能被操作
                    actionButtons = '<div style="color: #718096; text-align: center; padding: 8px;">特殊管理员</div>';
                } else {
                    if (user.banned === true) {
                        actionButtons = `<button class="user-card-action-btn" style="background: #c6f6d5; color: #2f855a;" onclick="unbanUser(${user.id})">解封</button>`;
                    } else {
                        actionButtons = `<button class="user-card-action-btn" style="background: #fed7d7; color: #e53e3e;" onclick="banUser(${user.id})">封号</button>`;
                    }
                    
                    if (user.disabled === true) {
                        actionButtons += `<button class="user-card-action-btn" style="background: #bee3f8; color: #2c5282;" onclick="enableUser(${user.id})">允许答题</button>`;
                    } else {
                        actionButtons += `<button class="user-card-action-btn" style="background: #feebc8; color: #c05621;" onclick="disableUser(${user.id})">禁止答题</button>`;
                    }
                    
                    // 添加删除按钮
                    actionButtons += `<button class="user-card-action-btn" style="background: #fed7d7; color: #e53e3e;" onclick="showDeleteConfirmModal(${user.id}, '${user.username}')">删除</button>`;
                }
                
                // 格式化日期
                const registerTime = formatDate(user.registerTime);
                const lastLogin = formatDate(user.lastLogin);
                
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `
                    <div class="user-card-header">
                        <div class="user-card-info">
                            <div class="user-card-id">ID: ${user.id}</div>
                            <div class="user-card-name">${user.username}</div>
                        </div>
                        <div class="user-card-status ${statusClass}">
                            ${statusIcon} ${statusText}
                        </div>
                    </div>
                    <div class="user-card-details">
                        <div class="user-card-detail">
                            <div class="user-card-label">账号</div>
                            <div class="user-card-value">${user.account}</div>
                        </div>
                        <div class="user-card-detail">
                            <div class="user-card-label">注册时间</div>
                            <div class="user-card-value">${registerTime}</div>
                        </div>
                        <div class="user-card-detail">
                            <div class="user-card-label">最后登录</div>
                            <div class="user-card-value">${lastLogin}</div>
                        </div>
                        <div class="user-card-detail">
                            <div class="user-card-label">状态</div>
                            <div class="user-card-value">${statusText}</div>
                        </div>
                    </div>
                    <div class="user-card-actions">
                        ${actionButtons}
                    </div>
                `;
                userCardsMobile.appendChild(card);
            });
        }

        // 格式化日期
        function formatDate(dateString) {
            if (!dateString || dateString === 'Invalid Date') {
                return '-';
            }
            const date = new Date(dateString);
            return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        }

        // 更新分页控件
        function updatePagination() {
            const totalPages = Math.ceil(AppState.users.length / AppState.itemsPerPage);
            
            document.getElementById('currentPage').textContent = AppState.currentPageIndex;
            document.getElementById('totalPages').textContent = totalPages;
            
            document.getElementById('prevPageBtn').disabled = AppState.currentPageIndex === 1;
            document.getElementById('nextPageBtn').disabled = AppState.currentPageIndex === totalPages;
        }



        // 刷新用户数据
        function refreshUserData() {
            loadUsers();
            AppState.currentPageIndex = 1;
            updateAdminStats();
            
            // 显示刷新成功提示
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<span>✅</span><span>已刷新</span>';
            refreshBtn.style.background = '#48bb78';
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.style.background = '#667eea';
            }, 2000);
        }

        // 封号用户
        function banUser(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.banned = true;
                user.bannedTime = new Date().toISOString();
                saveUsers();
                updateAdminStats();
                
                // 显示操作成功提示
                showSuccessModal('封号成功', `用户 ${user.username} 已被成功封号，无法登录系统`);
                
                // 如果被封号的是当前登录用户，立即登出
                if (AppState.currentUser && AppState.currentUser.id === userId) {
                    setTimeout(() => {
                        logout();
                        showBannedModal();
                    }, 2000);
                }
            }
        }

        // 解封用户
        function unbanUser(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.banned = false;
                delete user.bannedTime;
                saveUsers();
                updateAdminStats();
                
                // 显示操作成功提示
                showSuccessModal('解封成功', `用户 ${user.username} 已被成功解封，可以正常登录系统`);
            }
        }

        // 禁止用户答题
        function disableUser(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.disabled = true;
                user.disabledTime = new Date().toISOString();
                saveUsers();
                updateAdminStats();
                
                // 显示操作成功提示
                showSuccessModal('限制成功', `用户 ${user.username} 的答题权限已被限制，无法参与考试`);
                
                // 如果被禁止答题的是当前登录用户，更新当前用户状态
                if (AppState.currentUser && AppState.currentUser.id === userId) {
                    AppState.currentUser.disabled = true;
                }
            }
        }

        // 允许用户答题
        function enableUser(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.disabled = false;
                delete user.disabledTime;
                saveUsers();
                updateAdminStats();
                
                // 显示操作成功提示
                showSuccessModal('解除限制成功', `用户 ${user.username} 的答题权限已恢复，可以正常参与考试`);
                
                // 如果被允许答题的是当前登录用户，更新当前用户状态
                if (AppState.currentUser && AppState.currentUser.id === userId) {
                    AppState.currentUser.disabled = false;
                }
            }
        }

        // 显示删除确认模态框
        function showDeleteConfirmModal(userId, username) {
            AppState.userToDelete = userId;
            document.getElementById('deleteUserName').textContent = username;
            document.getElementById('deleteConfirmModal').classList.add('active');
        }

        // 关闭删除确认模态框
        function closeDeleteConfirmModal() {
            document.getElementById('deleteConfirmModal').classList.remove('active');
            AppState.userToDelete = null;
        }

        // 确认删除用户
        function confirmDeleteUser() {
            if (AppState.userToDelete) {
                const userIndex = AppState.users.findIndex(u => u.id === AppState.userToDelete);
                if (userIndex !== -1) {
                    const deletedUser = AppState.users[userIndex];
                    AppState.users.splice(userIndex, 1);
                    
                    // 更新总用户列表
                    const totalUserIndex = AppState.totalUsers.findIndex(u => u.id === AppState.userToDelete);
                    if (totalUserIndex !== -1) {
                        AppState.totalUsers.splice(totalUserIndex, 1);
                    }
                    
                    saveUsers();
                    
                    // 如果删除的是当前登录用户，立即登出
                    if (AppState.currentUser && AppState.currentUser.id === AppState.userToDelete) {
                        logout();
                    }
                    
                    // 检查当前页是否还有数据，如果没有则回到上一页
                    const totalPages = Math.ceil(AppState.users.length / AppState.itemsPerPage);
                    if (AppState.currentPageIndex > totalPages && totalPages > 0) {
                        AppState.currentPageIndex = totalPages;
                    }
                    
                    updateAdminStats();
                    closeDeleteConfirmModal();
                    alert(`用户 ${deletedUser.username} 已被删除`);
                }
            }
        }

        // 显示管理员密码验证模态框
        function showAdminPasswordModal() {
            // 检查是否是特殊管理员
            if (AppState.isSpecialAdmin) {
                // 特殊管理员直接进入后台管理
                showModule('admin');
                updateAdminStats();
            } else {
                // 普通用户显示密码验证框
                document.getElementById('adminPasswordModal').classList.add('active');
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordInput').focus();
            }
        }

        // 关闭管理员密码验证模态框
        function closeAdminPasswordModal() {
            document.getElementById('adminPasswordModal').classList.remove('active');
        }

        // 验证管理员密码
        function verifyAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            if (password === AppState.adminPassword) {
                // 密码正确，显示后台管理模块
                closeAdminPasswordModal();
                showModule('admin');
                updateAdminStats();
            } else {
                alert('密码错误，请重新输入');
            }
        }

        // 开始随机练习 - 修改为包含密码验证
        function startRandomPractice() {
            // 显示加载动画
            showLoading();
            
            // 模拟加载延迟，然后显示密码框
            setTimeout(() => {
                hideLoading();
                showRandomPasswordModal();
            }, 1500);
        }

        // 显示随机练习密码输入框
        function showRandomPasswordModal() {
            const passwordInput = document.getElementById('passwordInput');
            const passwordError = document.getElementById('passwordError');
            
            if (passwordInput && passwordError) {
                passwordInput.value = '';
                passwordError.style.display = 'none';
                passwordInput.focus();
                
                // 移除旧的监听器，防止重复绑定
                const newInput = passwordInput.cloneNode(true);
                passwordInput.parentNode.replaceChild(newInput, passwordInput);
                newInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyRandomPassword();
                    }
                });
            }
            
            document.getElementById('passwordModal').classList.add('active');
        }

        // 验证随机练习密码
        function verifyRandomPassword() {
            try {
                const passwordInput = document.getElementById('passwordInput');
                const passwordError = document.getElementById('passwordError');
                
                if (!passwordInput || !passwordError) {
                    console.error('密码输入元素未找到');
                    return;
                }
                
                const password = passwordInput.value;
                
                if (password === '10086') {
                    // 特殊版本
                    AppState.isSpecialVersion = true;
                    AppState.randomPasswordAttempts = 0;
                    document.getElementById('passwordModal').classList.remove('active');
                    initializeRandomExam();
                    applySpecialVersionSettings();
                    loadAnimalSounds();
                    loadSpecialToastAudio();
                } else if (password === '15957855063') {
                    // 原始版本
                    AppState.isSpecialVersion = false;
                    AppState.randomPasswordAttempts = 0;
                    document.getElementById('passwordModal').classList.remove('active');
                    initializeRandomExam();
                    applyNormalVersionSettings();
                    initAudioContext();
                } else {
                    // 密码错误
                    AppState.randomPasswordAttempts++;
                    passwordError.style.display = 'block';
                    passwordInput.value = '';
                    passwordInput.focus();
                    
                    if (AppState.randomPasswordAttempts >= 3) {
                        alert('密码错误次数过多，请刷新页面重试。');
                        backToMain();
                    }
                }
            } catch (error) {
                console.error('验证随机练习密码时出错:', error);
                alert('验证密码时出错，请刷新页面重试');
            }
        }

        // 取消密码输入
        function cancelPassword() {
            document.getElementById('passwordModal').classList.remove('active');
            AppState.randomPasswordAttempts = 0;
        }

        // 初始化随机练习考试
        function initializeRandomExam() {
            try {
                // 初始化题目数据
                AppState.questions = [...examData.random.questions];
                AppState.userAnswers = new Array(AppState.questions.length).fill(null);
                AppState.isAnswered = new Array(AppState.questions.length).fill(false);
                
                // 设置考试标题
                const examTitle = document.getElementById('examTitle');
                if (examTitle) {
                    examTitle.textContent = '随机练习';
                }
                
                // 切换到考试页面
                document.getElementById('mainPage').classList.remove('active');
                document.getElementById('examPage').classList.add('active');
                AppState.currentPage = 'exam';
                
                // 显示第一题
                AppState.currentQuestion = 0;
                displayQuestion();
                updateProgress();
                
                // 确保按钮正确显示
                updateButtonVisibility();
                
                // 10086版本特殊功能 - 显示人物脸部
                if (AppState.isSpecialVersion) {
                    const characterFace = document.getElementById('characterFace');
                    if (characterFace) {
                        characterFace.style.display = 'flex';
                    }
                }
            } catch (error) {
                console.error('初始化随机练习考试时出错:', error);
                alert('初始化考试时出错，请刷新页面重试');
            }
        }

        // 应用特殊版本设置
        function applySpecialVersionSettings() {
            try {
                // 显示顾老太太打乱设置区域
                const grandmaShuffleSection = document.getElementById('grandmaShuffleSection');
                if (grandmaShuffleSection) {
                    grandmaShuffleSection.style.display = 'block';
                }
                
                // 显示答错语音播报设置
                const specialToastSection = document.getElementById('specialToastSection');
                if (specialToastSection) {
                    specialToastSection.style.display = 'flex';
                }
                
                // 隐藏普通打乱设置项
                const shuffleSettingItem = document.getElementById('shuffleSettingItem');
                if (shuffleSettingItem) {
                    shuffleSettingItem.style.display = 'none';
                }
                
                // 修改打乱按钮标题
                const shuffleBtn = document.getElementById('shuffleBtn');
                if (shuffleBtn) {
                    shuffleBtn.title = '顾老太太打乱';
                }
                
                // 设置音效为动物叫声
                AppState.soundType = 'animal';
                
                // 更新音效选择按钮状态
                const soundButtons = document.querySelectorAll('.sound-btn');
                soundButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const animalBtn = document.querySelector('.sound-btn[data-sound="animal"]');
                if (animalBtn) {
                    animalBtn.classList.add('active');
                }
                
                // 初始化顾老太太打乱状态为关闭
                AppState.grandmaShuffleEnabled = false;
                AppState.grandmaShuffleMode = 'full';
                
                const toggle = document.getElementById('grandmaShuffleToggle');
                const status = document.getElementById('grandmaShuffleStatus');
                
                if (toggle && status) {
                    toggle.classList.remove('active');
                    status.textContent = '当前状态：已关闭';
                }
                
                // 初始化语音播报开关为关闭
                AppState.specialToastEnabled = false;
                const specialToastToggle = document.getElementById('specialToastToggle');
                if (specialToastToggle) {
                    specialToastToggle.classList.remove('active');
                }
            } catch (error) {
                console.error('应用特殊版本设置时出错:', error);
            }
        }

        // 应用普通版本设置
        function applyNormalVersionSettings() {
            try {
                // 隐藏顾老太太打乱设置区域
                const grandmaShuffleSection = document.getElementById('grandmaShuffleSection');
                if (grandmaShuffleSection) {
                    grandmaShuffleSection.style.display = 'none';
                }
                
                // 隐藏答错语音播报设置
                const specialToastSection = document.getElementById('specialToastSection');
                if (specialToastSection) {
                    specialToastSection.style.display = 'none';
                }
                
                // 显示普通打乱设置项
                const shuffleSettingItem = document.getElementById('shuffleSettingItem');
                if (shuffleSettingItem) {
                    shuffleSettingItem.style.display = 'flex';
                }
                
                // 修改设置中的一键打乱标签
                const shuffleLabel = document.getElementById('shuffleLabel');
                if (shuffleLabel) {
                    shuffleLabel.textContent = '一键打乱';
                }
                
                // 修改打乱按钮标题
                const shuffleBtn = document.getElementById('shuffleBtn');
                if (shuffleBtn) {
                    shuffleBtn.title = '一键打乱';
                }
                
                // 设置音效为默认音效
                AppState.soundType = 'correct';
                
                // 更新音效选择按钮状态
                const soundButtons = document.querySelectorAll('.sound-btn');
                soundButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const correctBtn = document.querySelector('.sound-btn[data-sound="correct"]');
                if (correctBtn) {
                    correctBtn.classList.add('active');
                }
            } catch (error) {
                console.error('应用普通版本设置时出错:', error);
            }
        }

        // 显示题目
        function displayQuestion() {
            try {
                if (AppState.currentQuestion < 0 || AppState.currentQuestion >= AppState.questions.length) {
                    console.error('当前题目索引无效');
                    return;
                }
                
                const q = AppState.questions[AppState.currentQuestion];
                if (!q) {
                    console.error('当前题目数据无效');
                    return;
                }
                
                const typeMap = {
                    'single': '单选题',
                    'multiple': '多选题',
                    'judge': '判断题',
                    'sort': '排序题'
                };

                const questionTypeElement = document.getElementById('questionType');
                if (questionTypeElement) {
                    questionTypeElement.textContent = typeMap[q.type] || '未知题型';
                }

                const questionNumberElement = document.getElementById('questionNumber');
                if (questionNumberElement) {
                    questionNumberElement.textContent = `第 ${AppState.currentQuestion + 1} 题`;
                }
                
                const questionTextElement = document.getElementById('questionText');
                if (questionTextElement) {
                    questionTextElement.textContent = q.question || '';
                }

                const container = document.getElementById('optionsContainer');
                if (container) {
                    container.innerHTML = '';
                }
                
                // 隐藏答案反馈
                const feedback = document.getElementById('answerFeedback');
                if (feedback) {
                    feedback.className = 'answer-feedback';
                    feedback.innerHTML = '';
                }

                if (container) {
                    if (q.type === 'sort') {
                        container.className = 'sort-container';
                        displaySortOptions(q);
                    } else if (q.type === 'judge') {
                        container.className = 'options';
                        displayJudgeOptions(q);
                    } else if (q.type === 'multiple') {
                        container.className = 'multiple-container';
                        displayMultipleOptions(q);
                    } else {
                        container.className = 'options';
                        displayNormalOptions(q);
                    }
                }

                updateButtonVisibility();
            } catch (error) {
                console.error('显示题目时出错:', error);
            }
        }

        // 显示普通选项
        function displayNormalOptions(q) {
            try {
                const container = document.getElementById('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                q.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    
                    if (AppState.isAnswered[AppState.currentQuestion]) {
                        const optionChar = String.fromCharCode(65 + index);
                        if (optionChar === q.answer) {
                            optionDiv.classList.add('correct');
                        } else if (AppState.userAnswers[AppState.currentQuestion] === optionChar) {
                            optionDiv.classList.add('incorrect');
                        }
                    } else if (AppState.userAnswers[AppState.currentQuestion]) {
                        if (AppState.userAnswers[AppState.currentQuestion] === String.fromCharCode(65 + index)) {
                            optionDiv.classList.add('selected');
                        }
                    }

                    optionDiv.innerHTML = `
                        <div class="option-label">${String.fromCharCode(65 + index)}</div>
                        <div class="option-text">${option}</div>
                    `;

                    optionDiv.onclick = () => selectOption(index);
                    container.appendChild(optionDiv);
                });
            } catch (error) {
                console.error('显示普通选项时出错:', error);
            }
        }

        // 显示多选题选项
        function displayMultipleOptions(q) {
            try {
                const container = document.getElementById('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                if (AppState.isAnswered[AppState.currentQuestion]) {
                    const resultDiv = document.createElement('div');
                    resultDiv.style.background = '#f8f9fa';
                    resultDiv.style.borderRadius = '10px';
                    resultDiv.style.padding = '20px';
                    
                    const titleDiv = document.createElement('div');
                    titleDiv.style.fontWeight = 'bold';
                    titleDiv.style.marginBottom = '15px';
                    titleDiv.style.color = '#333';
                    titleDiv.textContent = '正确答案：';
                    resultDiv.appendChild(titleDiv);
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.style.display = 'flex';
                    contentDiv.style.flexWrap = 'wrap';
                    contentDiv.style.gap = '8px';
                    
                    q.answer.forEach((char, index) => {
                        const optionIndex = char.charCodeAt(0) - 65;
                        const tagDiv = document.createElement('div');
                        tagDiv.className = 'multiple-answer-tag correct';
                        tagDiv.textContent = `${char}. ${q.options[optionIndex]}`;
                        contentDiv.appendChild(tagDiv);
                    });
                    
                    resultDiv.appendChild(contentDiv);
                    container.appendChild(resultDiv);
                } else {
                    // 创建紧凑的多选题布局
                    const compactDiv = document.createElement('div');
                    compactDiv.className = 'multiple-compact';
                    
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'multiple-header';
                    headerDiv.innerHTML = `
                        <div class="multiple-info">本题需要选择 <strong>${q.answer.length}</strong> 个选项</div>
                        <div class="multiple-actions">
                            <button class="multiple-action-btn" onclick="selectAllOptions()">全选</button>
                            <button class="multiple-action-btn secondary" onclick="clearAllOptions()">清空</button>
                        </div>
                    `;
                    compactDiv.appendChild(headerDiv);
                    
                    const mainDiv = document.createElement('div');
                    mainDiv.className = 'multiple-main';
                    
                    const optionsPanel = document.createElement('div');
                    optionsPanel.className = 'multiple-options-panel';
                    
                    const optionsTitle = document.createElement('div');
                    optionsTitle.className = 'multiple-panel-title';
                    optionsTitle.textContent = '可选选项';
                    optionsPanel.appendChild(optionsTitle);
                    
                    const optionsGrid = document.createElement('div');
                    optionsGrid.className = 'multiple-options-grid';
                    
                    q.options.forEach((option, index) => {
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'multiple-option-item';
                        const optionChar = String.fromCharCode(65 + index);
                        
                        if (AppState.userAnswers[AppState.currentQuestion] && AppState.userAnswers[AppState.currentQuestion].includes(optionChar)) {
                            optionDiv.classList.add('used');
                        }
                        
                        optionDiv.innerHTML = `
                            <div class="multiple-option-letter">${optionChar}</div>
                            <div class="multiple-option-text">${option}</div>
                        `;
                        
                        if (!AppState.userAnswers[AppState.currentQuestion] || !AppState.userAnswers[AppState.currentQuestion].includes(optionChar)) {
                            optionDiv.onclick = () => selectMultipleOption(optionChar);
                        }
                        
                        optionsGrid.appendChild(optionDiv);
                    });
                    
                    optionsPanel.appendChild(optionsGrid);
                    mainDiv.appendChild(optionsPanel);
                    
                    const answerPanel = document.createElement('div');
                    answerPanel.className = 'multiple-answer-panel';
                    
                    const answerTitle = document.createElement('div');
                    answerTitle.className = 'multiple-panel-title';
                    answerTitle.textContent = '已选答案';
                    answerPanel.appendChild(answerTitle);
                    
                    const answerContent = document.createElement('div');
                    answerContent.className = 'multiple-answer-content';
                    
                    if (AppState.userAnswers[AppState.currentQuestion] && AppState.userAnswers[AppState.currentQuestion].length > 0) {
                        AppState.userAnswers[AppState.currentQuestion].forEach((char, index) => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'multiple-answer-tag';
                            itemDiv.innerHTML = `
                                ${char}. ${q.options[optionIndex]}
                                <span class="remove-icon">×</span>
                            `;
                            itemDiv.onclick = () => removeMultipleOption(char);
                            answerContent.appendChild(itemDiv);
                        });
                    } else {
                        answerContent.innerHTML = '<div class="empty-hint">请从左侧选择选项</div>';
                    }
                    
                    answerPanel.appendChild(answerContent);
                    
                    const submitArea = document.createElement('div');
                    submitArea.className = 'multiple-submit-area';
                    
                    const selectedCount = AppState.userAnswers[AppState.currentQuestion] ? AppState.userAnswers[AppState.currentQuestion].length : 0;
                    submitArea.innerHTML = `
                        <div class="multiple-count">
                            已选择 <span class="count-number">${selectedCount}</span> 项
                            ${selectedCount > 0 ? `/ 共 ${q.answer.length} 项` : ''}
                        </div>
                        <button class="multiple-submit-btn" ${selectedCount === 0 ? 'disabled' : ''} onclick="submitMultipleAnswer()">
                            ✓ 提交答案
                        </button>
                    `;
                    
                    answerPanel.appendChild(submitArea);
                    mainDiv.appendChild(answerPanel);
                    
                    compactDiv.appendChild(mainDiv);
                    container.appendChild(compactDiv);
                }
            } catch (error) {
                console.error('显示多选题选项时出错:', error);
            }
        }

        // 显示判断题选项
        function displayJudgeOptions(q) {
            try {
                const container = document.getElementById('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                q.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'judge-option';
                    
                    if (AppState.isAnswered[AppState.currentQuestion]) {
                        const selectedValue = index === 0 ? 'T' : 'F';
                        if (selectedValue === q.answer) {
                            optionDiv.classList.add('correct');
                        } else if (AppState.userAnswers[AppState.currentQuestion] === selectedValue) {
                            optionDiv.classList.add('incorrect');
                        }
                    } else if (AppState.userAnswers[AppState.currentQuestion]) {
                        const selectedValue = index === 0 ? 'T' : 'F';
                        if (AppState.userAnswers[AppState.currentQuestion] === selectedValue) {
                            optionDiv.classList.add('selected');
                        }
                    }

                    optionDiv.innerHTML = `
                        <div class="judge-label">${option}</div>
                    `;

                    optionDiv.onclick = () => selectJudgeOption(index);
                    container.appendChild(optionDiv);
                });
            } catch (error) {
                console.error('显示判断题选项时出错:', error);
            }
        }

        // 显示排序选项
        function displaySortOptions(q) {
            try {
                const container = document.getElementById('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                if (!AppState.userAnswers[AppState.currentQuestion]) {
                    AppState.sortSelectedItems = [];
                } else {
                    AppState.sortSelectedItems = [...AppState.userAnswers[AppState.currentQuestion]];
                }
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'sort-options';
                
                q.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'sort-option';
                    const optionChar = String.fromCharCode(65 + index);
                    
                    if (AppState.sortSelectedItems.includes(optionChar)) {
                        optionDiv.classList.add('used');
                    }
                    
                    if (AppState.isAnswered[AppState.currentQuestion]) {
                        optionDiv.classList.add('locked');
                        optionDiv.style.cursor = 'not-allowed';
                        optionDiv.style.opacity = '0.6';
                    }
                    
                    optionDiv.innerHTML = `
                        <div class="sort-number">${index + 1}</div>
                        <div class="sort-text">${option}</div>
                    `;
                    
                    if (!AppState.sortSelectedItems.includes(optionChar) && !AppState.isAnswered[AppState.currentQuestion]) {
                        optionDiv.onclick = () => selectSortOption(optionChar, option);
                    }
                    
                    optionsDiv.appendChild(optionDiv);
                });
                
                container.appendChild(optionsDiv);
                
                const answerDiv = document.createElement('div');
                answerDiv.className = 'sort-answer-area';
                answerDiv.id = 'sortAnswerArea';
                
                if (AppState.sortSelectedItems.length > 0) {
                    AppState.sortSelectedItems.forEach((char, index) => {
                        const optionIndex = char.charCodeAt(0) - 65;
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'sort-answer-item';
                        
                        const isLocked = AppState.isAnswered[AppState.currentQuestion];
                        
                        if (isLocked) {
                            itemDiv.classList.add('locked');
                        }
                        
                        itemDiv.textContent = q.options[optionIndex];
                        
                        if (!isLocked) {
                            itemDiv.onclick = () => removeSortOption(char);
                        }
                        
                        answerDiv.appendChild(itemDiv);
                        
                        if (index < AppState.sortSelectedItems.length - 1) {
                            const arrowDiv = document.createElement('span');
                            arrowDiv.className = 'sort-arrow';
                            arrowDiv.textContent = '→';
                            answerDiv.appendChild(arrowDiv);
                        }
                    });
                } else {
                    answerDiv.innerHTML = '<span style="color: #999;">请按顺序点击左侧选项</span>';
                }
                
                container.appendChild(answerDiv);
                
                // 添加提交按钮（仅在未提交时显示）
                if (!AppState.isAnswered[AppState.currentQuestion]) {
                    const submitContainer = document.createElement('div');
                    submitContainer.className = 'sort-submit-container';
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.className = 'sort-submit-btn';
                    submitBtn.innerHTML = '✓ 提交答案';
                    submitBtn.disabled = AppState.sortSelectedItems.length === 0;
                    submitBtn.onclick = () => submitSortAnswer();
                    
                    submitContainer.appendChild(submitBtn);
                    container.appendChild(submitContainer);
                }
            } catch (error) {
                console.error('显示排序选项时出错:', error);
            }
        }

        // 提交排序题答案
        function submitSortAnswer() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                // 检查是否已选择所有选项
                if (AppState.sortSelectedItems.length !== q.answer.length) {
                    alert(`请选择所有 ${q.answer.length} 个选项后再提交`);
                    return;
                }
                
                // 标记为已提交
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                AppState.isAnswered[AppState.currentQuestion] = true;
                
                // 检查答案是否正确
                const isCorrect = JSON.stringify(AppState.sortSelectedItems) === JSON.stringify(q.answer);
                
                if (isCorrect) {
                    playSound(true);
                    showAnswerFeedback(true, '排序正确！');
                    updateButtonVisibility();
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                nextQuestion();
                            }
                        }, 500);
                    }
                } else {
                    playSound(false);
                    const feedback = document.getElementById('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback incorrect';
                        feedback.innerHTML = '排序已锁定';
                    }
                    
                    updateButtonVisibility();
                }
                
                // 重新显示排序选项，更新UI状态
                displaySortOptions(q);
            } catch (error) {
                console.error('提交排序题答案时出错:', error);
            }
        }

        // 选择排序选项
        function selectSortOption(optionChar, optionText) {
            try {
                const q = AppState.questions[AppState.currentQuestion];
                
                // 检查是否已提交答案
                if (AppState.isAnswered[AppState.currentQuestion]) {
                    return;
                }
                
                AppState.sortSelectedItems.push(optionChar);
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                
                displaySortOptions(q);
            } catch (error) {
                console.error('选择排序选项时出错:', error);
            }
        }

        // 移除排序选项
        function removeSortOption(optionChar) {
            try {
                // 检查是否已提交答案
                if (AppState.isAnswered[AppState.currentQuestion]) {
                    return;
                }
                
                const q = AppState.questions[AppState.currentQuestion];
                
                const index = AppState.sortSelectedItems.indexOf(optionChar);
                if (index > -1) {
                    AppState.sortSelectedItems.splice(index, 1);
                    AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                    
                    displaySortOptions(q);
                    
                    const feedback = document.getElementById('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback';
                        feedback.innerHTML = '';
                    }
                    
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('移除排序选项时出错:', error);
            }
        }

        // 显示答案反馈
        function showAnswerFeedback(isCorrect, message) {
            try {
                const feedback = document.getElementById('answerFeedback');
                if (!feedback) return;
                
                feedback.className = `answer-feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
                feedback.innerHTML = message;
            } catch (error) {
                console.error('显示答案反馈时出错:', error);
            }
        }

        // 选择选项
        function selectOption(index) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;

                const q = AppState.questions[AppState.currentQuestion];
                const selectedChar = String.fromCharCode(65 + index);

                if (q.type === 'multiple') {
                    if (!AppState.userAnswers[AppState.currentQuestion]) {
                        AppState.userAnswers[AppState.currentQuestion] = [];
                    }
                    const answerIndex = AppState.userAnswers[AppState.currentQuestion].indexOf(selectedChar);
                    if (answerIndex > -1) {
                        AppState.userAnswers[AppState.currentQuestion].splice(answerIndex, 1);
                    } else {
                        AppState.userAnswers[AppState.currentQuestion].push(selectedChar);
                    }
                    
                    const isCorrect = q.answer.includes(selectedChar);
                    playSound(isCorrect);
                    
                    if (!isCorrect) {
                        AppState.isAnswered[AppState.currentQuestion] = true;
                        const correctOptions = q.answer.map(char => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[optionIndex]}`;
                        }).join(', ');
                        
                        const userOptions = AppState.userAnswers[AppState.currentQuestion].map(char => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[optionIndex]}`;
                        }).join(', ');
                        
                        showAnswerFeedback(false, `回答错误。正确答案：${correctOptions}，您选择了：${userOptions}`);
                    }
                } else {
                    AppState.userAnswers[AppState.currentQuestion] = selectedChar;
                    const isCorrect = AppState.userAnswers[AppState.currentQuestion] === q.answer;
                    playSound(isCorrect);
                    AppState.isAnswered[AppState.currentQuestion] = true;
                    
                    const correctOption = `${q.answer}. ${q.options[q.answer.charCodeAt(0) - 65]}`;
                    const userOption = `${selectedChar}. ${q.options[index]}`;
                    
                    if (isCorrect) {
                        showAnswerFeedback(true, `回答正确！正确答案：${correctOption}，您选择了：${userOption}`);
                        
                        if (AppState.autoNextEnabled) {
                            setTimeout(() => {
                                if (AppState.currentQuestion < AppState.questions.length - 1) {
                                    nextQuestion();
                                }
                            }, 500);
                        }
                    } else {
                        showAnswerFeedback(false, `回答错误。正确答案：${correctOption}，您选择了：${userOption}`);
                        
                        // 10086版本特殊功能 - 答错题目时触发
                        if (AppState.isSpecialVersion) {
                            updateCharacterFace(false);
                        }
                    }
                }

                displayQuestion();
                updateButtonVisibility();
            } catch (error) {
                console.error('选择选项时出错:', error);
            }
        }

        // 选择判断题选项
        function selectJudgeOption(index) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;

                const q = AppState.questions[AppState.currentQuestion];
                const selectedValue = index === 0 ? 'T' : 'F';
                const selectedText = q.options[index];
                
                AppState.userAnswers[AppState.currentQuestion] = selectedValue;
                const isCorrect = AppState.userAnswers[AppState.currentQuestion] === q.answer;
                playSound(isCorrect);
                AppState.isAnswered[AppState.currentQuestion] = true;
                
                const correctText = q.answer === 'T' ? q.options[0] : q.options[1];
                
                if (isCorrect) {
                    showAnswerFeedback(true, `回答正确！正确答案：${correctText}，您选择了：${selectedText}`);
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                        nextQuestion();
                                    }
                                }, 500);
                    }
                } else {
                    showAnswerFeedback(false, `回答错误。正确答案：${correctText}，您选择了：${selectedText}`);
                    
                    // 10086版本特殊功能 - 答错题目时触发
                    if (AppState.isSpecialVersion) {
                        updateCharacterFace(false);
                    }
                }

                displayQuestion();
                updateButtonVisibility();
            } catch (error) {
                console.error('选择判断题选项时出错:', error);
            }
        }

        // 提交多选题答案
        function submitMultipleAnswer() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                const userAnswers = AppState.userAnswers[AppState.currentQuestion] || [];
                const correctAnswers = q.answer;
                
                // 检查答案是否正确
                const isCorrect = userAnswers.length === correctAnswers.length && 
                                userAnswers.every(ans => correctAnswers.includes(ans));
                
                AppState.isAnswered[AppState.currentQuestion] = true;
                
                playSound(isCorrect);
                
                // 显示反馈
                const correctOptionsText = correctAnswers.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return `${char}. ${q.options[index]}`;
                }).join(', ');
                
                const userOptionsText = userAnswers.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return `${char}. ${q.options[index]}`;
                }).join(', ');
                
                if (isCorrect) {
                    showAnswerFeedback(true, `回答正确！正确答案：${correctOptionsText}，您选择了：${userOptionsText}`);
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                nextQuestion();
                            }
                        }, 500);
                    }
                } else {
                    showAnswerFeedback(false, `回答错误。正确答案：${correctOptionsText}，您选择了：${userOptionsText}`);
                    
                    // 10086版本特殊功能 - 答错题目时触发
                    if (AppState.isSpecialVersion) {
                        updateCharacterFace(false);
                    }
                }
                
                displayQuestion();
                updateButtonVisibility();
            } catch (error) {
                console.error('提交多选题答案时出错:', error);
            }
        }

        // 全选所有选项
        function selectAllOptions() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                AppState.userAnswers[AppState.currentQuestion] = [];
                
                for (let i = 0; i < q.options.length; i++) {
                    AppState.userAnswers[AppState.currentQuestion].push(String.fromCharCode(65 + i));
                }
                
                playSound(true);
                displayQuestion();
            } catch (error) {
                console.error('全选所有选项时出错:', error);
            }
        }

        // 清空所有选项
        function clearAllOptions() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                AppState.userAnswers[AppState.currentQuestion] = [];
                
                playSound(false);
                displayQuestion();
            } catch (error) {
                console.error('清空所有选项时出错:', error);
            }
        }

        // 选择多选题选项
        function selectMultipleOption(optionChar) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                if (!AppState.userAnswers[AppState.currentQuestion]) {
                    AppState.userAnswers[AppState.currentQuestion] = [];
                }
                
                AppState.userAnswers[AppState.currentQuestion].push(optionChar);
                
                playSound(true);
                displayQuestion();
            } catch (error) {
                console.error('选择多选题选项时出错:', error);
            }
        }

        // 移除多选题选项
        function removeMultipleOption(optionChar) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                const index = AppState.userAnswers[AppState.currentQuestion].indexOf(optionChar);
                if (index > -1) {
                    AppState.userAnswers[AppState.currentQuestion].splice(index, 1);
                    
                    displayQuestion();
                    
                    const feedback = document.getElementById('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback';
                        feedback.innerHTML = '';
                    }
                    
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('移除多选题选项时出错:', error);
            }
        }

        // 更新按钮可见性
        function updateButtonVisibility() {
            try {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (!prevBtn || !nextBtn) {
                    console.error('按钮元素未找到');
                    return;
                }
                
                prevBtn.disabled = AppState.currentQuestion === 0;
                
                if (AppState.currentQuestion === AppState.questions.length - 1) {
                    nextBtn.disabled = true;
                } else {
                    nextBtn.disabled = false;
                }
            } catch (error) {
                console.error('更新按钮可见性时出错:', error);
            }
        }

        // 上一题
        function previousQuestion() {
            try {
                if (AppState.currentQuestion > 0) {
                    AppState.currentQuestion--;
                    displayQuestion();
                    updateProgress();
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('上一题时出错:', error);
            }
        }

        // 下一题
        function nextQuestion() {
            try {
                if (AppState.currentQuestion < AppState.questions.length - 1) {
                    AppState.currentQuestion++;
                    displayQuestion();
                    updateProgress();
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('下一题时出错:', error);
            }
        }

        // 更新进度
        function updateProgress() {
            try {
                const progress = ((AppState.currentQuestion + 1) / AppState.questions.length) * 100;
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');
                
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
                
                if (progressText) {
                    progressText.textContent = `第 ${AppState.currentQuestion + 1} 题 / 共 ${AppState.questions.length} 题`;
                }
            } catch (error) {
                console.error('更新进度时出错:', error);
            }
        }

        // 返回主界面
        function backToMain() {
            // 重置考试状态
            AppState.currentQuestion = 0;
            AppState.userAnswers = [];
            AppState.isAnswered = [];
            
            // 切换到主页面
            document.getElementById('examPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            AppState.currentPage = 'main';
            
            // 重置人物脸部状态
            const characterFace = document.getElementById('characterFace');
            if (characterFace) {
                characterFace.className = 'character-face normal';
                characterFace.style.display = 'none';
            }
            
            // 清除特殊弹窗定时器
            if (AppState.specialToastTimeout) {
                clearTimeout(AppState.specialToastTimeout);
                AppState.specialToastTimeout = null;
            }
            
            // 隐藏特殊弹窗
            const specialToast = document.getElementById('specialToast');
            if (specialToast) {
                specialToast.style.display = 'none';
                specialToast.classList.remove('hiding');
            }
            AppState.specialToastActive = false;
        }

        // 打开设置
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            generateSoundOptions();
            
            // 设置自动下一题开关的状态
            const autoNextToggle = document.getElementById('autoNextToggle');
            if (autoNextToggle) {
                if (AppState.autoNextEnabled) {
                    autoNextToggle.classList.add('active');
                } else {
                    autoNextToggle.classList.remove('active');
                }
            }
            
            // 设置语音播报开关的状态
            if (AppState.isSpecialVersion) {
                const specialToastToggle = document.getElementById('specialToastToggle');
                if (specialToastToggle) {
                    if (AppState.specialToastEnabled) {
                        specialToastToggle.classList.add('active');
                    } else {
                        specialToastToggle.classList.remove('active');
                    }
                }
            }
        }

        // 关闭设置
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // 切换自动下一题
        function toggleAutoNext() {
            try {
                const toggle = document.getElementById('autoNextToggle');
                if (toggle) {
                    toggle.classList.toggle('active');
                    AppState.autoNextEnabled = toggle.classList.contains('active');
                }
            } catch (error) {
                console.error('切换自动下一题时出错:', error);
            }
        }

        // 切换语音播报开关
        function toggleSpecialToast() {
            try {
                const toggle = document.getElementById('specialToastToggle');
                if (toggle) {
                    toggle.classList.toggle('active');
                    AppState.specialToastEnabled = toggle.classList.contains('active');
                    
                    // 如果开启语音播报但音频未激活，显示激活按钮
                    if (AppState.specialToastEnabled && !AppState.audioActivated && !AppState.speechSynthesisSupported) {
                        showAudioActivationButton();
                    }
                }
            } catch (error) {
                console.error('切换语音播报开关时出错:', error);
            }
        }

        // 切换顾老太太打乱
        function toggleGrandmaShuffle() {
            try {
                const toggle = document.getElementById('grandmaShuffleToggle');
                const status = document.getElementById('grandmaShuffleStatus');
                
                if (!toggle || !status) return;
                
                // 如果当前是开启状态，则关闭
                if (AppState.grandmaShuffleEnabled) {
                    AppState.grandmaShuffleEnabled = false;
                    toggle.classList.remove('active');
                    status.textContent = '当前状态：已关闭';
                } else {
                    // 显示打乱方式选择弹窗
                    AppState.grandmaShuffleEnabled = true;
                    toggle.classList.add('active');
                    status.textContent = `当前状态：已开启 (全部打乱)`;
                }
            } catch (error) {
                console.error('切换顾老太太打乱时出错:', error);
            }
        }

        // 切换题目顺序
        function toggleShuffle() {
            try {
                // 这里可以添加打乱题目顺序的逻辑
                alert('打乱功能开发中...');
            } catch (error) {
                console.error('切换题目顺序时出错:', error);
            }
        }

        // 从设置中切换打乱功能
        function toggleShuffleFromSettings() {
            try {
                // 这里可以添加打乱题目顺序的逻辑
                alert('打乱功能开发中...');
            } catch (error) {
                console.error('从设置中切换打乱功能时出错:', error);
            }
        }

        // 生成音效选项
        function generateSoundOptions() {
            try {
                const soundOptionsContainer = document.getElementById('soundOptions');
                if (!soundOptionsContainer) {
                    console.error('音效选项容器未找到');
                    return;
                }
                
                soundOptionsContainer.innerHTML = '';
                
                if (AppState.isSpecialVersion) {
                    const animalBtn = document.createElement('div');
                    animalBtn.className = 'sound-btn active';
                    animalBtn.dataset.sound = 'animal';
                    animalBtn.innerHTML = `
                        <span>动物叫声</span>
                        <span class="sound-preview" onclick="previewSound(event, 'animal')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(animalBtn);
                } else {
                    const correctBtn = document.createElement('div');
                    correctBtn.className = 'sound-btn active';
                    correctBtn.dataset.sound = 'correct';
                    correctBtn.innerHTML = `
                        <span>答对音效</span>
                        <span class="sound-preview" onclick="previewSound(event, 'correct')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(correctBtn);
                    
                    const incorrectBtn = document.createElement('div');
                    incorrectBtn.className = 'sound-btn';
                    incorrectBtn.dataset.sound = 'incorrect';
                    incorrectBtn.innerHTML = `
                        <span>答错音效</span>
                        <span class="sound-preview" onclick="previewSound(event, 'incorrect')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(incorrectBtn);
                }
            } catch (error) {
                console.error('生成音效选项时出错:', error);
            }
        }

        // 播放音效
        function playSound(isCorrect) {
            try {
                // 确保音频上下文已初始化
                if (!AppState.audioContext && !AppState.isSpecialVersion) {
                    initAudioContext();
                }
                
                if (AppState.isSpecialVersion) {
                    playExternalSound(isCorrect);
                    return;
                }
                
                // 检查音频上下文状态
                if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        generateBuiltInSound(isCorrect);
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                        // 尝试直接播放音效
                        generateBuiltInSound(isCorrect);
                    });
                } else {
                    generateBuiltInSound(isCorrect);
                }
            } catch (error) {
                console.error('播放音效时出错:', error);
            }
        }

        // 播放外部音效
        function playExternalSound(isCorrect) {
            try {
                let soundToPlay = isCorrect ? AppState.correctSound : AppState.incorrectSound;
                if (soundToPlay) {
                    soundToPlay.currentTime = 0;
                    soundToPlay.play().catch(e => {
                        console.error('播放外部音效失败:', e);
                        // 降级到内置音效
                        generateBuiltInSound(isCorrect);
                    });
                } else {
                    // 降级到内置音效
                    generateBuiltInSound(isCorrect);
                }
            } catch (error) {
                console.error('播放外部音效出错:', error);
                generateBuiltInSound(isCorrect);
            }
        }

        // 生成内置音效
        function generateBuiltInSound(isCorrect) {
            try {
                // 如果没有音频上下文，尝试创建
                if (!AppState.audioContext) {
                    try {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        AppState.audioContext = new AudioContext();
                    } catch (e) {
                        console.error('Web Audio API不可用:', e);
                        return;
                    }
                }
                
                // 如果音频上下文被暂停，尝试恢复
                if (AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        createSound(isCorrect);
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                        createSound(isCorrect);
                    });
                } else {
                    createSound(isCorrect);
                }
            } catch (error) {
                console.error('生成内置音效时出错:', error);
            }
        }

        // 创建音效
        function createSound(isCorrect) {
            try {
                if (!AppState.audioContext) return;
                
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                let frequency = 440;
                let duration = 0.2;
                let typeWave = 'sine';
                
                if (isCorrect) {
                    frequency = 523.25;
                    duration = 0.3;
                    typeWave = 'sine';
                    
                    // 添加第二个振荡器创建更丰富的音效
                    const oscillator2 = AppState.audioContext.createOscillator();
                    const gainNode2 = AppState.audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(AppState.audioContext.destination);
                    
                    oscillator2.type = 'sine';
                    oscillator2.frequency.setValueAtTime(659.25, AppState.audioContext.currentTime);
                    gainNode2.gain.setValueAtTime(0.2, AppState.audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.3);
                    
                    oscillator2.start();
                    oscillator2.stop(AppState.audioContext.currentTime + 0.3);
                } else {
                    frequency = 261.63;
                    duration = 0.4;
                    typeWave = 'triangle';
                    
                    // 添加第二个振荡器创建更丰富的音效
                    const oscillator2 = AppState.audioContext.createOscillator();
                    const gainNode2 = AppState.audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(AppState.audioContext.destination);
                    
                    oscillator2.type = 'sawtooth';
                    oscillator2.frequency.setValueAtTime(220.00, AppState.audioContext.currentTime);
                    gainNode2.gain.setValueAtTime(0.2, AppState.audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.4);
                    
                    oscillator2.start();
                    oscillator2.stop(AppState.audioContext.currentTime + 0.4);
                }
                
                oscillator.type = typeWave;
                oscillator.frequency.setValueAtTime(frequency, AppState.audioContext.currentTime);
                
                // 增加音量设置
                gainNode.gain.setValueAtTime(0, AppState.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.8, AppState.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.4, AppState.audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + duration);
                
                return oscillator;
            } catch (error) {
                console.error('创建音效时出错:', error);
            }
        }

        // 10086版本特殊功能 - 播放特殊语音
        function playSpecialToast() {
            try {
                if (!AppState.isSpecialVersion) return;
                
                // 检查语音播报开关是否开启
                if (!AppState.specialToastEnabled) {
                    return;
                }
                
                // 如果已经有弹窗在显示，先清除定时器
                if (AppState.specialToastTimeout) {
                    clearTimeout(AppState.specialToastTimeout);
                    AppState.specialToastTimeout = null;
                }
                
                const specialToast = document.getElementById('specialToast');
                if (!specialToast) return;
                
                // 如果弹窗已经在显示中，先移除消失类
                if (AppState.specialToastActive) {
                    specialToast.classList.remove('hiding');
                }
                
                // 显示弹窗
                specialToast.style.display = 'block';
                specialToast.classList.remove('hiding');
                AppState.specialToastActive = true;
                
                // 显示语音状态指示器
                showVoiceStatusIndicator();
                
                // 检查是否支持语音合成
                if (AppState.speechSynthesisSupported && AppState.specialToastAudio) {
                    // 使用Web Speech API播放语音
                    const utterance = new SpeechSynthesisUtterance(AppState.specialToastAudio.text);
                    utterance.lang = AppState.specialToastAudio.lang;
                    utterance.rate = AppState.specialToastAudio.rate;
                    utterance.pitch = AppState.specialToastAudio.pitch;
                    utterance.volume = AppState.specialToastAudio.volume;
                    
                    // 确保音频上下文已激活
                    if (!AppState.audioActivated) {
                        // 尝试激活音频上下文
                        if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                            AppState.audioContext.resume().then(() => {
                                AppState.audioActivated = true;
                                speakUtterance(utterance);
                            }).catch(e => {
                                console.error('激活音频上下文失败:', e);
                                speakUtterance(utterance);
                            });
                        } else {
                            speakUtterance(utterance);
                        }
                    } else {
                        speakUtterance(utterance);
                    }
                } else {
                    // 如果语音API不可用，3秒后自动隐藏
                    AppState.specialToastTimeout = setTimeout(() => {
                        specialToast.classList.add('hiding');
                        setTimeout(() => {
                            specialToast.style.display = 'none';
                            specialToast.classList.remove('hiding');
                            AppState.specialToastActive = false;
                            AppState.specialToastTimeout = null;
                            hideVoiceStatusIndicator();
                        }, 1500);
                    }, 3000);
                }
            } catch (error) {
                console.error('播放特殊语音时出错:', error);
            }
        }

        // 显示语音状态指示器
        function showVoiceStatusIndicator() {
            try {
                const voiceIndicator = document.getElementById('voiceStatusIndicator');
                if (voiceIndicator) {
                    voiceIndicator.classList.add('show');
                }
            } catch (error) {
                console.error('显示语音状态指示器时出错:', error);
            }
        }

        // 隐藏语音状态指示器
        function hideVoiceStatusIndicator() {
            try {
                const voiceIndicator = document.getElementById('voiceStatusIndicator');
                if (voiceIndicator) {
                    voiceIndicator.classList.remove('show');
                }
            } catch (error) {
                console.error('隐藏语音状态指示器时出错:', error);
            }
        }

        // 10086版本特殊功能 - 优化人物脸部状态动画
        function updateCharacterFace(isCorrect) {
            try {
                if (!AppState.isSpecialVersion) return;
                
                const characterFace = document.getElementById('characterFace');
                if (!characterFace) return;
                
                if (isCorrect) {
                    // 答对题目，增加连续答对计数
                    AppState.consecutiveCorrectCount++;
                    AppState.correctCountInSpecialVersion++;
                    
                    // 如果正在恢复动画中，不重复触发
                    if (AppState.isRecovering) {
                        return;
                    }
                    
                    // 连续答对5道题及以上，脸部恢复
                    if (AppState.consecutiveCorrectCount >= 5) {
                        AppState.isRecovering = true;
                        characterFace.classList.remove('swollen');
                        characterFace.classList.add('recovering');
                        
                        // 恢复动画结束后移除类
                        setTimeout(() => {
                            characterFace.classList.remove('recovering');
                            characterFace.classList.add('normal');
                            AppState.isRecovering = false;
                            AppState.consecutiveCorrectCount = 0;
                        }, 2000);
                    }
                } else {
                    // 答错题目，重置连续答对计数，脸部肿胀
                    AppState.consecutiveCorrectCount = 0;
                    AppState.isRecovering = false;
                    
                    characterFace.classList.remove('normal', 'recovering');
                    characterFace.classList.add('swollen');
                    
                    // 播放特殊语音（仅在开关开启时）
                    playSpecialToast();
                }
            } catch (error) {
                console.error('更新人物脸部状态时出错:', error);
            }
        }

        // 预览音效
        function previewSound(event, soundType) {
            event.stopPropagation();
            
            if (AppState.isPreviewing) {
                return;
            }
            
            const previewBtn = event.target;
            if (!previewBtn) {
                console.error('预览按钮未找到');
                return;
            }
            
            if (AppState.isSpecialVersion && soundType === 'animal') {
                previewExternalSound(soundType);
                return;
            }
            
            // 确保音频上下文已初始化
            if (!AppState.audioContext) {
                initAudioContext();
            }
            
            previewBtn.classList.add('playing');
            AppState.isPreviewing = true;
            
            if (AppState.audioContext.state === 'suspended') {
                AppState.audioContext.resume().then(() => {
                    createSound(true);
                    showToast(`正在播放: ${getSoundName(soundType)}`);
                    
                    setTimeout(() => {
                        previewBtn.classList.remove('playing');
                        AppState.isPreviewing = false;
                    }, 600);
                }).catch(e => {
                    console.error('恢复AudioContext失败:', e);
                    previewBtn.classList.remove('playing');
                    AppState.isPreviewing = false;
                    showToast(`预览"${getSoundName(soundType)}"音效失败`);
                });
            } else {
                createSound(true);
                showToast(`正在播放: ${getSoundName(soundType)}`);
                
                setTimeout(() => {
                    previewBtn.classList.remove('playing');
                    AppState.isPreviewing = false;
                }, 600);
            }
        }

        // 预览外部音效
        function previewExternalSound(soundType) {
            if (soundType === 'animal') {
                if (AppState.correctSound) {
                    AppState.correctSound.currentTime = 0;
                    AppState.correctSound.play().catch(e => {
                        console.error('预览外部音效失败:', e);
                        showToast('预览音效失败');
                    });
                    showToast('正在播放: 动物叫声 (答对音效)');
                } else {
                    showToast('音效未加载完成');
                }
            }
        }

        // 获取音效名称
        function getSoundName(type) {
            const names = {
                'correct': '答对音效',
                'incorrect': '答错音效',
                'animal': '动物叫声'
            };
            return names[type] || type;
        }

        // 显示提示消息
        function showToast(message, type = 'error') {
            try {
                // 移除已存在的提示
                const existingToast = document.querySelector(`.${type}-toast`);
                if (existingToast) {
                    existingToast.remove();
                }
                
                // 创建新的提示
                const toast = document.createElement('div');
                toast.className = `${type}-toast`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                // 3秒后自动移除
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 3000);
            } catch (error) {
                console.error('显示提示消息时出错:', error);
            }
        }

        // 打开答题卡
        function openAnswerCard() {
            document.getElementById('answerCardModal').classList.add('active');
            displayQuestionGrid();
        }

        // 关闭答题卡
        function closeAnswerCard() {
            document.getElementById('answerCardModal').classList.remove('active');
        }

        // 显示题目网格
        function displayQuestionGrid() {
            try {
                const grid = document.getElementById('questionGrid');
                if (!grid) {
                    console.error('题目网格未找到');
                    return;
                }
                
                grid.innerHTML = '';
                
                AppState.questions.forEach((q, index) => {
                    const btn = document.createElement('div');
                    btn.className = 'question-btn';
                    
                    if (index === AppState.currentQuestion) {
                        btn.classList.add('current');
                    } else if (!AppState.isAnswered[index] || AppState.userAnswers[index] === null) {
                        btn.classList.add('unanswered');
                    } else {
                        let isCorrect = false;
                        if (q.type === 'multiple') {
                            const userAnswer = AppState.userAnswers[index] || [];
                            isCorrect = userAnswer.length === q.answer.length && 
                            userAnswer.every(ans => q.answer.includes(ans));
                        } else if (q.type === 'sort') {
                            const userAnswer = AppState.userAnswers[index] || [];
                            isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                        } else {
                            isCorrect = AppState.userAnswers[index] === q.answer;
                        }
                        
                        if (isCorrect) {
                            btn.classList.add('correct');
                        } else {
                            btn.classList.add('incorrect');
                        }
                    }
                    
                    btn.textContent = index + 1;
                    btn.onclick = () => goToQuestion(index);
                    grid.appendChild(btn);
                });
            } catch (error) {
                console.error('显示题目网格时出错:', error);
            }
        }

        // 跳转到指定题目
        function goToQuestion(index) {
            AppState.currentQuestion = index;
            displayQuestion();
            updateProgress();
            updateButtonVisibility();
            closeAnswerCard();
        }

        // 提交答案
        function submitAnswers() {
            try {
                let correctCount = 0;
                let totalScore = 0;
                let maxScore = 0;
                
                AppState.questions.forEach((q, index) => {
                    let score = 0;
                    let isCorrect = false;
                    
                    if (q.type === 'single') {
                        score = 2;
                        maxScore += 2;
                        isCorrect = AppState.userAnswers[index] === q.answer;
                    } else if (q.type === 'multiple') {
                        score = 3;
                        maxScore += 3;
                        const userAnswer = AppState.userAnswers[index] || [];
                        isCorrect = userAnswer.length === q.answer.length && 
                                   userAnswer.every(ans => q.answer.includes(ans));
                    } else if (q.type === 'judge') {
                        score = 1;
                        maxScore += 1;
                        isCorrect = AppState.userAnswers[index] === q.answer;
                    } else if (q.type === 'sort') {
                        score = 3;
                        maxScore += 3;
                        const userAnswer = AppState.userAnswers[index] || [];
                        isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                    }
                    
                    if (isCorrect) {
                        correctCount++;
                        totalScore += score;
                    }
                });
                
                const percentage = Math.round((totalScore / maxScore) * 100);
                
                // 保存历史记录
                const historyRecord = {
                    date: new Date().toLocaleString(),
                    examTitle: '随机练习',
                    totalScore: totalScore,
                    maxScore: maxScore,
                    percentage: percentage,
                    correctCount: correctCount,
                    totalQuestions: AppState.questions.length
                };
                
                AppState.historyRecords.push(historyRecord);
                saveHistoryRecords();
                
                // 显示结果
                showResult(totalScore, maxScore, percentage, correctCount);
            } catch (error) {
                console.error('提交答案时出错:', error);
            }
        }

        // 显示结果
        function showResult(score, maxScore, percentage, correctCount) {
            document.getElementById('resultScore').innerHTML = `
                <h2>得分：${score}/${maxScore} (${percentage}%)</h2>
                <p>答对 ${correctCount} 题，共 ${AppState.questions.length} 题</p>
            `;
            
            document.getElementById('resultDetails').innerHTML = `
                <div class="result-row">
                    <div class="result-label">选择题</div>
                    <div class="result-value">${AppState.questions.filter(q => q.type === 'single').length * 2}分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">多选题</div>
                    <div class="result-value">${AppState.questions.filter(q => q.type === 'multiple').length * 3}分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">判断题</div>
                    <div class="result-value">${AppState.questions.filter(q => q.type === 'judge').length * 1}分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">排序题</div>
                    <div class="result-value">${AppState.questions.filter(q => q.type === 'sort').length * 3}分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">总分</div>
                    <div class="result-value">${score}分/${maxScore}分</div>
                </div>
            `;
            
            document.getElementById('resultModal').classList.add('active');
        }

        // 关闭结果
        function closeResult() {
            document.getElementById('resultModal').classList.remove('active');
            backToMain();
        }

        // 显示历史记录
        function showHistoryRecords() {
            alert(`历史记录总数：${AppState.historyRecords.length}`);
        }

        // 显示错题记录
        function showWrongAnswers() {
            alert(`错题记录总数：${AppState.wrongAnswers.length}`);
        }

        // 保存历史记录
        function saveHistoryRecords() {
            localStorage.setItem('historyRecords', JSON.stringify(AppState.historyRecords));
        }

        // 加载历史记录
        function loadHistoryRecords() {
            const saved = localStorage.getItem('historyRecords');
            if (saved) {
                AppState.historyRecords = JSON.parse(saved);
            }
        }

        // 保存错题记录
        function saveWrongAnswers() {
            localStorage.setItem('wrongAnswers', JSON.stringify(AppState.wrongAnswers));
        }

        // 加载错题记录
        function loadWrongAnswers() {
            const saved = localStorage.getItem('wrongAnswers');
            if (saved) {
                AppState.wrongAnswers = JSON.parse(saved);
            }
        }

        // 显示操作成功提示模态框
        function showSuccessModal(title, message) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.add('active');
        }

        // 关闭操作成功提示模态框
        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        // 打开设置
        function openSettings() {
            document.getElementById('settingModal').classList.add('active');
            // 更新开关状态
            const toggle = document.getElementById('policeLightToggle');
            if (AppState.policeLightEnabled) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        // 关闭设置
        function closeSettingModal() {
            document.getElementById('settingModal').classList.remove('active');
        }

        // 切换警灯效果
        function togglePoliceLight() {
            const toggle = document.getElementById('policeLightToggle');
            const passwordSection = document.getElementById('passwordSection');
            
            if (toggle.classList.contains('active')) {
                // 当前是开启状态，要关闭，需要验证密码
                passwordSection.style.display = 'block';
            } else {
                // 当前是关闭状态，要开启，无需验证
                toggle.classList.add('active');
                AppState.policeLightEnabled = true;
                document.body.style.animationPlayState = 'running';
            }
        }

        // 验证警灯密码
        function verifyPolicePassword() {
            const password = document.getElementById('policePassword').value;
            if (password === AppState.policeLightPassword) {
                // 验证成功，关闭警灯效果
                const toggle = document.getElementById('policeLightToggle');
                toggle.classList.remove('active');
                AppState.policeLightEnabled = false;
                document.body.style.animationPlayState = 'paused';
                // 隐藏密码输入区域
                document.getElementById('passwordSection').style.display = 'none';
                // 清空密码输入框
                document.getElementById('policePassword').value = '';
                // 关闭弹窗
                closeSettingModal();
            } else {
                alert('密码错误');
            }
        }

        // 显示更新公告
        function showUpdateNotice() {
            document.getElementById('noticeModal').classList.add('active');
        }

        // 关闭更新公告
        function closeNoticeModal() {
            document.getElementById('noticeModal').classList.remove('active');
        }

        // 添加特殊管理员账号
        function addSpecialAdmin() {
            // 检查是否已存在特殊管理员账号
            const existingSpecialAdmin = AppState.users.find(u => u.account === AppState.specialAdminAccount);
            if (!existingSpecialAdmin) {
                const specialAdmin = {
                    id: Date.now(),
                    username: '特殊管理员',
                    account: AppState.specialAdminAccount,
                    password: AppState.specialAdminPassword,
                    registerTime: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    status: 'active',
                    role: 2  // 特殊管理员权限级别为2
                };
                AppState.users.push(specialAdmin);
                saveUsers();
            }
        }

        // 初始化音频上下文
        function initAudioContext() {
            try {
                if (!AppState.audioContext) {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    AppState.audioContext = new AudioContext();
                }
            } catch (error) {
                console.error('初始化AudioContext失败:', error);
            }
        }

        // 初始化警灯效果
        function initPoliceLight() {
            // 默认开启警灯效果
            AppState.policeLightEnabled = true;
            document.body.style.animationPlayState = 'running';
        }

        // 初始化背景音乐
        function initBackgroundMusic() {
            AppState.bgMusic = document.getElementById('bgMusic');
            // 设置音乐音量
            AppState.bgMusic.volume = 1;
        }

        // 播放背景音乐
        function playBackgroundMusic() {
            if (AppState.bgMusic && AppState.currentUser && AppState.currentUser.bgMusicEnabled !== false) {
                // 尝试播放音乐，处理浏览器自动播放策略限制
                AppState.bgMusic.play().catch(e => {
                    console.log('音乐自动播放失败，需要用户交互:', e);
                    // 这里可以添加用户交互提示，或者在用户点击页面时再次尝试播放
                });
            }
        }
        
        // 添加用户交互事件监听器，解决浏览器自动播放限制
        document.addEventListener('click', function enableAudioContext() {
            if (AppState.bgMusic && AppState.currentUser && AppState.currentUser.bgMusicEnabled !== false) {
                // 尝试播放音乐，这将触发浏览器的用户交互检查
                AppState.bgMusic.play().catch(e => {
                    console.log('点击播放音乐失败:', e);
                });
            }
            // 移除事件监听器，只在第一次点击时执行
            document.removeEventListener('click', enableAudioContext);
        });

        // 停止背景音乐
        function stopBackgroundMusic() {
            if (AppState.bgMusic) {
                AppState.bgMusic.pause();
                AppState.bgMusic.currentTime = 0;
            }
        }
        
        // 切换用户背景音乐设置
        function toggleUserBgMusic(userId) {
            // 查找用户
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                // 切换背景音乐设置
                user.bgMusicEnabled = !user.bgMusicEnabled;
                
                // 保存用户数据
                saveUsers();
                
                // 更新用户显示
                updateUserDisplay();
                
                // 如果是当前登录用户，立即更新背景音乐状态
                if (AppState.currentUser && AppState.currentUser.id === userId) {
                    AppState.currentUser.bgMusicEnabled = user.bgMusicEnabled;
                    
                    // 更新背景音乐播放状态
                    if (AppState.bgMusic) {
                        if (user.bgMusicEnabled) {
                            AppState.bgMusic.play().catch(error => {
                                console.error('播放背景音乐失败:', error);
                            });
                        } else {
                            AppState.bgMusic.pause();
                        }
                    }
                }
            }
        }

        // 显示加载动画
        function showLoading() {
            document.getElementById('loadingContainer').classList.add('active');
        }

        // 隐藏加载动画
        function hideLoading() {
            document.getElementById('loadingContainer').classList.remove('active');
        }

        // 加载动物音效
        function loadAnimalSounds() {
            try {
                AppState.correctSound = new Audio('https://img.tukuppt.com/newpreview_music/09/04/08/5c8b03a8802e214463.mp3');
                AppState.incorrectSound = new Audio('https://img.tukuppt.com/newpreview_music/09/00/22/5c890ce9eeb7271798.mp3');
                
                // 预加载音频
                AppState.correctSound.preload = 'auto';
                AppState.incorrectSound.preload = 'auto';
                
                // 静默加载，避免自动播放限制
                AppState.correctSound.load();
                AppState.incorrectSound.load();
            } catch (error) {
                console.error('加载动物音效时出错:', error);
            }
        }

        // 加载特殊语音
        function loadSpecialToastAudio() {
            try {
                // 使用Web Speech API生成语音
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('你还活着干嘛');
                    utterance.lang = 'zh-CN';
                    // 调整参数使语气更生气
                    utterance.rate = 1.2;
                    utterance.pitch = 0.5;
                    utterance.volume = 1.0;
                    
                    // 预加载语音
                    speechSynthesis.cancel();
                    speechSynthesis.speak(utterance);
                    speechSynthesis.pause();
                    speechSynthesis.cancel();
                    
                    // 存储语音配置
                    AppState.specialToastAudio = {
                        text: '你还活着干嘛',
                        lang: 'zh-CN',
                        rate: 1.2,
                        pitch: 0.5,
                        volume: 1.0
                    };
                }
            } catch (error) {
                console.error('加载特殊语音时出错:', error);
            }
        }

        // 检测语音合成支持
        function checkSpeechSynthesisSupport() {
            try {
                // 1. 检测SpeechSynthesis接口是否存在
                if (!('speechSynthesis' in window)) {
                    AppState.speechSynthesisSupported = false;
                    console.log('浏览器不支持语音合成API');
                    showAudioActivationButton();
                    return;
                }
                
                // 2. 检测是否有可用的语音引擎
                // 注意：需要在用户交互后才能获取到语音列表
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    AppState.speechSynthesisSupported = true;
                    console.log('浏览器支持语音合成API，检测到', voices.length, '种语音');
                } else {
                    // 有些浏览器需要等待voiceschanged事件才能获取到语音列表
                    AppState.speechSynthesisSupported = 'pending';
                    console.log('语音合成API存在，但暂时未检测到可用语音');
                    
                    // 监听语音列表加载事件
                    window.speechSynthesis.onvoiceschanged = function() {
                        const updatedVoices = window.speechSynthesis.getVoices();
                        if (updatedVoices.length > 0) {
                            AppState.speechSynthesisSupported = true;
                            console.log('语音列表加载完成，检测到', updatedVoices.length, '种语音');
                        } else {
                            AppState.speechSynthesisSupported = false;
                            console.log('语音列表加载完成，但没有可用语音');
                            showAudioActivationButton();
                        }
                    };
                }
            } catch (error) {
                console.error('检测语音合成支持时出错:', error);
                AppState.speechSynthesisSupported = false;
                showAudioActivationButton();
            }
        }
        
        // 初始化音频上下文和语音合成（在用户交互时调用）
        function initAudioAndSpeech() {
            try {
                // 1. 激活音频上下文（如果存在）
                if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        AppState.audioActivated = true;
                        console.log('音频上下文已激活');
                    }).catch(e => {
                        console.error('激活音频上下文失败:', e);
                    });
                }
                
                // 2. 触发语音合成API的初始化
                if ('speechSynthesis' in window) {
                    // 调用getVoices()来触发voiceschanged事件
                    const voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        AppState.speechSynthesisSupported = true;
                    }
                    
                    // 预加载一个空的语音合成请求，获取浏览器授权
                    const utterance = new SpeechSynthesisUtterance('');
                    utterance.lang = 'zh-CN';
                    utterance.volume = 0; // 音量设为0，用户不会听到声音
                    window.speechSynthesis.speak(utterance);
                    
                    // 立即取消，只是为了获取授权
                    setTimeout(() => {
                        window.speechSynthesis.cancel();
                    }, 10);
                    
                    console.log('语音合成API已初始化');
                }
                
                // 3. 标记为已激活
                AppState.mobileAudioActivated = true;
                AppState.audioActivated = true;
                
                // 4. 移除全局点击监听器，避免重复调用
                if (AppState.globalClickListenerAdded) {
                    document.removeEventListener('click', initAudioAndSpeech);
                    document.removeEventListener('touchstart', initAudioAndSpeech);
                    AppState.globalClickListenerAdded = false;
                }
            } catch (error) {
                console.error('初始化音频和语音合成时出错:', error);
            }
        }

        // 显示音频激活按钮
        function showAudioActivationButton() {
            try {
                const audioBtn = document.getElementById('audioActivationBtn');
                if (audioBtn) {
                    audioBtn.style.display = 'flex';
                }
            } catch (error) {
                console.error('显示音频激活按钮时出错:', error);
            }
        }

        // 激活音频
        function activateAudio() {
            try {
                // 创建音频上下文
                if (!AppState.audioContext) {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    AppState.audioContext = new AudioContext();
                }
                
                // 如果音频上下文被暂停，尝试恢复
                if (AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        console.log('音频上下文已激活');
                        AppState.audioActivated = true;
                        
                        // 隐藏激活按钮
                        const audioBtn = document.getElementById('audioActivationBtn');
                        if (audioBtn) {
                            audioBtn.style.display = 'none';
                        }
                        
                        // 播放一个短音效确认激活
                        playActivationSound();
                        
                        showToast('音频已激活，语音功能可用');
                    }).catch(e => {
                        console.error('激活音频上下文失败:', e);
                        showToast('音频激活失败，请重试');
                    });
                } else {
                    AppState.audioActivated = true;
                    
                    // 隐藏激活按钮
                    const audioBtn = document.getElementById('audioActivationBtn');
                    if (audioBtn) {
                        audioBtn.style.display = 'none';
                    }
                    
                    // 播放一个短音效确认激活
                    playActivationSound();
                    
                    showToast('音频已激活，语音功能可用');
                }
            } catch (error) {
                console.error('激活音频时出错:', error);
                showToast('音频激活失败，请重试');
            }
        }

        // 播放激活音效
        function playActivationSound() {
            try {
                if (!AppState.audioContext) return;
                
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, AppState.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, AppState.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, AppState.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + 0.5);
            } catch (error) {
                console.error('播放激活音效时出错:', error);
            }
        }

        // 添加全局点击监听器以激活音频
        function addGlobalClickListener() {
            // 如果已经添加过监听器，则不再重复添加
            if (AppState.globalClickListenerAdded) {
                return;
            }
            
            // 添加全局点击监听器
            document.addEventListener('click', function handleFirstClick() {
                // 如果音频已经初始化，则不再处理
                if (AppState.audioInitialized) {
                    return;
                }
                
                // 初始化音频上下文
                if (!AppState.audioContext) {
                    try {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        AppState.audioContext = new AudioContext();
                    } catch (error) {
                        console.error('创建AudioContext失败:', error);
                    }
                }
                
                // 如果音频上下文存在且处于暂停状态，则恢复
                if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        console.log('AudioContext已通过全局点击激活');
                        AppState.audioInitialized = true;
                        
                        // 播放一个极短的静音音频以"解锁"音频权限
                        playSilentSound();
                        
                        // 移除事件监听器
                        document.removeEventListener('click', handleFirstClick);
                        AppState.globalClickListenerAdded = true;
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                    });
                } else {
                    AppState.audioInitialized = true;
                    
                    // 播放一个极短的静音音频以"解锁"音频权限
                    playSilentSound();
                    
                    // 移除事件监听器
                    document.removeEventListener('click', handleFirstClick);
                    AppState.globalClickListenerAdded = true;
                }
            }, { once: true });
            
            AppState.globalClickListenerAdded = true;
        }

        // 播放静音音频以"解锁"音频权限
        function playSilentSound() {
            try {
                if (!AppState.audioContext) {
                    return;
                }
                
                // 创建一个极短的静音音频
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                // 设置为静音
                gainNode.gain.value = 0;
                
                // 设置极短的持续时间
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + 0.01);
                
                console.log('已播放静音音频以解锁音频权限');
            } catch (error) {
                console.error('播放静音音频时出错:', error);
            }
        }

        // 背书功能相关变量
        let currentNoun = '';
        let currentNounText = '';
        let skipTimeout = null;
        let countdownInterval = null;
        let recognition = null;
        let isRecording = false;
        let matchResult = [];
        let speechRate = 0.8; // 默认语速
        let isPlaying = false;
        
        // 名词解释列表 - 用于左右箭头导航
        const nounList = [
            '商品分类',
            '商品包装标志',
            '商品小类',
            '仓库货架货位编码',
            '品类群类编码',
            '货物检验',
            '抽样检验',
            '物理鉴定法',
            '堆码',
            '货物上架作业'
        ];
        
        // 当前导航列表 - 默认为固定的nounList，搜索时会动态更新
        let currentNavList = nounList;
        
        // 背书统计数据
        let reciteStats = {
            learnedNouns: 0,
            correctAnswers: 0,
            totalAnswers: 0
        };
        
        // 更新背书统计数据
        // 计算所有标签下的总名词数
        function calculateTotalNouns() {
            // 获取当前激活的主标签
            const activeMainTab = document.querySelector('.noun-tag.active');
            
            // 如果没有激活的主标签，默认返回10条
            if (!activeMainTab) {
                return 10;
            }
            
            // 获取当前激活的主标签名称
            const activeTagName = activeMainTab.textContent.trim().toLowerCase();
            const tagMap = {
                '物流': 'logistics',
                '营销': 'marketing',
                '客服': 'service',
                '网店': 'shop',
                'ps': 'ps'
            };
            
            const tagName = tagMap[activeTagName] || 'logistics';
            
            // 检查当前激活的主标签下的"全部"子标签页
            const allItemsContainer = document.getElementById(`${tagName}AllItems`);
            if (allItemsContainer) {
                const nounItems = allItemsContainer.querySelectorAll('.noun-item');
                const actualCount = nounItems.length;
                // 固定显示10条名词解释，确保总数据条数为10条
                return Math.max(actualCount, 10);
            }
            
            // 如果"全部"子标签页不存在，默认返回10条
            return 10;
        }

        function updateReciteStats() {
            // 计算总名词数
            const totalNouns = calculateTotalNouns();
            
            // 计算正确率
            const correctRate = reciteStats.totalAnswers > 0 ? Math.round((reciteStats.correctAnswers / reciteStats.totalAnswers) * 100) : 0;
            
            // 计算学习进度
            const learningProgress = totalNouns > 0 ? Math.round((reciteStats.learnedNouns / totalNouns) * 100) : 0;
            
            // 更新DOM
            document.getElementById('totalNouns').textContent = totalNouns;
            document.getElementById('learnedNouns').textContent = reciteStats.learnedNouns;
            document.getElementById('correctRate').textContent = `${correctRate}%`;
            document.getElementById('learningProgress').textContent = `${learningProgress}%`;
            
            // 根据正确率设置颜色
            const correctRateElement = document.getElementById('correctRate');
            correctRateElement.className = 'stat-value';
            if (correctRate >= 80) {
                correctRateElement.classList.add('good');
            } else if (correctRate >= 60) {
                correctRateElement.classList.add('average');
            } else {
                correctRateElement.classList.add('need-improvement');
            }
            
            // 根据学习进度设置颜色
            const learningProgressElement = document.getElementById('learningProgress');
            learningProgressElement.className = 'stat-value';
            if (learningProgress >= 80) {
                learningProgressElement.classList.add('good');
            } else if (learningProgress >= 60) {
                learningProgressElement.classList.add('average');
            } else {
                learningProgressElement.classList.add('need-improvement');
            }
        }
        
        // 背书功能：切换标签
        function showReciteTab(tabName) {
            // 切换标签状态
            const tabs = document.querySelectorAll('.recite-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="showReciteTab('${tabName}')"]`).classList.add('active');
            
            // 切换内容
            const contents = document.querySelectorAll('.recite-content');
            contents.forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}Module`).classList.add('active');
            
            // 生成页码按钮，确保分页控件正常显示
            updateRecitePagination();
            
            // 更新统计数据
            updateReciteStats();
        }
        
        // 名词解释：切换主标签
        function showNounSubTags(tagName) {
            // 切换主标签状态
            const tags = document.querySelectorAll('.noun-tag');
            tags.forEach(tag => tag.classList.remove('active'));
            document.querySelector(`[onclick="showNounSubTags('${tagName}')"]`).classList.add('active');
            
            // 切换子标签内容
            const subTags = document.querySelectorAll('.noun-subtags');
            subTags.forEach(subTag => subTag.style.display = 'none');
            document.getElementById(`${tagName}SubTags`).style.display = 'flex';
            
            // 默认显示"全部"标签的内容
            showNounItems(tagName, 'all');
            
            // 更新统计数据
            updateReciteStats();
        }
        
        // 名词解释：切换子标签
        function showNounItems(tagName, projectNum) {
            // 隐藏搜索结果容器，解决搜索结果与正常项目内容重复显示的问题
            hideSearchResults();
            
            // 切换子标签状态
            const subTags = document.querySelectorAll(`#${tagName}SubTags .noun-subtag`);
            subTags.forEach(subTag => subTag.classList.remove('active'));
            
            // 处理项目编号为'all'的情况
            let targetItems;
            let isAll = projectNum === 'all';
            
            // 固定显示10条名词解释
            const expectedTotalItems = 10;
            
            // 动态更新当前导航列表
            currentNavList = [];
            
            if (isAll) {
                // 选择全部按钮
                document.querySelector(`[onclick="showNounItems('${tagName}', '${projectNum}')"]`).classList.add('active');
                
                // 获取全部项目内容容器
                targetItems = document.getElementById(`${tagName}AllItems`);
                
                // 确保容器存在
                if (!targetItems) {
                    // 如果容器不存在，创建它
                    targetItems = document.createElement('div');
                    targetItems.id = `${tagName}AllItems`;
                    targetItems.className = 'noun-items';
                    document.querySelector(`#${tagName}Content`).appendChild(targetItems);
                }
                
                // 确保容器具有noun-items类
                if (!targetItems.classList.contains('noun-items')) {
                    targetItems.classList.add('noun-items');
                }
                
                // 收集该主标签下所有项目的名词项
                const allNounItems = [];
                let hasItems = false;
                
                for (let i = 1; i <= 6; i++) {
                    const projectItems = document.getElementById(`${tagName}${i}Items`);
                    if (projectItems) {
                        const nounItems = projectItems.querySelectorAll('.noun-item');
                        if (nounItems.length > 0) {
                            hasItems = true;
                            nounItems.forEach(item => {
                                allNounItems.push(item.cloneNode(true));
                                // 添加到导航列表
                                const nounName = item.querySelector('.noun-item-name').textContent.trim();
                                if (nounName && !currentNavList.includes(nounName)) {
                                    currentNavList.push(nounName);
                                }
                            });
                        }
                    }
                }
                
                // 清空并填充全部项目内容
                let gridContainer = targetItems.querySelector('.noun-items-grid');
                if (!gridContainer) {
                    // 如果网格容器不存在，创建它
                    gridContainer = document.createElement('div');
                    gridContainer.className = 'noun-items-grid';
                    targetItems.appendChild(gridContainer);
                }
                gridContainer.innerHTML = '';
                
                // 只有在物流分类下才显示所有物流名词
                if (tagName === 'logistics') {
                    // 动态收集所有物流项目中的名词解释
                    const allNounsMap = new Map();
                    
                    // 直接手动添加所有28个名词，确保数据完整
                    const allLogisticsNouns = {
                        '商品分类': '📦',
                        '商品包装标志': '🏷️',
                        '商品小类': '📋',
                        '仓库货架货位编码': '📌',
                        '品类群类编码': '🏷️',
                        '货物检验': '🔍',
                        '抽样检验': '📊',
                        '物理鉴定法': '⚖️',
                        '堆码': '📚',
                        '货物上架作业': '⬆️',
                        '化学药剂防霉腐': '🧪',
                        '盘点差异处理': '📊',
                        '密封': '🔒',
                        '商品养护': '💚',
                        '干燥防霉腐': '🌬️',
                        '人工摘取式拣货': '👋',
                        '播种式DAS拣货': '🌱',
                        '摘取式DPS拣货': '🔍',
                        '订单配货与校验出库': '✅',
                        '现代商品包装': '📦',
                        '内包装': '📦',
                        '外包装': '📦',
                        '充气包装': '💨',
                        '包装标准': '📋',
                        '不良品': '⚠️',
                        '待处理品': '⏳',
                        '废品': '🗑️',
                        '《退换货通知单》': '📋'
                    };
                    
                    // 将所有名词添加到Map中
                    for (const [name, icon] of Object.entries(allLogisticsNouns)) {
                        allNounsMap.set(name, icon);
                    }
                    
                    // 调试信息：输出收集到的数据条数
                    console.log('收集到的物流名词解释数量：', allNounsMap.size);
                    
                    // 转换为数组并添加到网格容器
                    // 清空currentNavList，准备重新生成
                    currentNavList = [];
                    
                    // 将Map转换为数组，方便分页处理
                    const allNounsArray = Array.from(allNounsMap);
                    
                    // 先更新分页状态，确保总条数正确，这是关键！
                    paginationManager.updateState('recite', {
                        totalItems: allNounsArray.length,
                        itemsPerPage: 20 // 明确设置每页显示20条
                    });
                    
                    // 重新获取更新后的分页状态
                    const paginationState = paginationManager.getState('recite');
                    
                    // 计算当前页需要显示的数据范围
                    const startIndex = (paginationState.currentPage - 1) * paginationState.itemsPerPage;
                    const endIndex = startIndex + paginationState.itemsPerPage;
                    const currentPageNouns = allNounsArray.slice(startIndex, endIndex);
                    
                    // 显示当前页的数据
                    currentPageNouns.forEach(([name, icon]) => {
                        const nounItem = document.createElement('div');
                        nounItem.className = 'noun-item';
                        nounItem.onclick = () => showNounDetail(name);
                        nounItem.innerHTML = `
                            <div class="noun-item-icon">${icon}</div>
                            <div class="noun-item-name">${name}</div>
                        `;
                        gridContainer.appendChild(nounItem);
                        
                        // 将名词名称添加到currentNavList，确保顺序一致
                        currentNavList.push(name);
                    });
                    
                    // 更新分页控件
                    paginationManager.updatePagination(targetItems, 'recite');
                    
                    // 如果没有任何名词项，显示空状态
                    if (gridContainer.children.length === 0) {
                        gridContainer.innerHTML = `
                            <div class="empty-state logistics" style="grid-column: 1 / -1;">
                                <div class="empty-state-icon">📦</div>
                                <div class="empty-state-text">物流内容正在准备中</div>
                                <div class="empty-state-subtext">更多精彩的物流名词解释即将上线</div>
                            </div>
                        `;
                        // 清空currentNavList
                        currentNavList = [];
                    }
                } else {
                    // 非物流分类显示空状态
                    const emptyStates = {
                        marketing: {
                            icon: '📈',
                            text: '营销内容正在准备中',
                            subtext: '精彩的营销名词解释即将上线',
                            class: 'marketing'
                        },
                        service: {
                            icon: '🎧',
                            text: '客服内容正在准备中',
                            subtext: '专业的客服名词解释即将上线',
                            class: 'service'
                        },
                        shop: {
                            icon: '🛍️',
                            text: '网店内容正在准备中',
                            subtext: '实用的网店名词解释即将上线',
                            class: 'shop'
                        },
                        ps: {
                            icon: '🎨',
                            text: 'PS内容正在准备中',
                            subtext: '创意的PS名词解释即将上线',
                            class: 'ps'
                        }
                    };
                    
                    const emptyState = emptyStates[tagName] || {
                        icon: '📦',
                        text: '内容正在准备中',
                        subtext: '更多精彩内容即将上线',
                        class: 'default'
                    };
                    
                    gridContainer.innerHTML = `
                        <div class="empty-state ${emptyState.class}" style="grid-column: 1 / -1;">
                            <div class="empty-state-icon">${emptyState.icon}</div>
                            <div class="empty-state-text">${emptyState.text}</div>
                            <div class="empty-state-subtext">${emptyState.subtext}</div>
                        </div>
                    `;
                }
            } else {
                // 选择普通项目按钮
                document.querySelector(`[onclick="showNounItems('${tagName}', ${projectNum})"]`).classList.add('active');
                
                // 获取普通项目内容容器
                targetItems = document.getElementById(`${tagName}${projectNum}Items`);
                
                // 确保容器存在
                if (!targetItems) {
                    // 如果容器不存在，创建它
                    targetItems = document.createElement('div');
                    targetItems.id = `${tagName}${projectNum}Items`;
                    targetItems.className = 'noun-items';
                    document.querySelector(`#${tagName}Content`).appendChild(targetItems);
                }
                
                // 确保容器具有noun-items类
                if (!targetItems.classList.contains('noun-items')) {
                    targetItems.classList.add('noun-items');
                }
                
                // 检查普通项目内容是否为空，如果为空则添加默认内容
                let gridContainer = targetItems.querySelector('.noun-items-grid');
                if (!gridContainer) {
                    // 如果网格容器不存在，创建它
                    gridContainer = document.createElement('div');
                    gridContainer.className = 'noun-items-grid';
                    targetItems.appendChild(gridContainer);
                }
                
                // 清空当前导航列表
                currentNavList = [];
                
                if (gridContainer.children.length === 0) {
                    // 根据不同分类生成个性化空状态
                    const emptyStates = {
                        logistics: {
                            icon: '📦',
                            text: '正在上新中...',
                            subtext: '更多物流名词解释即将上线',
                            class: 'logistics'
                        },
                        marketing: {
                            icon: '📈',
                            text: '营销内容正在准备中',
                            subtext: '精彩的营销名词解释即将上线',
                            class: 'marketing'
                        },
                        service: {
                            icon: '🎧',
                            text: '客服内容正在准备中',
                            subtext: '专业的客服名词解释即将上线',
                            class: 'service'
                        },
                        shop: {
                            icon: '🛍️',
                            text: '网店内容正在准备中',
                            subtext: '实用的网店名词解释即将上线',
                            class: 'shop'
                        },
                        ps: {
                            icon: '🎨',
                            text: 'PS内容正在准备中',
                            subtext: '创意的PS名词解释即将上线',
                            class: 'ps'
                        }
                    };
                    
                    // 只有在物流分类下才创建默认物流内容
                    if (tagName === 'logistics' && (projectNum === 1 || projectNum === 2)) {
                        // 创建默认物流内容
                        const defaultNouns = [
                            { name: '商品分类', icon: '📦' },
                            { name: '商品包装标志', icon: '🏷️' },
                            { name: '商品小类', icon: '📋' },
                            { name: '仓库货架货位编码', icon: '📌' },
                            { name: '品类群类编码', icon: '🏷️' }
                        ];
                        
                        defaultNouns.forEach(noun => {
                            const nounItem = document.createElement('div');
                            nounItem.className = 'noun-item';
                            nounItem.onclick = () => showNounDetail(noun.name);
                            nounItem.innerHTML = `
                                <div class="noun-item-icon">${noun.icon}</div>
                                <div class="noun-item-name">${noun.name}</div>
                            `;
                            gridContainer.appendChild(nounItem);
                            // 添加到当前导航列表
                            currentNavList.push(noun.name);
                        });
                    } else if (tagName === 'logistics' && projectNum === 3) {
                        // 创建项目3的默认物流内容
                        const project3Nouns = [
                            { name: '化学药剂防霉腐', icon: '🧪' },
                            { name: '盘点差异处理', icon: '📊' },
                            { name: '密封', icon: '🔒' },
                            { name: '商品养护', icon: '💚' },
                            { name: '干燥防霉腐', icon: '🌬️' }
                        ];
                        
                        project3Nouns.forEach(noun => {
                            const nounItem = document.createElement('div');
                            nounItem.className = 'noun-item';
                            nounItem.onclick = () => showNounDetail(noun.name);
                            nounItem.innerHTML = `
                                <div class="noun-item-icon">${noun.icon}</div>
                                <div class="noun-item-name">${noun.name}</div>
                            `;
                            gridContainer.appendChild(nounItem);
                            // 添加到当前导航列表
                            currentNavList.push(noun.name);
                        });
                    } else {
                        // 生成个性化空状态
                        const emptyState = emptyStates[tagName] || emptyStates.logistics;
                        const emptyStateDiv = document.createElement('div');
                        emptyStateDiv.className = `empty-state ${emptyState.class}`;
                        emptyStateDiv.innerHTML = `
                            <div class="empty-state-icon">${emptyState.icon}</div>
                            <div class="empty-state-text">${emptyState.text}</div>
                            <div class="empty-state-subtext">${emptyState.subtext}</div>
                        `;
                        gridContainer.appendChild(emptyStateDiv);
                    }
                } else {
                    // 如果已有内容，从现有内容中提取导航列表
                    const existingNounItems = gridContainer.querySelectorAll('.noun-item');
                    existingNounItems.forEach(item => {
                        const nounName = item.querySelector('.noun-item-name').textContent.trim();
                        if (nounName) {
                            currentNavList.push(nounName);
                        }
                    });
                }
            }
            
            // 切换项目内容显示
            // 先隐藏所有具有noun-items类的元素
            document.querySelectorAll('.noun-items').forEach(item => {
                item.style.display = 'none';
                item.classList.remove('active');
            });
            
            if (targetItems) {
                // 确保targetItems元素具有noun-items类
                if (!targetItems.classList.contains('noun-items')) {
                    targetItems.classList.add('noun-items');
                }
                
                // 显示targetItems元素
                targetItems.style.display = 'block';
                targetItems.classList.add('active');
                
                // 确保分页控件可见
                const pagination = targetItems.querySelector('.pagination');
                if (!pagination) {
                    // 如果分页控件不存在，立即创建并显示
                    const newPagination = document.createElement('div');
                    newPagination.className = 'pagination';
                    targetItems.appendChild(newPagination);
                }
                
                // 更新分页控件显示 - updateRecitePagination会自动计算并更新正确的分页状态
                updateRecitePagination();
            } else {
                // 如果项目内容不存在，创建默认内容
                createDefaultNounItems(tagName, projectNum);
            }
            
            // 更新统计数据
            updateReciteStats();
        }
        
        // 创建默认的名词解释项目内容 - 已修改为空，不再创建任何项目
        function createDefaultNounItems(tagName, projectNum) {
            // 不再创建任何名词解释项目
            return;
        }
        
        // 搜索名词
        function searchNoun() {
            const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!searchText) {
                // 如果搜索内容为空，不做任何操作
                return;
            }
            
            // 构建完整的名词解释映射
            const nounExplanations = {
                '商品分类': '商品分类：指为了一定目的，选择适当的分类标志，将商品集合总体科学地、系统地逐级划分为门类、大类、中类、小类、品类以至品种、花色、规格的过程。',
                '商品包装标志': '商品包装标志:为了便于商品的流通、销售、选购和使用,在商品包装上通常都印有某种特定的文字或图形,用以表示商品的性能、储运注意事项、质量水平等含义,这些具有特定含义的图形和文字称为商品包装标志。商品包装标志分运输包装标志与销售包装标志。',
                '商品小类': '商品小类:对中类商品的进一步划分,体现具体的商品名称。',
                '仓库货架货位编码': '仓库货架货位编码:指将仓库范围的房、棚、场以及仓库的楼层、仓间、货架、走道等按地点、位置顺序编列号码,并做出明显标示,以便商品进出库可按号存取。',
                '品类群类编码': '品类群类编码:把一些相关性强的商品经过集合后,分成几个品类群,再对每个品类群进行编号。',
                '货物检验': '货物检验: 指利用工具或仪器,确定合适的检验项目,按照一定的方法,对照货物的标准检查、评价货物是否合乎规格及要求的过程。',
                '抽样检验': '抽样检验: 按照事先规定的抽样方案,从被检批中抽取少量样品,组成样本,再对样本逐一进行测试,将测试结果与标准或合同进行比较,最后根据样本质量状况统计推断受检商品整体质量合格与否。',
                '物理鉴定法': '物理鉴定法: 根据物理学原理,利用各种仪器或机械,通过对商品的物理性质及机械性质的鉴定,来确定商品的质量的方法。',
                '堆码': '堆码: 也称码垛,是将存放的商品整齐、有规划地摆放成货垛的作业。即根据商品物品的包装外形、重量、数量、性能和特点等,结合仓库地坪负荷、储存时间,将商品分别堆成各种垛形。',
                '货物上架作业': '货物上架作业: 进货人库的最后一个环节,是将要上架的货物搬运到存储区域,按照一定的上架原则及合适的方法将货品存放至指定储位。',
                '化学药剂防霉腐': '化学药剂防霉腐: 将化学药剂喷洒在商品体和包装上，或喷洒在仓库内。',
                '盘点差异处理': '盘点差异处理: 指在盘点结束以后,比较相同品名货物的账存数量与盘点数量之间的差异,如果差异率超过企业规定的范围,就必须对差异做出说明与原因分析,最后调整账务,做到账实相符。',
                '密封': '密封: 利用一些不透气、能隔热防潮的材料,把商品严密地封闭起来,以隔绝空气,降低或减小空气温湿度对商品的影响。',
                '商品养护': '商品养护: 商品在储运过程中所进行的保养和维护。从商品完成生产过程,进入消费领域之前,这一段过程的保养与维护都称为商品养护。',
                '干燥防霉腐': '干燥防霉腐: 通过降低仓库环境中的水分和商品本身的水分,达到防霉腐的目的。'
            };
            
            // 动态获取页面上所有的名词项
            const nounItems = document.querySelectorAll('.noun-item');
            const allNouns = {};
            
            // 遍历所有名词项，构建完整的名词库
            nounItems.forEach(item => {
                const onclickAttr = item.getAttribute('onclick');
                if (onclickAttr && onclickAttr.startsWith('showNounDetail(')) {
                    // 提取名词名称
                    const nounName = onclickAttr.match(/showNounDetail\('([^']+)'\)/)[1];
                    // 获取对应的解释
                    const nounText = nounExplanations[nounName] || `${nounName}：暂无详细解释`;
                    // 添加到名词库
                    allNouns[nounName] = nounText;
                }
            });
            
            // 搜索结果数组
            const searchResults = [];
            
            // 遍历所有名词，进行模糊匹配
            for (const [nounName, nounText] of Object.entries(allNouns)) {
                // 合并名词名称和解释文本进行搜索
                const searchContent = (nounName + nounText).toLowerCase();
                const lowerNounName = nounName.toLowerCase();
                
                // 计算匹配度
                let matchScore = 0;
                let isRelevant = false;
                
                // 1. 关键词完全匹配得分（名称完全匹配权重最高）
                if (lowerNounName === searchText) {
                    matchScore += 200;
                    isRelevant = true;
                }
                // 2. 名称包含关键词（权重次之）
                else if (lowerNounName.includes(searchText)) {
                    matchScore += 150;
                    isRelevant = true;
                    // 根据关键词在名称中的位置调整得分（越靠前得分越高）
                    const position = lowerNounName.indexOf(searchText);
                    matchScore += (20 - Math.min(position, 20));
                }
                // 3. 解释包含关键词（权重较低）
                else if (searchContent.includes(searchText)) {
                    matchScore += 50;
                    // 只有当关键词长度大于2时，才考虑解释包含的情况
                    if (searchText.length > 2) {
                        isRelevant = true;
                    }
                    // 根据关键词在解释中的位置调整得分
                    const position = searchContent.indexOf(searchText);
                    matchScore += (10 - Math.min(Math.floor(position / 10), 10));
                }
                
                // 4. 关键词长度匹配加分（关键词越长，匹配越精确，得分越高）
                matchScore += searchText.length * 5;
                
                // 5. 计算关键词与名词的相似度（使用编辑距离简化算法）
                const similarity = calculateSimilarity(searchText, lowerNounName);
                matchScore += similarity * 20;
                
                // 解释文本包含关键词得分
                if (nounText.toLowerCase().includes(searchText)) {
                    matchScore += 10;
                }
                
                // 拆分关键词进行匹配
                const keywords = searchText.split(/\s+/);
                for (const keyword of keywords) {
                    if (nounName.toLowerCase().includes(keyword)) {
                        matchScore += 15;
                    }
                    if (nounText.toLowerCase().includes(keyword)) {
                        matchScore += 5;
                    }
                }
                
                // 设置匹配度阈值，只有匹配度足够高的结果才会显示
                // 对于短关键词（如"商品"），要求更高的匹配度
                const minMatchScore = searchText.length <= 2 ? 100 : 50;
                
                // 如果匹配度大于阈值且相关，添加到结果列表
                if (matchScore >= minMatchScore && isRelevant) {
                    searchResults.push({
                        name: nounName,
                        text: nounText,
                        score: matchScore
                    });
                }
            }
            
            // 根据匹配度排序，得分高的排在前面
            searchResults.sort((a, b) => b.score - a.score);
            
            // 显示搜索结果
            showSearchResults(searchResults, searchText);
        }
        
        // 计算两个字符串的相似度（简化的编辑距离算法）
        function calculateSimilarity(str1, str2) {
            // 确保str1是较短的字符串
            if (str1.length > str2.length) {
                [str1, str2] = [str2, str1];
            }
            
            const len1 = str1.length;
            const len2 = str2.length;
            
            // 如果有一个字符串为空，相似度为0
            if (len1 === 0) {
                return 0;
            }
            
            // 计算最长公共子序列长度
            const lcs = longestCommonSubsequence(str1, str2);
            
            // 相似度 = 2 * 最长公共子序列长度 / (两个字符串长度之和)
            return (2 * lcs) / (len1 + len2);
        }
        
        // 计算最长公共子序列长度
        function longestCommonSubsequence(str1, str2) {
            const m = str1.length;
            const n = str2.length;
            
            // 创建二维数组用于动态规划
            const dp = Array(m + 1).fill(0).map(() => Array(n + 1).fill(0));
            
            // 填充dp数组
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (str1[i - 1] === str2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }
            
            return dp[m][n];
        }
        
        // 显示搜索结果
        function showSearchResults(results, searchText) {
            // 初始化分页状态
            paginationManager.updateState('search', {
                totalItems: results.length,
                itemsPerPage: 20,
                currentPage: 1
            });
            
            // 更新当前导航列表为搜索结果列表
            currentNavList = results.map(result => result.name);
            
            // 获取当前分页状态
            const searchState = paginationManager.getState('search');
            
            // 创建结果HTML
            let resultHTML = '';
            
            if (results.length === 0) {
                resultHTML = `<div class="search-result-empty">未找到相关名词，请尝试其他关键词</div>`;
            } else {
                // 添加结果计数
                resultHTML += `<div class="search-results-count" style="padding: 10px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                    找到 <strong>${results.length}</strong> 条相关结果
                </div>`;
                
                // 添加结果列表
                resultHTML += `<div class="search-results-list">`;
                
                // 计算当前页显示的结果范围
                const startIndex = (searchState.currentPage - 1) * searchState.itemsPerPage;
                const endIndex = startIndex + searchState.itemsPerPage;
                const currentPageResults = results.slice(startIndex, endIndex);
                
                // 遍历当前页结果
                currentPageResults.forEach(result => {
                    // 高亮显示搜索关键词
                    let highlightedName = result.name;
                    
                    if (searchText) {
                        // 分词搜索，支持空格分隔的多个关键词
                        const keywords = searchText.split(/\s+/).filter(k => k);
                        const regexPattern = keywords.map(kw => kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
                        const regex = new RegExp(`(${regexPattern})`, 'gi');
                        
                        // 高亮名词名称中的关键词
                        highlightedName = result.name.replace(regex, '<span class="search-highlight">$1</span>');
                    }
                    
                    // 使用与名词项相同的图标
                    let icon = '📦';
                    if (result.name.includes('包装')) {
                        icon = '🏷️';
                    } else if (result.name.includes('分类') || result.name.includes('小类')) {
                        icon = '📋';
                    } else if (result.name.includes('编码')) {
                        icon = '📌';
                    }
                    
                    resultHTML += `
                        <div class="search-result-item" onclick="showNounDetail('${result.name}')">
                            <div class="search-result-icon">${icon}</div>
                            <div class="search-result-name">${highlightedName}</div>
                        </div>
                    `;
                });
                
                resultHTML += `</div>`;
                
                // 添加统一的分页控件
                resultHTML += `<div class="search-pagination" style="padding: 15px 20px; background: #f8fafc; border-top: 1px solid #e2e8f0;">`;
                
                // 使用分页管理器生成分页HTML
                resultHTML += paginationManager.generatePaginationHTML(searchState, {
                    stateKey: 'search',
                    showPageNumbers: true,
                    showGoToPage: true
                });
                
                resultHTML += `</div>`;
            }
            
            // 获取搜索结果容器
            const resultsContainer = document.getElementById('searchResultsContainer');
            const resultsContent = document.getElementById('searchResultsContent');
            
            // 更新搜索结果内容
            resultsContent.innerHTML = resultHTML;
            
            // 显示搜索结果容器
            resultsContainer.style.display = 'block';
            
            // 隐藏所有名词解释项目
            const nounItems = document.querySelectorAll('.noun-items');
            nounItems.forEach(item => {
                item.style.display = 'none';
            });
        }
        

        
        // 隐藏搜索结果
        function hideSearchResults() {
            // 隐藏搜索结果容器
            const resultsContainer = document.getElementById('searchResultsContainer');
            resultsContainer.style.display = 'none';
            
            // 恢复当前导航列表为默认的名词列表
            currentNavList = nounList;
            
            // 显示当前激活的名词解释项目
            const activeItems = document.querySelector('.noun-items.active');
            if (activeItems) {
                activeItems.style.display = 'block';
            }
        }
        
        // 显示搜索建议
        function showSearchSuggestions() {
            const searchInput = document.getElementById('searchInput');
            const searchText = searchInput.value.toLowerCase().trim();
            const suggestionsContainer = document.getElementById('searchSuggestions');
            
            if (!searchText) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // 构建完整的名词解释映射
            const nounExplanations = {
                '商品分类': '商品分类：指为了一定目的，选择适当的分类标志，将商品集合总体科学地、系统地逐级划分为门类、大类、中类、小类、品类以至品种、花色、规格的过程。',
                '商品包装标志': '商品包装标志:为了便于商品的流通、销售、选购和使用,在商品包装上通常都印有某种特定的文字或图形,用以表示商品的性能、储运注意事项、质量水平等含义,这些具有特定含义的图形和文字称为商品包装标志。商品包装标志分运输包装标志与销售包装标志。',
                '商品小类': '商品小类:对中类商品的进一步划分,体现具体的商品名称。',
                '仓库货架货位编码': '仓库货架货位编码:指将仓库范围的房、棚、场以及仓库的楼层、仓间、货架、走道等按地点、位置顺序编列号码,并做出明显标示,以便商品进出库可按号存取。',
                '品类群类编码': '品类群类编码:把一些相关性强的商品经过集合后,分成几个品类群,再对每个品类群进行编号。',
                '货物检验': '货物检验: 指利用工具或仪器,确定合适的检验项目,按照一定的方法,对照货物的标准检查、评价货物是否合乎规格及要求的过程。',
                '抽样检验': '抽样检验: 按照事先规定的抽样方案,从被检批中抽取少量样品,组成样本,再对样本逐一进行测试,将测试结果与标准或合同进行比较,最后根据样本质量状况统计推断受检商品整体质量合格与否。',
                '物理鉴定法': '物理鉴定法: 根据物理学原理,利用各种仪器或机械,通过对商品的物理性质及机械性质的鉴定,来确定商品的质量的方法。',
                '堆码': '堆码: 也称码垛,是将存放的商品整齐、有规划地摆放成货垛的作业。即根据商品物品的包装外形、重量、数量、性能和特点等,结合仓库地坪负荷、储存时间,将商品分别堆成各种垛形。',
                '货物上架作业': '货物上架作业: 进货人库的最后一个环节,是将要上架的货物搬运到存储区域,按照一定的上架原则及合适的方法将货品存放至指定储位。',
                '化学药剂防霉腐': '化学药剂防霉腐: 将化学药剂喷洒在商品体和包装上，或喷洒在仓库内。',
                '盘点差异处理': '盘点差异处理: 指在盘点结束以后,比较相同品名货物的账存数量与盘点数量之间的差异,如果差异率超过企业规定的范围,就必须对差异做出说明与原因分析,最后调整账务,做到账实相符。',
                '密封': '密封: 利用一些不透气、能隔热防潮的材料,把商品严密地封闭起来,以隔绝空气,降低或减小空气温湿度对商品的影响。',
                '商品养护': '商品养护: 商品在储运过程中所进行的保养和维护。从商品完成生产过程,进入消费领域之前,这一段过程的保养与维护都称为商品养护。',
                '干燥防霉腐': '干燥防霉腐: 通过降低仓库环境中的水分和商品本身的水分,达到防霉腐的目的。'
            };
            
            // 动态获取页面上所有的名词项
            const nounItems = document.querySelectorAll('.noun-item');
            const allNouns = {};
            
            // 遍历所有名词项，构建完整的名词库
            nounItems.forEach(item => {
                const onclickAttr = item.getAttribute('onclick');
                if (onclickAttr && onclickAttr.startsWith('showNounDetail(')) {
                    // 提取名词名称
                    const nounName = onclickAttr.match(/showNounDetail\('([^']+)'\)/)[1];
                    // 获取对应的解释
                    const nounText = nounExplanations[nounName] || `${nounName}：暂无详细解释`;
                    // 添加到名词库
                    allNouns[nounName] = nounText;
                }
            });
            
            // 过滤出匹配的名词
            const filteredNouns = Object.entries(allNouns)
                .filter(([nounName, nounText]) => {
                    const lowerNounName = nounName.toLowerCase();
                    // 前缀匹配优先，包含匹配次之
                    return lowerNounName.startsWith(searchText) || lowerNounName.includes(searchText);
                })
                .sort(([nameA], [nameB]) => {
                    // 前缀匹配的结果排在前面
                    const startsA = nameA.toLowerCase().startsWith(searchText);
                    const startsB = nameB.toLowerCase().startsWith(searchText);
                    if (startsA && !startsB) return -1;
                    if (!startsA && startsB) return 1;
                    // 长度短的排在前面
                    return nameA.length - nameB.length;
                })
                .slice(0, 6); // 最多显示6个建议
            
            if (filteredNouns.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // 生成建议HTML
            let suggestionsHTML = '';
            filteredNouns.forEach(([nounName, nounText]) => {
                // 高亮搜索关键词
                let highlightedName = nounName;
                if (searchText) {
                    const regex = new RegExp(`(${searchText})`, 'gi');
                    highlightedName = nounName.replace(regex, '<span class="search-highlight">$1</span>');
                }
                
                suggestionsHTML += `
                    <div class="search-suggestion-item" onclick="selectSearchSuggestion('${nounName}')">
                        <div class="search-suggestion-name">${highlightedName}</div>
                        <div class="search-suggestion-preview">${nounText.substring(0, 80)}...</div>
                    </div>
                `;
            });
            
            suggestionsContainer.innerHTML = suggestionsHTML;
            suggestionsContainer.style.display = 'block';
        }
        
        // 隐藏搜索建议
        function hideSearchSuggestions() {
            // 延迟隐藏，以便点击建议项时能触发点击事件
            setTimeout(() => {
                const suggestionsContainer = document.getElementById('searchSuggestions');
                if (suggestionsContainer) {
                    suggestionsContainer.style.display = 'none';
                }
            }, 200);
        }
        
        // 选择搜索建议
        function selectSearchSuggestion(nounName) {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = nounName;
            hideSearchSuggestions();
            // 可以选择是否自动执行搜索
            // searchNoun();
        }
        

        
        // 背书功能：更新分页显示
        // 分页管理器 - 支持多种分页场景
        class PaginationManager {
            constructor() {
                this.paginationStates = {};
                this.defaultItemsPerPage = 20;
            }
            
            // 获取或创建分页状态
            getState(key) {
                if (!this.paginationStates[key]) {
                    this.paginationStates[key] = {
                        currentPage: 1,
                        totalItems: 0,
                        itemsPerPage: this.defaultItemsPerPage,
                        totalPages: 1
                    };
                }
                return this.paginationStates[key];
            }
            
            // 更新分页状态
            updateState(key, newState) {
                const state = this.getState(key);
                const effectiveTotalItems = newState.totalItems !== undefined ? newState.totalItems : state.totalItems;
                const effectiveItemsPerPage = newState.itemsPerPage !== undefined ? newState.itemsPerPage : state.itemsPerPage;
                const newTotalPages = effectiveTotalItems > 0 ? Math.ceil(effectiveTotalItems / effectiveItemsPerPage) : 1;
                
                this.paginationStates[key] = {
                    ...state,
                    ...newState,
                    totalPages: newTotalPages,
                    currentPage: Math.min(newState.currentPage || state.currentPage, Math.max(1, newTotalPages))
                };
            }
            
            // 生成分页HTML结构
            generatePaginationHTML(state, options = {}) {
                const { showPageNumbers = true, showGoToPage = true } = options;
                let html = '';
                
                // 简化的分页HTML结构，确保能显示
                html += `<div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);">`;
                
                // 总条数显示
                html += `<span class="pagination-info total-items-count">共 ${state.totalItems} 条</span>`;
                
                // 上一页按钮
                html += `<button class="pagination-btn prev-page-btn" onclick="paginationManager.goToPage('${options.stateKey || 'recite'}', ${state.currentPage - 1})" ${state.currentPage <= 1 ? 'disabled' : ''} style="padding: 8px 12px; border: 1px solid #e2e8f0; background: white; color: #4a5568; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                    &lt;
                </button>`;
                
                // 页码按钮 - 简化版，只显示当前页和总页数
                html += `<div style="display: flex; align-items: center; gap: 4px;">`;
                for (let i = 1; i <= state.totalPages; i++) {
                    html += `<button class="pagination-btn ${state.currentPage === i ? 'active' : ''}" onclick="paginationManager.goToPage('${options.stateKey || 'recite'}', ${i})" style="padding: 8px 12px; margin: 0 2px; border: 1px solid #e2e8f0; background: ${state.currentPage === i ? '#667eea' : 'white'}; color: ${state.currentPage === i ? 'white' : '#4a5568'}; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                        ${i}
                    </button>`;
                }
                html += `</div>`;
                
                // 下一页按钮
                html += `<button class="pagination-btn next-page-btn" onclick="paginationManager.goToPage('${options.stateKey || 'recite'}', ${state.currentPage + 1})" ${state.currentPage >= state.totalPages ? 'disabled' : ''} style="padding: 8px 12px; border: 1px solid #e2e8f0; background: white; color: #4a5568; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                    &gt;
                </button>`;
                
                // 跳转到指定页
                if (showGoToPage) {
                    html += `<span class="pagination-info" style="margin: 0 10px; color: #718096; font-size: 14px;">前往</span>
                    <input type="number" class="pagination-input" min="1" max="${state.totalPages}" value="${state.currentPage}" onkeydown="if(event.keyCode==13) paginationManager.goToPageByInput('${options.stateKey || 'recite'}', this.value)" style="width: 60px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; text-align: center;">
                    <button class="go-btn" onclick="paginationManager.goToPageByInput('${options.stateKey || 'recite'}', document.querySelector('.pagination-input').value)" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">前往</button>
                    <span class="pagination-info" style="margin: 0 10px; color: #718096; font-size: 14px;">页</span>`;
                }
                
                html += `</div>`;
                
                return html;
            }
            
            // 更新分页控件
            updatePagination(container, stateKey, options = {}) {
                const state = this.getState(stateKey);
                
                // 确保容器可见
                if (container.style.display === 'none') {
                    return;
                }
                
                let pagination = container.querySelector('.pagination');
                
                // 如果分页控件不存在，创建新的
                if (!pagination) {
                    pagination = document.createElement('div');
                    pagination.className = 'pagination';
                    container.appendChild(pagination);
                }
                
                // 更新分页HTML
                const paginationHTML = this.generatePaginationHTML(state, { ...options, stateKey });
                pagination.innerHTML = paginationHTML;
                
                // 显示分页控件
                pagination.style.display = 'flex';
                pagination.style.visibility = 'visible';
                pagination.style.opacity = '1';
            }
            
            // 跳转到指定页
            goToPage(stateKey, pageNum) {
                const state = this.getState(stateKey);
                if (pageNum >= 1 && pageNum <= state.totalPages) {
                    this.updateState(stateKey, { currentPage: pageNum });
                    this.triggerPageChange(stateKey);
                }
            }
            
            // 通过输入框跳转到指定页
            goToPageByInput(stateKey, pageNum) {
                const num = parseInt(pageNum);
                if (!isNaN(num)) {
                    this.goToPage(stateKey, num);
                }
            }
            
            // 上一页
            previousPage(stateKey) {
                const state = this.getState(stateKey);
                if (state.currentPage > 1) {
                    this.goToPage(stateKey, state.currentPage - 1);
                }
            }
            
            // 下一页
            nextPage(stateKey) {
                const state = this.getState(stateKey);
                if (state.currentPage < state.totalPages) {
                    this.goToPage(stateKey, state.currentPage + 1);
                }
            }
            
            // 设置页码变化回调
            onPageChange(stateKey, callback) {
                if (!this.pageChangeCallbacks) {
                    this.pageChangeCallbacks = {};
                }
                this.pageChangeCallbacks[stateKey] = callback;
            }
            
            // 触发页码变化事件
            triggerPageChange(stateKey) {
                if (this.pageChangeCallbacks && this.pageChangeCallbacks[stateKey]) {
                    this.pageChangeCallbacks[stateKey](this.getState(stateKey));
                }
            }
        }
        
        // 创建分页管理器实例
        const paginationManager = new PaginationManager();
        
        // 背书功能分页 - 初始化
        paginationManager.onPageChange('recite', (state) => {
            // 当背书分页页码变化时，重新显示当前页内容
            const activeItems = document.querySelector('.noun-items.active');
            if (activeItems) {
                // 背书功能的标签结构特殊，直接使用物流分类和全部子标签
                const mainTabName = 'logistics'; // 固定为物流分类
                const projectNum = 'all'; // 固定为全部子标签
                showNounItems(mainTabName, projectNum);
            }
        });
        
        // 搜索结果分页 - 初始化
        paginationManager.onPageChange('search', (state) => {
            // 当搜索结果分页页码变化时，重新搜索并显示结果
            searchNoun();
        });
        
        // 更新背书功能分页控件
        function updateRecitePagination() {
            // 查找激活的容器，优先使用class选择器
            let activeItems = document.querySelector('.noun-items.active');
            
            // 如果找不到，尝试查找所有具有noun-items类的元素，选择第一个可见的
            if (!activeItems) {
                const allNounItems = document.querySelectorAll('.noun-items');
                for (let item of allNounItems) {
                    if (item.style.display !== 'none') {
                        activeItems = item;
                        break;
                    }
                }
            }
            
            // 如果还是找不到，尝试使用物流AllItems作为备选
            if (!activeItems) {
                activeItems = document.getElementById('logisticsAllItems');
            }
            
            // 如果最终还是找不到，返回
            if (!activeItems) {
                return;
            }
            
            // 确保容器具有noun-items类
            if (!activeItems.classList.contains('noun-items')) {
                activeItems.classList.add('noun-items');
            }
            
            // 确保容器是激活状态
            if (!activeItems.classList.contains('active')) {
                activeItems.classList.add('active');
            }
            
            // 确保容器是可见的
            if (activeItems.style.display === 'none') {
                activeItems.style.display = 'block';
            }
            
            // 对于物流分类，我们已经在showNounItems中正确设置了总条数
            // 这里不再重新计算，直接使用已有的分页状态
            // 只确保每页显示20条
            paginationManager.updateState('recite', {
                itemsPerPage: 20
            });
            
            // 更新分页控件
            paginationManager.updatePagination(activeItems, 'recite');
        }
        
        // 旧函数兼容 - 用于现有代码调用
        function recitePreviousPage() {
            paginationManager.previousPage('recite');
        }
        
        function reciteNextPage() {
            paginationManager.nextPage('recite');
        }
        
        function goToRecitePage() {
            const pageInput = document.querySelector('.pagination-input');
            if (pageInput) {
                paginationManager.goToPageByInput('recite', pageInput.value);
            }
        }
        
        // 显示名词解释详情
        function showNounDetail(nounName) {
            currentNoun = nounName;
            
            // 根据名词名称获取对应的解释文本
            const nounExplanations = {
                '商品分类': '商品分类：指为了一定目的，选择适当的分类标志，\n\n将商品集合总体科学地、系统地逐级划分为门类、大\n\n类、中类、小类、品类以至品种、花色、规格的过程。',
                '商品包装标志': '商品包装标志:为了便于商品的流通、销售、选购和使用,在商品包装上通常都印有某种特定的文字或图形,用以表示商品的性能、储运注意事项、质量水平等含义,这些具有特定含义的图形和文字称为商品包装标志。商品包装标志分运输包装标志与销售包装标志。',
                '商品小类': '商品小类:对中类商品的进一步划分,体现具体的商品名称。',
                '仓库货架货位编码': '仓库货架货位编码:指将仓库范围的房、棚、场以及仓库的楼层、仓间、货架、走道等按地点、位置顺序编列号码,并做出明显标示,以便商品进出库可按号存取。',
                '品类群类编码': '品类群类编码:把一些相关性强的商品经过集合后,分成几个品类群,再对每个品类群进行编号。',
                '货物检验': '货物检验: 指利用工具或仪器,确定合适的检验项目,按照一定的方法,对照货物的标准检查、评价货物是否合乎规格及要求的过程。',
                '抽样检验': '抽样检验: 按照事先规定的抽样方案,从被检批中抽取少量样品,组成样本,再对样本逐一进行测试,将测试结果与标准或合同进行比较,最后根据样本质量状况统计推断受检商品整体质量合格与否。',
                '物理鉴定法': '物理鉴定法: 根据物理学原理,利用各种仪器或机械,通过对商品的物理性质及机械性质的鉴定,来确定商品的质量的方法。',
                '堆码': '堆码: 也称码垛,是将存放的商品整齐、有规划地摆放成货垛的作业。即根据商品物品的包装外形、重量、数量、性能和特点等,结合仓库地坪负荷、储存时间,将商品分别堆成各种垛形。',
                '货物上架作业': '货物上架作业: 进货人库的最后一个环节,是将要上架的货物搬运到存储区域,按照一定的上架原则及合适的方法将货品存放至指定储位。',
                '化学药剂防霉腐': '化学药剂防霉腐: 将化学药剂喷洒在商品体和包装上，或喷洒在仓库内。',
                '盘点差异处理': '盘点差异处理: 指在盘点结束以后,比较相同品名货物的账存数量与盘点数量之间的差异,如果差异率超过企业规定的范围,就必须对差异做出说明与原因分析,最后调整账务,做到账实相符。',
                '密封': '密封: 利用一些不透气、能隔热防潮的材料,把商品严密地封闭起来,以隔绝空气,降低或减小空气温湿度对商品的影响。',
                '商品养护': '商品养护: 商品在储运过程中所进行的保养和维护。从商品完成生产过程,进入消费领域之前,这一段过程的保养与维护都称为商品养护。',
                '干燥防霉腐': '干燥防霉腐: 通过降低仓库环境中的水分和商品本身的水分,达到防霉腐的目的。',
                '人工摘取式拣货': '人工摘取式拣货：针对每一张订单，由拣货员完全用人工方式根据订单上的货品信息到相应的存储位置将货品逐一挑出并集中的过程。',
                '播种式DAS拣货': '播种式DAS拣货：DAS(播种式电子标签分拣系统)利用电子标签实现了播种式分货出库，每一储位的电子标签显示出该位置所需分货的数量，分拣员可根据这些信息进行快速分拣作业。',
                '摘取式DPS拣货': '摘取式DPS拣货：在拣货操作区中的所有货架上，为每一种货物安装一个电子标签，拣货操作时只需根据电子标签所显示的数量即可轻松地完成商品拣货作业。',
                '订单配货与校验出库': '订单配货与校验出库：指把拣取分类完成的货品进行校验，按客户订单进行配货，并完成货品的出库。',
                '现代商品包装': '现代商品包装:指在流通过程中保护商品、方便储运、促进销售,按一定技术方法而采用的容器、材料及辅助物等的总称,也指为了达到上述目的而采用容器、材料和辅助物的过程中施加一定技术方法等的操作活动。',
                '内包装': '内包装:也称为小包装或销售包装。这类包装与商品直接接触,通常作为商品的组成部分而随商品一起卖给消费者。',
                '外包装': '外包装:也称为运输包装,或称为大包装。外包装可起到强化运输、保护商品以及便于储运的作用,是货物运输、保管等物流环节所要求的必要包装。',
                '充气包装': '充气包装:采用二氧化碳气体或氮气等不活泼气体置换包装容器中空气的包装技术方法。',
                '包装标准': '包装标准:围绕实际包装的科学化、合理化而制订的各类标准,是保证产品在流通过程中安全可靠、性能不变,而对包装材料、包装容器、包装方式所做的统一的技术规定。',
                '不良品': '不良品:由卖家或物流等不同的责任方造成商品问题,影响其二次销售,但可返工或更换相关配件修复的商品。',
                '待处理品': '待处理品:因客户少发或漏发退货商品或票据,或经检验责任方为客户所造成的无法正常退货的商品,此类商品一般先整理到待处理区。待商品票据补全后入库或退回客户。',
                '废品': '废品:指因客户、物流或卖家原因造成的商品失去使用价值且无法修复或失去修复价值的商品。',
                '《退换货通知单》': '《退换货通知单》:根据客户的退货要求,售后编制退货信息用以告知仓库进行业务对接、退货准备与核对等,在企业内部适用。'
            };
            
            // 获取当前名词的解释文本
            currentNounText = nounExplanations[nounName] || `${nounName}：暂无详细解释`;
            
            // 更新模态框内容
            document.getElementById('nounDetailTitle').textContent = nounName;
            document.getElementById('nounDetailText').textContent = currentNounText;
            
            // 显示模态框
            document.getElementById('nounDetailModal').classList.add('active');
            
            // 获取元素
            const skipBtn = document.getElementById('skipBtn');
            const countdownNumber = document.getElementById('countdownNumber');
            
            // 重置跳过按钮状态
            skipBtn.classList.remove('active');
            skipBtn.disabled = true;
            
            // 重置按钮HTML结构（包含倒计时元素）
            skipBtn.innerHTML = '跳过（<span id="countdownNumber">5</span>秒后可用）';
            
            // 清除之前的定时器
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            if (skipTimeout) {
                clearTimeout(skipTimeout);
            }
            
            // 开始倒计时
            let countdown = 5;
            countdownInterval = setInterval(() => {
                countdown--;
                // 更新倒计时数字
                const currentCountdownNumber = document.getElementById('countdownNumber');
                if (currentCountdownNumber) {
                    currentCountdownNumber.textContent = countdown;
                }
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    skipBtn.classList.add('active');
                    skipBtn.disabled = false;
                    skipBtn.innerHTML = '跳过';
                }
            }, 1000);
            
            // 5秒后激活跳过按钮
            skipTimeout = setTimeout(() => {
                clearInterval(countdownInterval);
                skipBtn.classList.add('active');
                skipBtn.disabled = false;
                skipBtn.innerHTML = '跳过';
            }, 5000);
            
            // 1. 检查是否需要添加全局点击监听器来激活音频
            if (!AppState.globalClickListenerAdded) {
                // 添加全局点击监听器，确保在用户交互后激活音频
                document.addEventListener('click', initAudioAndSpeech);
                document.addEventListener('touchstart', initAudioAndSpeech);
                AppState.globalClickListenerAdded = true;
            }
            
            // 2. 在移动设备上，如果音频尚未激活，先尝试激活
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) && !AppState.mobileAudioActivated) {
                // 立即尝试激活音频和语音合成
                initAudioAndSpeech();
                
                // 延迟播放，确保音频上下文已激活
                setTimeout(() => {
                    playNounDetail();
                }, 200);
            } else {
                // 非移动设备或已激活音频，正常播放
                // 自动播放语音（减少延迟，确保与用户交互紧密关联）
                setTimeout(() => {
                    playNounDetail();
                }, 50);
            }
            
            // 更新导航按钮状态
            updateNavButtonsState();
        }
        
        // 关闭名词解释详情
        function closeNounDetailModal() {
            // 停止所有语音播放
            stopCurrentAudio();
            
            // 隐藏语音播放小弹窗
            const voicePlayModal = document.getElementById('voicePlayModal');
            if (voicePlayModal) {
                voicePlayModal.classList.remove('active');
            }
            
            // 清除localStorage中的语音状态
            localStorage.removeItem('reciteSpeechState');
            
            document.getElementById('nounDetailModal').classList.remove('active');
            
            // 清除所有定时器
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            if (skipTimeout) {
                clearTimeout(skipTimeout);
                skipTimeout = null;
            }
        }
        
        // 更新导航按钮状态和进度指示器
        function updateNavButtonsState() {
            // 确保currentNavList不为空
            if (!currentNavList || currentNavList.length === 0) {
                // 如果currentNavList为空，尝试从当前显示的名词项中获取
                const activeItems = document.querySelector('.noun-items.active');
                if (activeItems) {
                    const nounItems = activeItems.querySelectorAll('.noun-item');
                    currentNavList = Array.from(nounItems).map(item => {
                        return item.querySelector('.noun-item-name').textContent.trim();
                    }).filter(name => name);
                }
            }
            
            // 确保currentNoun存在于currentNavList中
            if (!currentNoun || !currentNavList.includes(currentNoun)) {
                // 如果currentNoun不存在于currentNavList中，尝试从页面中重新获取所有名词
                const allNounItems = document.querySelectorAll('.noun-item');
                const allNouns = Array.from(allNounItems).map(item => {
                    return item.querySelector('.noun-item-name').textContent.trim();
                }).filter(name => name);
                
                // 如果能找到当前名词，更新currentNavList
                if (allNouns.includes(currentNoun)) {
                    currentNavList = allNouns;
                } else if (currentNavList.length === 0) {
                    // 如果currentNavList仍为空，使用默认值
                    currentNavList = [currentNoun];
                }
            }
            
            const currentIndex = currentNavList.indexOf(currentNoun);
            const prevBtn = document.getElementById('prevNounBtn');
            const nextBtn = document.getElementById('nextNounBtn');
            const progressElement = document.getElementById('nounProgress');
            
            // 循环导航模式下，始终启用导航按钮
            prevBtn.disabled = false;
            nextBtn.disabled = false;
            
            // 更新进度指示器
            if (progressElement) {
                const displayIndex = currentIndex >= 0 ? currentIndex + 1 : 1;
                const totalLength = currentNavList.length > 0 ? currentNavList.length : 1;
                progressElement.textContent = `${displayIndex} / ${totalLength}`;
            }
            
            // 同时更新通过querySelector获取的进度元素
            const queryProgressElement = document.querySelector('.noun-progress');
            if (queryProgressElement) {
                const displayIndex = currentIndex >= 0 ? currentIndex + 1 : 1;
                const totalLength = currentNavList.length > 0 ? currentNavList.length : 1;
                queryProgressElement.textContent = `${displayIndex} / ${totalLength}`;
            }
        }
        
        // 显示上一个名词解释
        function showPrevNoun() {
            const currentIndex = currentNavList.indexOf(currentNoun);
            let prevNoun;
            if (currentIndex > 0) {
                prevNoun = currentNavList[currentIndex - 1];
            } else {
                // 循环至最后一条
                prevNoun = currentNavList[currentNavList.length - 1];
                showToast('已到达第一条，自动返回最后一条');
            }
            showNounDetail(prevNoun);
        }
        
        // 显示下一个名词解释
        function showNextNoun() {
            const currentIndex = currentNavList.indexOf(currentNoun);
            let nextNoun;
            if (currentIndex < currentNavList.length - 1) {
                nextNoun = currentNavList[currentIndex + 1];
            } else {
                // 循环至第一条
                nextNoun = currentNavList[0];
                showToast('已到达最后一条，自动返回第一条');
            }
            showNounDetail(nextNoun);
        }
        
        // 更新导航按钮状态
        function updateNavigationButtons() {
            // 确保currentNoun存在于currentNavList中
            if (!currentNavList.includes(currentNoun)) {
                console.warn('当前名词不在导航列表中:', currentNoun);
                // 尝试从页面中重新获取当前导航列表
                const activeItems = document.querySelector('.noun-items.active');
                if (activeItems) {
                    const nounItems = activeItems.querySelectorAll('.noun-item');
                    currentNavList = Array.from(nounItems).map(item => {
                        return item.querySelector('.noun-item-name').textContent.trim();
                    }).filter(name => name);
                }
            }
            
            const currentIndex = currentNavList.indexOf(currentNoun);
            const prevBtn = document.getElementById('prevNounBtn');
            const nextBtn = document.getElementById('nextNounBtn');
            
            // 更新进度显示
            const progressElement = document.querySelector('.noun-progress');
            if (progressElement) {
                progressElement.textContent = `${currentIndex + 1} / ${currentNavList.length}`;
            }
            
            // 更新nounProgress元素
            const nounProgressElement = document.getElementById('nounProgress');
            if (nounProgressElement) {
                nounProgressElement.textContent = `${currentIndex + 1} / ${currentNavList.length}`;
            }
        }
        
        // 播放名词解释语音
        function playNounDetail() {
            if (isPlaying) {
                // 如果正在播放，先停止
                stopCurrentAudio();
            }
            
            // 1. 检查是否在移动设备上且尚未激活音频
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) && !AppState.mobileAudioActivated) {
                // 尝试立即激活音频和语音合成
                initAudioAndSpeech();
            }
            
            // 2. 根据当前设置的语音方案选择播放方式
            console.log('当前语音方案:', AppState.speechScheme);
            
            if (AppState.speechScheme === 'A') {
                // A方案：浏览器合成语音
                playSchemeA();
            } else {
                // B方案：预上传音频文件
                playSchemeB();
            }
        }
        
        // 播放A方案（浏览器合成语音）
        function playSchemeA() {
            try {
                // 1. 综合检测语音合成可用性
                const isSpeechSupported = checkSpeechAvailability();
                
                if (!isSpeechSupported) {
                    console.error('A方案语音合成不可用，自动切换到B方案');
                    // 自动切换到B方案
                    switchSpeechScheme('B');
                    playSchemeB();
                    return;
                }
                
                // 2. 创建语音合成实例
                const utterance = new SpeechSynthesisUtterance(currentNounText);
                utterance.lang = 'zh-CN';
                utterance.rate = speechRate;
                utterance.volume = 1.5; // 增大语音播放音量
                
                // 3. 添加语音播放状态事件监听
                utterance.onstart = function() {
                    isPlaying = true;
                    console.log('A方案语音播放开始');
                    // 显示语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            voiceModal.classList.add('active');
                        }
                    } catch (error) {
                        console.error('显示语音播放弹窗时出错:', error);
                    }
                    // 保存语音状态到localStorage
                    localStorage.setItem('reciteSpeechState', JSON.stringify({
                        currentNoun: currentNoun,
                        currentNounText: currentNounText,
                        speechRate: speechRate,
                        isPlaying: true,
                        timestamp: Date.now(),
                        speechScheme: 'A' // 标记为A方案
                    }));
                };
                
                utterance.onend = function() {
                    isPlaying = false;
                    console.log('A方案语音播放结束');
                    // 隐藏语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            voiceModal.classList.remove('active');
                        }
                    } catch (error) {
                        console.error('隐藏语音播放弹窗时出错:', error);
                    }
                    // 清除localStorage中的语音状态
                    localStorage.removeItem('reciteSpeechState');
                    // 先关闭名词解释详情弹窗
                    closeNounDetailModal();
                    // 延迟显示确认进入答题界面弹窗，确保弹窗关闭动画完成
                    setTimeout(function() {
                        document.getElementById('confirmTestModal').classList.add('active');
                    }, 300); // 300ms延迟，匹配弹窗关闭动画时长
                };
                
                utterance.onerror = function(event) {
                    isPlaying = false;
                    console.error('A方案语音播放错误:', event.error);
                    // 隐藏语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            voiceModal.classList.remove('active');
                        }
                    } catch (error) {
                        console.error('隐藏语音播放弹窗时出错:', error);
                    }
                    // 清除localStorage中的语音状态
                    localStorage.removeItem('reciteSpeechState');
                    
                    // 显示友好的错误提示
                    showSpeechError(event.error);
                    
                    // A方案失败，自动切换到B方案
                    console.error('A方案播放失败，自动切换到B方案');
                    switchSpeechScheme('B');
                    
                    // 直接显示确认弹窗
                    document.getElementById('confirmTestModal').classList.add('active');
                };
                
                utterance.onpause = function() {
                    isPlaying = false;
                    console.log('A方案语音播放已暂停');
                };
                
                utterance.onresume = function() {
                    isPlaying = true;
                    console.log('A方案语音播放已恢复');
                };
                
                // 4. 确保语音合成API已准备就绪
                try {
                    if (window.speechSynthesis.speaking) {
                        window.speechSynthesis.cancel();
                    }
                } catch (error) {
                    console.error('检查或取消正在播放的语音时出错:', error);
                }
                
                // 5. 尝试播放语音，处理可能的异步问题
                const playVoice = () => {
                    try {
                        window.speechSynthesis.speak(utterance);
                        console.log('A方案语音播放请求已发送');
                    } catch (error) {
                        console.error('发送A方案语音播放请求时出错:', error);
                        // 重试一次，可能是语音引擎尚未准备就绪
                        setTimeout(() => {
                            try {
                                window.speechSynthesis.speak(utterance);
                                console.log('A方案语音播放请求已重试发送');
                            } catch (retryError) {
                                console.error('重试A方案语音播放请求时仍出错:', retryError);
                                isPlaying = false;
                                showSpeechError('play-failed');
                                
                                // A方案重试失败，自动切换到B方案
                                console.error('A方案重试失败，自动切换到B方案');
                                switchSpeechScheme('B');
                                
                                // 直接显示确认弹窗
                                document.getElementById('confirmTestModal').classList.add('active');
                                localStorage.removeItem('reciteSpeechState');
                            }
                        }, 100);
                    }
                };
                
                // 6. 检查语音列表是否已加载完成
                const voices = window.speechSynthesis.getVoices();
                if (voices.length === 0) {
                    // 语音列表尚未加载，等待voiceschanged事件
                    const handleVoicesChanged = () => {
                        window.speechSynthesis.removeEventListener('voiceschanged', handleVoicesChanged);
                        playVoice();
                    };
                    window.speechSynthesis.addEventListener('voiceschanged', handleVoicesChanged);
                    
                    // 添加超时处理
                    setTimeout(() => {
                        window.speechSynthesis.removeEventListener('voiceschanged', handleVoicesChanged);
                        if (!isPlaying) {
                            console.error('A方案语音列表加载超时，自动切换到B方案');
                            // 超时后仍未播放，切换到B方案
                            switchSpeechScheme('B');
                            playSchemeB();
                        }
                    }, 2000); // 延长超时时间到2秒
                } else {
                    // 语音列表已加载，直接播放
                    playVoice();
                }
            } catch (error) {
                isPlaying = false;
                console.error('播放A方案语音时出错:', error);
                // 显示友好的错误提示
                showSpeechError('unknown');
                
                // A方案失败，自动切换到B方案
                console.error('A方案执行出错，自动切换到B方案');
                switchSpeechScheme('B');
                
                // 直接显示确认弹窗
                document.getElementById('confirmTestModal').classList.add('active');
                localStorage.removeItem('reciteSpeechState');
            }
        }
        
        // 播放B方案（预上传音频文件）
        function playSchemeB() {
            console.log('使用B方案播放音频:', currentNoun);
            playAudioFile(currentNoun);
        }
        
        // 检测语音合成可用性（综合检测）
        function checkSpeechAvailability() {
            try {
                if (!('speechSynthesis' in window)) {
                    return false;
                }
                
                // 检查AppState中的支持状态
                if (AppState.speechSynthesisSupported === false) {
                    return false;
                }
                
                // 检查speechSynthesis对象是否可用
                const synth = window.speechSynthesis;
                if (typeof synth.speak !== 'function') {
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('检查语音可用性时出错:', error);
                return false;
            }
        }
        
        // 显示语音合成不支持提示
        function showSpeechNotSupported() {
            // 避免使用alert，使用更友好的提示方式
            console.log('您的浏览器不支持语音合成功能');
            // 可以添加更友好的UI提示，例如在页面上显示一个提示条
            showToast('当前浏览器不支持语音合成功能，将直接进入答题');
        }
        
        // 显示语音播放状态弹窗
        function showVoiceStatusModal(message, icon = '🔊') {
            const modal = document.getElementById('voiceStatusModal');
            const statusIcon = document.getElementById('voiceStatusIcon');
            const statusMessage = document.getElementById('voiceStatusMessage');
            
            if (modal && statusIcon && statusMessage) {
                statusIcon.textContent = icon;
                statusMessage.textContent = message;
                modal.classList.add('active');
                
                // 5秒后自动关闭弹窗
                setTimeout(() => {
                    closeVoiceStatusModal();
                }, 5000);
            }
        }
        
        // 关闭语音播放状态弹窗
        function closeVoiceStatusModal() {
            const modal = document.getElementById('voiceStatusModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        // 显示语音播放错误提示
        function showSpeechError(errorType) {
            let errorMessage = '语音播放遇到问题';
            let errorIcon = '⚠️';
            
            switch (errorType) {
                case 'canceled':
                    errorMessage = '语音播放已取消';
                    errorIcon = '🔊';
                    break;
                case 'interrupted':
                    errorMessage = '语音播放被中断';
                    errorIcon = '⚠️';
                    break;
                case 'network':
                    errorMessage = '网络问题导致语音播放失败';
                    errorIcon = '🌐';
                    break;
                case 'synthesis-unavailable':
                    errorMessage = '语音合成服务不可用';
                    errorIcon = '🔊';
                    break;
                case 'synthesis-failed':
                    errorMessage = '语音合成失败';
                    errorIcon = '🔊';
                    break;
                case 'language-unavailable':
                    errorMessage = '不支持当前语言的语音合成';
                    errorIcon = '🌐';
                    break;
                case 'voice-unavailable':
                    errorMessage = '没有可用的语音引擎';
                    errorIcon = '🔊';
                    break;
                case 'play-failed':
                    errorMessage = '语音播放请求失败';
                    errorIcon = '⚠️';
                    break;
                case 'audio-unavailable':
                    errorMessage = '未找到音频文件';
                    errorIcon = '📁';
                    break;
                case 'unknown':
                    errorMessage = '语音播放遇到未知问题';
                    errorIcon = '❓';
                    break;
                default:
                    // 处理浏览器SpeechSynthesisUtterance事件返回的错误类型
                    if (errorType === 'network') {
                        errorMessage = '网络问题导致语音播放失败';
                        errorIcon = '🌐';
                    } else if (errorType === 'not-allowed') {
                        errorMessage = '语音播放被浏览器阻止';
                        errorIcon = '🚫';
                    } else if (errorType === 'service-not-available') {
                        errorMessage = '语音服务不可用';
                        errorIcon = '🔊';
                    } else {
                        errorMessage = `语音播放遇到问题: ${errorType}`;
                        errorIcon = '⚠️';
                    }
            }
            
            console.error('语音错误:', errorMessage);
            showVoiceStatusModal(errorMessage, errorIcon);
        }
        
        // 播放B方案音频（预上传音频文件）
        function playAudioFile(nounName) {
            try {
                // 1. 停止当前正在播放的音频
                stopCurrentAudio();
                
                // 2. 获取音频URL
                const audioUrl = AppState.nounAudioUrls[nounName];
                if (!audioUrl) {
                    console.error('未找到音频文件:', nounName);
                    showSpeechError('audio-unavailable');
                    // 直接显示确认弹窗
                    document.getElementById('confirmTestModal').classList.add('active');
                    localStorage.removeItem('reciteSpeechState');
                    return;
                }
                
                // 3. 获取或创建音频元素
                let audioElement = AppState.audioElements[nounName];
                let isNewAudioElement = false;
                
                if (!audioElement) {
                    isNewAudioElement = true;
                    audioElement = new Audio(audioUrl);
                    audioElement.preload = 'auto';
                    AppState.audioElements[nounName] = audioElement;
                    
                    // 添加加载状态事件
                    audioElement.onloadstart = function() {
                        // 显示加载状态
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            const voiceText = voiceModal.querySelector('.voice-text');
                            if (voiceText) {
                                voiceText.textContent = '正在加载音频...';
                            }
                            voiceModal.classList.add('active');
                        }
                    };
                    
                    audioElement.oncanplaythrough = function() {
                        // 音频加载完成，准备播放
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            const voiceText = voiceModal.querySelector('.voice-text');
                            if (voiceText) {
                                voiceText.textContent = '正在播放语音';
                            }
                        }
                        
                        // 如果是新创建的音频元素，加载完成后自动播放
                        if (isNewAudioElement) {
                            audioElement.play().catch(function(error) {
                                console.error('播放B方案音频时出错:', error);
                                isPlaying = false;
                                showSpeechError('play-failed');
                                // 直接显示确认弹窗
                                document.getElementById('confirmTestModal').classList.add('active');
                                localStorage.removeItem('reciteSpeechState');
                            });
                        }
                    };
                }
                
                // 4. 设置音频播放事件
                audioElement.onplay = function() {
                    isPlaying = true;
                    // 显示语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            const voiceText = voiceModal.querySelector('.voice-text');
                            if (voiceText) {
                                voiceText.textContent = '正在播放语音';
                            }
                            voiceModal.classList.add('active');
                        }
                    } catch (error) {
                        console.error('显示语音播放弹窗时出错:', error);
                    }
                    // 保存语音状态到localStorage
                    localStorage.setItem('reciteSpeechState', JSON.stringify({
                        currentNoun: currentNoun,
                        currentNounText: currentNounText,
                        speechRate: speechRate,
                        isPlaying: true,
                        timestamp: Date.now(),
                        speechScheme: 'B' // 标记为B方案
                    }));
                };
                
                audioElement.onended = function() {
                    isPlaying = false;
                    // 隐藏语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            voiceModal.classList.remove('active');
                        }
                    } catch (error) {
                        console.error('隐藏语音播放弹窗时出错:', error);
                    }
                    // 清除localStorage中的语音状态
                    localStorage.removeItem('reciteSpeechState');
                    // 先关闭名词解释详情弹窗
                    closeNounDetailModal();
                    // 延迟显示确认进入答题界面弹窗，确保弹窗关闭动画完成
                    setTimeout(function() {
                        document.getElementById('confirmTestModal').classList.add('active');
                    }, 300); // 300ms延迟，匹配弹窗关闭动画时长
                };
                
                audioElement.onerror = function(event) {
                    isPlaying = false;
                    console.error('音频播放错误:', event.error);
                    // 隐藏语音播放小弹窗
                    try {
                        const voiceModal = document.getElementById('voicePlayModal');
                        if (voiceModal) {
                            voiceModal.classList.remove('active');
                        }
                    } catch (error) {
                        console.error('隐藏语音播放弹窗时出错:', error);
                    }
                    // 清除localStorage中的语音状态
                    localStorage.removeItem('reciteSpeechState');
                    
                    // 显示友好的错误提示
                    showSpeechError('network');
                    // 直接显示确认弹窗
                    document.getElementById('confirmTestModal').classList.add('active');
                };
                
                // 5. 播放音频（如果音频已加载完成）
                if (!isNewAudioElement) {
                    // 音频已预加载或缓存，直接播放
                    audioElement.play().then(() => {
                        console.log('B方案音频播放已开始:', nounName);
                    }).catch(error => {
                        console.error('B方案音频播放失败:', error);
                        isPlaying = false;
                        showSpeechError('play-failed');
                        // 直接显示确认弹窗
                        document.getElementById('confirmTestModal').classList.add('active');
                        localStorage.removeItem('reciteSpeechState');
                    });
                }
                // 如果是新创建的音频元素，会在oncanplaythrough事件中自动播放
            } catch (error) {
                console.error('播放B方案音频时出错:', error);
                isPlaying = false;
                showSpeechError('unknown');
                // 直接显示确认弹窗
                document.getElementById('confirmTestModal').classList.add('active');
                localStorage.removeItem('reciteSpeechState');
            }
        }
        
        // 停止当前正在播放的音频
        function stopCurrentAudio() {
            try {
                // 停止A方案语音合成
                if (typeof window.speechSynthesis !== 'undefined' && typeof window.speechSynthesis.cancel === 'function') {
                    window.speechSynthesis.cancel();
                }
                
                // 停止所有B方案音频
                for (const key in AppState.audioElements) {
                    const audio = AppState.audioElements[key];
                    if (audio && typeof audio.pause === 'function') {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                }
                
                isPlaying = false;
            } catch (error) {
                console.error('停止音频播放时出错:', error);
                isPlaying = false;
            }
        }
        
        // 切换语音方案
        function switchSpeechScheme(scheme) {
            try {
                // 1. 验证方案有效性
                if (scheme !== 'A' && scheme !== 'B') {
                    console.error('无效的语音方案:', scheme);
                    return;
                }
                
                // 2. 保存方案到AppState
                AppState.speechScheme = scheme;
                
                // 3. 保存到localStorage，持久化设置
                localStorage.setItem('speechScheme', scheme);
                
                // 4. 更新UI（如果存在的话）
                updateSpeechSchemeUI();
                
                // 5. 显示切换成功提示
                showToast(`语音方案已切换至${scheme === 'A' ? '浏览器合成语音' : '上传音频文件'}`);
                
                console.log('语音方案已切换:', scheme);
            } catch (error) {
                console.error('切换语音方案时出错:', error);
                showToast('切换语音方案失败');
            }
        }
        
        // 更新语音方案UI
        function updateSpeechSchemeUI() {
            try {
                // 查找方案切换按钮并更新状态
                const schemeABtn = document.getElementById('schemeABtn');
                const schemeBBtn = document.getElementById('schemeBBtn');
                const currentSchemeEl = document.getElementById('currentScheme');
                
                if (schemeABtn) {
                    schemeABtn.classList.toggle('active', AppState.speechScheme === 'A');
                }
                
                if (schemeBBtn) {
                    schemeBBtn.classList.toggle('active', AppState.speechScheme === 'B');
                }
                
                if (currentSchemeEl) {
                    currentSchemeEl.textContent = AppState.speechScheme === 'A' ? 'A方案' : 'B方案';
                }
            } catch (error) {
                console.error('更新语音方案UI时出错:', error);
            }
        }
        
        // 预览语音方案
        function previewSpeechScheme(scheme) {
            try {
                // 1. 获取预览按钮元素
                const previewBtn = document.getElementById(`preview${scheme}Btn`);
                if (!previewBtn) return;
                
                // 2. 如果正在播放，停止播放
                if (previewBtn.classList.contains('playing')) {
                    // 停止当前预览音频
                    if (scheme === 'A') {
                        // 停止A方案语音合成
                        speechSynthesis.cancel();
                    } else if (scheme === 'B') {
                        // 停止B方案音频
                        const previewAudio = previewBtn.audioElement;
                        if (previewAudio) {
                            previewAudio.pause();
                            previewAudio.currentTime = 0;
                            delete previewBtn.audioElement;
                        }
                    }
                    
                    // 移除播放状态
                    previewBtn.classList.remove('playing');
                    return;
                }
                
                // 3. 播放预览音频
                previewBtn.classList.add('playing');
                
                // 4. 根据方案类型播放不同的预览音频
                if (scheme === 'A') {
                    // A方案预览：使用浏览器语音合成
                    const utterance = new SpeechSynthesisUtterance('这是A方案的语音预览');
                    utterance.lang = 'zh-CN';
                    utterance.rate = 0.8;
                    utterance.volume = 1.0;
                    
                    utterance.onend = function() {
                        previewBtn.classList.remove('playing');
                    };
                    
                    utterance.onerror = function() {
                        previewBtn.classList.remove('playing');
                        showToast('A方案预览失败', 'error');
                    };
                    
                    speechSynthesis.speak(utterance);
                } else if (scheme === 'B') {
                    // B方案预览：使用预上传音频
                    const audio = new Audio();
                    audio.src = 'https://cfbed.1314883.xyz/file/1767010734042_商品分类.wav';
                    audio.volume = 1.0;
                    
                    // 保存音频元素到按钮上，以便后续暂停操作
                    previewBtn.audioElement = audio;
                    
                    audio.onended = function() {
                        previewBtn.classList.remove('playing');
                        delete previewBtn.audioElement;
                    };
                    
                    audio.onerror = function() {
                        previewBtn.classList.remove('playing');
                        showToast('B方案预览失败', 'error');
                        delete previewBtn.audioElement;
                    };
                    
                    audio.play().catch(function(error) {
                        previewBtn.classList.remove('playing');
                        showToast('B方案预览失败', 'error');
                        console.error('B方案预览播放失败:', error);
                        delete previewBtn.audioElement;
                    });
                }
            } catch (error) {
                console.error('预览语音方案时出错:', error);
                showToast('预览失败', 'error');
                // 确保移除播放状态
                const previewBtn = document.getElementById(`preview${scheme}Btn`);
                if (previewBtn) {
                    previewBtn.classList.remove('playing');
                    // 清理音频元素
                    if (previewBtn.audioElement) {
                        delete previewBtn.audioElement;
                    }
                }
            }
        }
        
        // 预加载音频资源
        function preloadAudioResources() {
            try {
                // 预加载所有名词的音频资源
                const nounsToPreload = Object.keys(AppState.nounAudioUrls);
                
                // 限制同时预加载的音频数量，避免网络阻塞
                const maxConcurrentPreloads = 3;
                let currentPreloadCount = 0;
                let preloadIndex = 0;
                
                // 预加载函数
                const loadNextAudio = () => {
                    if (preloadIndex >= nounsToPreload.length) return;
                    
                    if (currentPreloadCount < maxConcurrentPreloads) {
                        const nounName = nounsToPreload[preloadIndex++];
                        const audioUrl = AppState.nounAudioUrls[nounName];
                        
                        if (audioUrl && !AppState.audioElements[nounName]) {
                            currentPreloadCount++;
                            
                            // 创建音频元素但不播放
                            const audioElement = new Audio(audioUrl);
                            audioElement.preload = 'auto';
                            
                            // 预加载完成后缓存音频元素
                            audioElement.oncanplaythrough = function() {
                                AppState.audioElements[nounName] = audioElement;
                                console.log('音频预加载完成:', nounName);
                                currentPreloadCount--;
                                loadNextAudio(); // 加载下一个音频
                            };
                            
                            // 预加载失败时处理
                            audioElement.onerror = function() {
                                console.error('音频预加载失败:', nounName);
                                currentPreloadCount--;
                                loadNextAudio(); // 加载下一个音频
                            };
                            
                            // 超时处理
                            const timeoutId = setTimeout(() => {
                                console.warn('音频预加载超时:', nounName);
                                currentPreloadCount--;
                                loadNextAudio(); // 加载下一个音频
                            }, 10000); // 10秒超时
                            
                            audioElement.ontimeout = function() {
                                clearTimeout(timeoutId);
                                console.warn('音频加载超时:', nounName);
                                currentPreloadCount--;
                                loadNextAudio(); // 加载下一个音频
                            };
                            
                            // 开始预加载
                            audioElement.load();
                        } else {
                            loadNextAudio(); // 跳过已加载的音频
                        }
                    }
                };
                
                // 启动预加载
                loadNextAudio();
            } catch (error) {
                console.error('预加载音频资源时出错:', error);
            }
        }
        
        // 初始化语音方案设置
        function initSpeechScheme() {
            try {
                // 从localStorage加载保存的方案，默认为A
                const savedScheme = localStorage.getItem('speechScheme') || 'A';
                AppState.speechScheme = savedScheme;
                
                // 更新UI
                updateSpeechSchemeUI();
                
                console.log('语音方案初始化完成，当前方案:', savedScheme);
                
                // 预加载音频资源
                preloadAudioResources();
            } catch (error) {
                console.error('初始化语音方案时出错:', error);
                // 出错时默认使用A方案
                AppState.speechScheme = 'A';
            }
        }
        

        
        // 关闭确认进入答题界面弹窗
        function closeConfirmTestModal() {
            document.getElementById('confirmTestModal').classList.remove('active');
        }
        
        // 重新播放语音
        function replayNounDetail() {
            closeConfirmTestModal();
            // 重新显示背书弹窗
            document.getElementById('nounDetailModal').classList.add('active');
            // 重新播放语音
            playNounDetail();
        }
        
        // 从确认弹窗进入答题界面
        function startReciteTestFromConfirm() {
            // 停止正在播放的语音（添加安全检查）
            try {
                if (typeof window.speechSynthesis !== 'undefined' && typeof window.speechSynthesis.cancel === 'function') {
                    window.speechSynthesis.cancel();
                    isPlaying = false;
                }
            } catch (error) {
                console.error('停止语音播放时出错:', error);
            }
            
            // 清除localStorage中的语音状态
            localStorage.removeItem('reciteSpeechState');
            
            // 隐藏语音播放小弹窗（添加存在性检查）
            try {
                const voiceModal = document.getElementById('voicePlayModal');
                if (voiceModal) {
                    voiceModal.classList.remove('active');
                }
            } catch (error) {
                console.error('隐藏语音播放弹窗时出错:', error);
            }
            
            // 关闭确认弹窗和详情模态框
            closeConfirmTestModal();
            closeNounDetailModal();
            // 进入答题界面
            startReciteTest();
        }
        
        // 开始背书测试
        function startReciteTest() {
            // 停止正在播放的语音（添加安全检查）
            try {
                if (typeof window.speechSynthesis !== 'undefined' && typeof window.speechSynthesis.cancel === 'function') {
                    window.speechSynthesis.cancel();
                    isPlaying = false;
                }
            } catch (error) {
                console.error('停止语音播放时出错:', error);
            }
            
            // 清除localStorage中的语音状态
            localStorage.removeItem('reciteSpeechState');
            
            // 隐藏语音播放小弹窗（添加存在性检查）
            try {
                const voiceModal = document.getElementById('voicePlayModal');
                if (voiceModal) {
                    voiceModal.classList.remove('active');
                }
            } catch (error) {
                console.error('隐藏语音播放弹窗时出错:', error);
            }
            
            // 关闭详情模态框
            closeNounDetailModal();
            
            // 更新测试模态框内容（添加存在性检查）
            try {
                const questionElement = document.getElementById('testQuestion');
                const scoreElement = document.getElementById('testScore');
                const statusElement = document.getElementById('matchStatus');
                
                if (questionElement) questionElement.textContent = currentNoun;
                if (scoreElement) scoreElement.textContent = '0';
                if (statusElement) statusElement.innerHTML = '';
            } catch (error) {
                console.error('更新测试模态框内容时出错:', error);
            }
            
            // 显示测试模态框（添加存在性检查）
            try {
                const testModal = document.getElementById('reciteTestModal');
                if (testModal) {
                    testModal.classList.add('active');
                }
            } catch (error) {
                console.error('显示测试模态框时出错:', error);
            }
            
            // 初始化语音识别
            initSpeechRecognition();
        }
        
        // 初始化语音识别
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'zh-CN';
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                recognition.continuous = true;
                
                recognition.onresult = function(event) {
                    // 确保获取到有效的结果
                    if (event.results && event.results.length > 0) {
                        const result = event.results[event.results.length - 1][0].transcript;
                        // 将识别结果直接显示在输入框中
                        document.getElementById('testInput').value = result;
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('语音识别错误:', event.error);
                    let errorMessage = '语音识别错误，请重试';
                    
                    // 根据不同错误类型显示更具体的信息
                    switch(event.error) {
                        case 'not-allowed':
                            errorMessage = '请允许麦克风访问权限';
                            break;
                        case 'no-speech':
                            errorMessage = '未检测到语音，请重试';
                            break;
                        case 'aborted':
                            errorMessage = '语音识别已中止';
                            break;
                        case 'audio-capture':
                            errorMessage = '无法访问麦克风';
                            break;
                        case 'network':
                            errorMessage = '网络错误，请检查网络连接';
                            break;
                        case 'not-supported':
                            errorMessage = '您的浏览器不支持语音识别';
                            break;
                    }
                    
                    document.getElementById('matchStatus').innerHTML = errorMessage;
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    document.getElementById('startRecordBtn').disabled = false;
                    document.getElementById('stopRecordBtn').disabled = true;
                };
            } else {
                alert('您的浏览器不支持语音识别功能');
            }
        }
        
        // 开始录音
        function startRecording() {
            if (!recognition) {
                initSpeechRecognition();
            }
            
            if (recognition && !isRecording) {
                // 清除之前的评分结果和匹配状态
                document.getElementById('testScore').textContent = '0';
                document.getElementById('matchStatus').innerHTML = '';
                document.getElementById('testInput').value = '';
                matchResult = [];
                
                recognition.start();
                isRecording = true;
                document.getElementById('startRecordBtn').disabled = true;
                document.getElementById('stopRecordBtn').disabled = false;
            }
        }
        
        // 停止录音
        function stopRecording() {
            if (recognition && isRecording) {
                recognition.stop();
                isRecording = false;
                document.getElementById('startRecordBtn').disabled = false;
                document.getElementById('stopRecordBtn').disabled = true;
                
                // 不再自动计算评分，等待用户点击提交按钮
            }
        }
        
        // 提交答案
        function submitAnswer() {
            const submitBtn = document.getElementById('submitBtn');
            const testInput = document.getElementById('testInput');
            
            // 防止重复提交
            if (submitBtn.classList.contains('loading')) {
                return;
            }
            
            // 显示加载状态
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<span>⏳</span><span>提交中...</span>';
            
            // 获取用户输入的答案
            const userAnswer = testInput.value.trim();
            
            if (userAnswer) {
                // 计算最终匹配度和评分
                calculateMatch(userAnswer);
                
                // 获取当前得分
                const score = parseInt(document.getElementById('testScore').textContent);
                
                // 更新统计数据
                reciteStats.totalAnswers++;
                
                // 如果得分≥60，视为正确答案
                if (score >= 60) {
                    reciteStats.correctAnswers++;
                    
                    // 标记当前名词为已学习
                    reciteStats.learnedNouns = Math.min(reciteStats.totalNouns, reciteStats.learnedNouns + 1);
                }
                
                // 更新统计显示
                updateReciteStats();
                
                // 模拟提交过程，延迟显示结果
                setTimeout(function() {
                    // 恢复按钮状态
                    submitBtn.classList.remove('loading');
                    submitBtn.innerHTML = '<span>✅</span><span>提交成功</span>';
                    
                    // 保持成功状态2秒，然后恢复原文本
                    setTimeout(function() {
                        submitBtn.innerHTML = '<span>📤</span><span>提交答案</span>';
                    }, 2000);
                }, 1000);
            } else {
                // 恢复按钮状态
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<span>📤</span><span>提交答案</span>';
                alert('请输入或录制答案后再提交！');
            }
        }
        
        // 计算匹配度
        // 从手动输入计算匹配度
        function calculateMatchFromInput() {
            const inputText = document.getElementById('testInput').value;
            calculateMatch(inputText);
        }
        
        // 标准化文本：去除多余空格、统一标点符号、转换为小写
        function normalizeText(text) {
            // 去除"商品分类："等前缀
            let normalized = text.replace(/^[^：]*：/, '');
            // 替换所有空白字符为单个空格
            normalized = normalized.replace(/\s+/g, ' ');
            // 统一中文标点符号
            normalized = normalized.replace(/，/g, ',').replace(/。/g, '.').replace(/、/g, ',');
            // 去除末尾多余的标点符号
            normalized = normalized.replace(/[.,，。、]+$/, '');
            // 转换为小写进行匹配
            normalized = normalized.toLowerCase();
            // 去除所有空格
            normalized = normalized.replace(/\s+/g, '');
            return normalized;
        }
        
        function calculateMatch(recognizedText) {
            // 对目标文本和用户输入进行标准化处理
            const target = currentNounText.replace(/\n/g, '').trim();
            const recognized = recognizedText.trim();
            
            // 保存原始文本用于显示
            const originalTarget = target;
            const originalRecognized = recognized;
            
            const normalizedTarget = normalizeText(target);
            const normalizedRecognized = normalizeText(recognized);
            
            // 初始化匹配结果
            matchResult = [];
            
            // 如果目标文本为空，直接返回0分
            if (!normalizedTarget) {
                document.getElementById('testScore').textContent = '0';
                updateMatchStatus();
                return;
            }
            
            // 使用更智能的匹配算法
            // 计算最长公共子序列(LCS)长度
            function longestCommonSubsequence(s1, s2) {
                const m = s1.length;
                const n = s2.length;
                const dp = Array(m + 1).fill(0).map(() => Array(n + 1).fill(0));
                
                for (let i = 1; i <= m; i++) {
                    for (let j = 1; j <= n; j++) {
                        if (s1[i - 1] === s2[j - 1]) {
                            dp[i][j] = dp[i - 1][j - 1] + 1;
                        } else {
                            dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                        }
                    }
                }
                return dp[m][n];
            }
            
            // 计算LCS长度
            const lcsLength = longestCommonSubsequence(normalizedTarget, normalizedRecognized);
            
            // 计算匹配率
            const matchRate = lcsLength / normalizedTarget.length;
            
            // 优化评分算法：添加关键词匹配权重
            // 提取关键词（这里简单使用前几个字符作为关键词）
            const keywords = normalizedTarget.substring(0, Math.min(5, normalizedTarget.length));
            const hasKeywords = normalizedRecognized.includes(keywords);
            
            // 如果包含关键词，给予额外加分（最多10分）
            const keywordBonus = hasKeywords ? Math.min(10, Math.round(matchRate * 10)) : 0;
            
            // 计算最终得分（100分制，确保不超过100）
            let score = Math.round(matchRate * 90) + keywordBonus;
            score = Math.min(100, score);
            
            // 更新主得分
            document.getElementById('testScore').textContent = score;
            
            // 计算匹配详情
            const matchPercentage = Math.round(matchRate * 100);
            const correctChars = lcsLength;
            const totalChars = normalizedTarget.length;
            
            // 更新详细计算元素
            document.getElementById('matchPercentage').textContent = `${matchPercentage}%`;
            document.getElementById('correctChars').textContent = `${correctChars}/${totalChars}`;
            
            // 更新关键词匹配状态
            const keywordMatchElement = document.getElementById('keywordMatch');
            keywordMatchElement.textContent = hasKeywords ? '✓' : '✗';
            keywordMatchElement.className = `score-detail-value ${hasKeywords ? 'correct' : 'incorrect'}`;
            
            // 更新匹配状态显示，添加详细的评分反馈
            const matchStatus = document.getElementById('matchStatus');
            
            // 构建详细的评分反馈HTML
            let matchStatusHtml = `
                <div class="match-detail">
                    <div class="match-summary">
                        <div class="match-stat">
                            <span class="stat-label">匹配度：</span>
                            <span class="stat-value">${matchPercentage}%</span>
                        </div>
                        <div class="match-stat">
                            <span class="stat-label">正确字符：</span>
                            <span class="stat-value">${correctChars}/${totalChars}</span>
                        </div>
                        <div class="match-stat">
                            <span class="stat-label">关键词匹配：</span>
                            <span class="stat-value ${hasKeywords ? 'correct' : 'incorrect'}">${hasKeywords ? '✓' : '✗'}</span>
                        </div>
                    </div>
                    
                    <div class="score-feedback">
                        ${getScoreFeedback(score)}
                    </div>
                    
                    <div class="answer-comparison">
                        <div class="answer-item">
                            <div class="answer-label">参考答案：</div>
                            <div class="answer-content correct-answer">${originalTarget}</div>
                        </div>
                        <div class="answer-item">
                            <div class="answer-label">你的答案：</div>
                            <div class="answer-content your-answer">${originalRecognized}</div>
                        </div>
                    </div>
                </div>
            `;
            
            matchStatus.innerHTML = matchStatusHtml;
        }
        
        // 获取评分反馈
        function getScoreFeedback(score) {
            if (score >= 90) {
                return '<div class="feedback excellent">🎉 优秀！你的背诵非常准确。</div>';
            } else if (score >= 80) {
                return '<div class="feedback good">👍 良好！你的背诵基本正确，可以再完善一些细节。</div>';
            } else if (score >= 60) {
                return '<div class="feedback average">😊 合格！你的背诵已经掌握了主要内容。</div>';
            } else {
                return '<div class="feedback need-improvement">💪 还需要努力！建议多练习，掌握更多内容。</div>';
            }
        }
        
        // 更新匹配状态显示
        function updateMatchStatus() {
            const matchStatus = document.getElementById('matchStatus');
            let html = '';
            
            for (let i = 0; i < matchResult.length; i += 10) {
                const line = matchResult.slice(i, i + 10);
                html += '<div class="match-item">';
                line.forEach(item => {
                    html += `<span class="match-char ${item.status}">${item.char || '□'}</span>`;
                });
                html += '</div>';
            }
            
            matchStatus.innerHTML = html;
        }
        
        // 关闭背书测试
        function closeReciteTestModal() {
            document.getElementById('reciteTestModal').classList.remove('active');
            if (recognition) {
                recognition.stop();
                isRecording = false;
            }
            // 确保关闭答题系统后不会重新触发确认弹窗
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                isPlaying = false;
            }
            // 清除localStorage中的语音状态
            localStorage.removeItem('reciteSpeechState');
        }
        
        // 重试背书测试
        function retryTest() {
            // 重置所有测试相关状态
            document.getElementById('testScore').textContent = '0';
            document.getElementById('matchStatus').innerHTML = '';
            document.getElementById('testInput').value = '';
            matchResult = [];
            
            // 重置录音状态
            isRecording = false;
            isPlaying = false;
            
            // 重置语音合成
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            // 重置倒计时
            clearTimeout(skipTimeout);
            
            // 重置跳过按钮状态
            const skipBtn = document.getElementById('skipBtn');
            if (skipBtn) {
                skipBtn.classList.remove('active');
                skipBtn.disabled = true;
                skipBtn.innerHTML = '跳过（<span id="countdownNumber">5</span>秒后可用）';
            }
            
            // 重置倒计时数字
            const countdownNumber = document.getElementById('countdownNumber');
            if (countdownNumber) {
                countdownNumber.textContent = '5';
            }
            
            // 显示提示信息
            showToast('测试已重置，请重新开始');
        }
        
        // 页面加载完成后初始化
        // 添加beforeunload事件监听器，确保在页面关闭前保存语音状态
        window.addEventListener('beforeunload', function() {
            if (isPlaying && currentNoun && currentNounText) {
                // 保存当前语音状态到localStorage
                localStorage.setItem('reciteSpeechState', JSON.stringify({
                    currentNoun: currentNoun,
                    currentNounText: currentNounText,
                    speechRate: speechRate,
                    isPlaying: true,
                    timestamp: Date.now()
                }));
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            // 先执行原始的初始化
            init();
            
            // 更新背书统计数据
            updateReciteStats();
            
            // 只有在非登录注册页面并且用户已登录时，才恢复语音状态
            const authPage = document.getElementById('authPage');
            if (authPage && authPage.classList.contains('active')) {
                // 如果当前是登录注册页面，清除可能存在的语音状态，防止弹窗出现
                localStorage.removeItem('reciteSpeechState');
            } else {
                // 检查localStorage中是否有保存的语音状态
                const savedSpeechState = localStorage.getItem('reciteSpeechState');
                if (savedSpeechState) {
                    try {
                        const speechState = JSON.parse(savedSpeechState);
                        // 检查状态是否有效（10分钟内有效）
                        const now = Date.now();
                        const stateAge = now - (speechState.timestamp || 0);
                        if (stateAge > 600000) {
                            // 状态过期，清除
                            localStorage.removeItem('reciteSpeechState');
                            return;
                        }
                        
                        // 恢复语音状态
                        currentNoun = speechState.currentNoun;
                        currentNounText = speechState.currentNounText;
                        speechRate = speechState.speechRate;
                        
                        // 更新模态框内容
                        document.getElementById('nounDetailTitle').textContent = currentNoun;
                        document.getElementById('nounDetailText').textContent = currentNounText;
                        
                        // 显示模态框
                        document.getElementById('nounDetailModal').classList.add('active');
                        
                        // 重置跳过按钮状态
                        const skipBtn = document.getElementById('skipBtn');
                        skipBtn.classList.remove('active');
                        skipBtn.disabled = true;
                        skipBtn.innerHTML = '跳过（<span id="countdownNumber">5</span>秒后可用）';
                        
                        // 重置倒计时
                        const countdownNumber = document.getElementById('countdownNumber');
                        countdownNumber.textContent = '5';
                        
                        // 开始倒计时
                        let countdown = 5;
                        if (skipTimeout) {
                            clearTimeout(skipTimeout);
                        }
                        
                        const countdownInterval = setInterval(() => {
                            countdown--;
                            // 更新倒计时数字
                            const currentCountdownNumber = document.getElementById('countdownNumber');
                            if (currentCountdownNumber) {
                                currentCountdownNumber.textContent = countdown;
                            }
                            
                            if (countdown <= 0) {
                                clearInterval(countdownInterval);
                                skipBtn.classList.add('active');
                                skipBtn.disabled = false;
                                skipBtn.innerHTML = '跳过';
                            }
                        }, 1000);
                        
                        // 5秒后激活跳过按钮
                        skipTimeout = setTimeout(() => {
                            clearInterval(countdownInterval);
                            skipBtn.classList.add('active');
                            skipBtn.disabled = false;
                            skipBtn.innerHTML = '跳过';
                        }, 5000);
                        
                        // 确保speechSynthesis初始化完成后再恢复播放
                        function checkSpeechSynthesisReady() {
                            if (typeof speechSynthesis !== 'undefined' && speechSynthesis !== null) {
                                // 检查speechSynthesis是否已经初始化
                                if (speechSynthesis.getVoices().length > 0) {
                                    // 自动播放语音
                                    playNounDetail();
                                } else {
                                    // 等待voiceschanged事件
                                    speechSynthesis.onvoiceschanged = function() {
                                        playNounDetail();
                                    };
                                    // 设置超时保护，防止事件不触发
                                    setTimeout(() => {
                                        playNounDetail();
                                    }, 1000);
                                }
                            } else {
                                // speechSynthesis不可用，清除状态
                                localStorage.removeItem('reciteSpeechState');
                            }
                        }
                        
                        // 检查speechSynthesis就绪状态
                        checkSpeechSynthesisReady();
                    } catch (error) {
                        console.error('恢复语音状态失败:', error);
                        localStorage.removeItem('reciteSpeechState');
                    }
                }
            }
        });
        
        // 页面加载完成后，自动更新背书功能的分页控件
        // 确保物流项目1的页码按钮在页面加载时就生成
        window.addEventListener('load', function() {
            // 首先调用showNounItems函数，显示"全部"标签的内容
            showNounItems('logistics', 'all');
            // 然后更新分页控件
            updateRecitePagination();
        });
    </script>
</body>
</html>
